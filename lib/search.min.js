"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function delay(t){return new Promise(function(e,a){setTimeout(e,t)})}function multiComplete(t,e){function a(t){window.location.href=t}var r="odn.data.socrata.com",n=[{name:"Datasets",image:"fa-bar-chart",domain:r,fxf:"fpum-bjbr",column:"encoded",encoded:["domain","fxf"],select:function(t){return a("/dataset/"+t.domain+"/"+t.fxf)},show:function(t,e){t.append("span").attr("class","name").text(e.text).append("span").attr("id","tag").text(e.domain)}},{name:"Regions",image:"fa-globe",domain:r,fxf:"68ht-6puw",column:"all",encoded:["id","type","population"],select:function(t){a("/region/"+t.id+"/"+t.text.replace(/ /g,"_").replace(/\//g,"_").replace(/,/g,""))},sort:function(t){return-parseFloat(t.population)}},{name:"Publishers",image:"fa-newspaper-o",domain:r,fxf:"8ae5-ghum",column:"domain",select:function(t){return a("/search?domains="+t.text)}},{name:"Categories",image:"fa-fighter-jet",domain:r,fxf:"864v-r7tf",column:"category",select:function(t){return a("/search?categories="+t.text)},show:function(t,e){t.append("span").attr("class","capitalize").text(e.text)}}],i=new Autosuggest(e,n);return i.listen(t),i}function regionsWithData(t,e){var a=_nameToColumn.has(t)?_nameToColumn.get(t):defaultColumn;return[_.extend({},_withDataSource,{select:e,column:a})]}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function variableGenerator(){var t=arguments.length<=0||void 0===arguments[0]?[2013]:arguments[0],e=arguments.length<=1||void 0===arguments[1]?parseFloat:arguments[1];return function(a){return a.map(function(a){var r=_slicedToArray(a,5),n=r[0],i=r[1],o=r[2],s=r[3],l=r[4];return{name:n,column:i,format:o,years:t,value:e,stoplight:s,metric:l}})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}$(document).ready(function(){$(".search-link").click(function(){var t=$("#q").val().trim();0===t.length?$("#q").focus():$("#form").submit()})}),Array.prototype.includes=function(t){return this.indexOf(t)>-1},String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(e,a){return"undefined"!=typeof t[a]?t[a]:e})},String.prototype.split2=function(t){var e=this.split(t);return 1==e.length&&""===e[0]?[]:e};var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),ApiController=function(){function t(){_classCallCheck(this,t),this.categoriesUrl="/categories.json",this.childRegionsUrl="https://odn.data.socrata.com/resource/eyae-8jfy?parent_id={0}&$limit={1}",this.costOfLivingUrl="https://odn.data.socrata.com/resource/hpnf-gnfu.json?id={0}",this.datasetSummaryUrl="https://{0}/api/views/{1}.json",this.domainsUrl="https://api.us.socrata.com/api/catalog/v1/domains",this.earningsUrl="https://odn.data.socrata.com/resource/wmwh-4vak.json?id={0}",this.educationUrl="https://odn.data.socrata.com/resource/uf4m-5u8r.json?id={0}",this.gdpUrl="https://odn.data.socrata.com/resource/ks2j-vhr8.json?id={0}",this.mostPopulousRegionTypeUrl="https://odn.data.socrata.com/resource/eyae-8jfy?parent_id={0}&child_type={1}&$limit={2}&$order=child_population desc",this.mostPopulousStatesUrl="https://odn.data.socrata.com/resource/eyae-8jfy?$where=child_type='state'&$order=child_population desc&$limit={0}",this.occupationsUrl="https://odn.data.socrata.com/resource/qfcm-fw3i.json?$order=occupation&id={0}",this.parentStateUrl="https://odn.data.socrata.com/resource/eyae-8jfy?parent_type=state&child_id={0}",this.populationUrl="https://odn.data.socrata.com/resource/e3rd-zzmr.json?id={0}",this.healthDataUrls={rwjf_county_health_rankings_2015:"https://odn.data.socrata.com/resource/7ayp-utp2.json?id={0}",cdc_brfss_prevalence_2011_2013:"https://odn.data.socrata.com/resource/n4rt-3rmd.json?id={0}"}}return _createClass(t,[{key:"getCategories",value:function(){return d3.promise.json(this.categoriesUrl)}},{key:"getChildRegions",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.childRegionsUrl.format(t,e))}},{key:"getCitiesInState",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.mostPopulousRegionTypeUrl.format(t,"place",e))}},{key:"getCostOfLivingData",value:function(t){return d3.promise.json(this.costOfLivingUrl.format(t))}},{key:"getCountiesInState",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.mostPopulousRegionTypeUrl.format(t,"county",e))}},{key:"getDatasetSummary",value:function(t,e){return d3.promise.json(this.datasetSummaryUrl.format(t,e))}},{key:"getDomains",value:function(){return d3.promise.json(this.domainsUrl)}},{key:"getEarningsData",value:function(t){return d3.promise.json(this.earningsUrl.format(t))}},{key:"getEducationData",value:function(t){return d3.promise.json(this.educationUrl.format(t))}},{key:"getGdpData",value:function(t){return d3.promise.json(this.gdpUrl.format(t))}},{key:"getMetrosInState",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.mostPopulousRegionTypeUrl.format(t,"msa",e))}},{key:"getMostPopulousStates",value:function(){var t=arguments.length<=0||void 0===arguments[0]?8:arguments[0];return d3.promise.json(this.mostPopulousStatesUrl.format(t))}},{key:"getOccupationsData",value:function(t){return d3.promise.json(this.occupationsUrl.format(t))}},{key:"getParentState",value:function(t){return d3.promise.json(this.parentStateUrl.format(t.id))}},{key:"getPopulationData",value:function(t){return d3.promise.json(this.populationUrl.format(t))}},{key:"getHealthRwjfChrData",value:function(t){return d3.promise.json(this.healthDataUrls.rwjf_county_health_rankings_2015.format(t))}}]),t}(),Constants={ROSTER_URL:"https://federal.demo.socrata.com/resource/bdeb-mf9k.json",AUTOCOMPLETE_SEPARATOR:":",AUTOCOMPLETE_URL:function(t,e,a,r){return"https://"+t+"/views/"+e+"/columns/"+a+"/suggest/"+r},AUTOCOMPLETE_WAIT_MS:150,AUTOCOMPLETE_MAX_OPTIONS:100,AUTOCOMPLETE_SHOWN_OPTIONS:5,PEER_REGIONS:5,PEER_REGIONS_MAX:10},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),RegionLookup=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"get",value:function(t){return $.getJSON(Constants.ROSTER_URL+"?"+$.param(t))}},{key:"getOne",value:function(e){function a(t){if(0===t.length)return console.warn("no regions found for params: "),console.warn(e),null;if(1===t.length)return t[0];var a=_.filter(t,function(t){return"place"===t.type});return a.length>0?a[0]:t[0]}return new Promise(function(r,n){t.get(e).then(function(t){r(a(t))},function(t){throw t})})}},{key:"byName",value:function(e){return t.getOne({name:e})}},{key:"byID",value:function(e){return t.getOne({id:e})}}]),t}(),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),Sources=function(){function t(e){_classCallCheck(this,t),this.sources=e}return _createClass(t,[{key:"forRegions",value:function(e){var a=new Set(e.map(function(t){return t.type}));return this.sources.filter(function(e){var r=new Set(e.regions);return t.intersection(r,a).size>0})}}],[{key:"intersection",value:function(t,e){return new Set([].concat(_toConsumableArray(t)).filter(function(t){return e.has(t)}))}}]),t}(),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),Base64=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"encode",value:function(t){return btoa(unescape(encodeURIComponent(str)))}},{key:"decode",value:function(t){return decodeURIComponent(escape(atob(t)))}}]),t}(),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),AutosuggestSource=function(){function t(e,a,r,n,i,o,s,l,c){_classCallCheck(this,t),this.name=e,this.image=a,this.domain=r,this.fxf=n,this.column=i,this.encoded=o,this.select=s,this.show=l,this.sort=c}return _createClass(t,[{key:"get",value:function(t){var e=this;return new Promise(function(a,r){if(""===t)a([]);else{var n=Constants.AUTOCOMPLETE_URL(e.domain,e.fxf,e.column,t),i=e.sort?Constants.AUTOCOMPLETE_MAX_OPTIONS:Constants.AUTOCOMPLETE_SHOWN_OPTIONS,o={size:i},s=n+"?"+$.param(o);$.getJSON(s).then(function(t){a(t.options.map(function(t){return e.decode(t)}))},r)}})}},{key:"decode",value:function(t){if(this.encoded.length>0){var e=t.text,a=e.lastIndexOf(" "),r=e.substring(0,a),n=e.substring(a+1),i=Base64.decode(n),o=i.split(Constants.AUTOCOMPLETE_SEPARATOR);return _.extend({text:r},_.object(this.encoded,o))}return{text:t.text}}},{key:"display",value:function(t,e){var a=this;if(0===e.length)return[];this.sort&&(e=_.sortBy(e,this.sort).slice(0,Constants.AUTOCOMPLETE_SHOWN_OPTIONS));var r=t.append("li").attr("class","autocomplete-category");if(this.image){r.append("label").attr("class","autocomplete-title").text(this.name);if(e.length>1){r.append("div").append("i").attr("class","fa "+this.image)}}var n=r.append("ul").attr("class","autocomplete-options sub-list"),i=this;return n.selectAll("li").data(e).enter().append("li").attr("class","autocomplete-option").each(function(t){i.show(d3.select(this),t)}).on("click",function(t){return a.select(t)}).on("mouseover.source",function(){d3.select(this).classed("selected hovered",!0)}).on("mouseout.source",function(){d3.select(this).classed("selected hovered",!1)})[0]}}],[{key:"fromJSON",value:function(e){var a=e.encoded||[],r=e.show||function(t,e){t.append("span").text(e.text)};return new t(e.name,e.image,e.domain,e.fxf,e.column,a,e.select,r,e.sort)}}]),t}(),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),AutosuggestResults=function(){function t(e){_classCallCheck(this,t),this.results=d3.select(e),this.options=[],this.index=-1,this.autohide()}return _createClass(t,[{key:"autohide",value:function(){var t=this;d3.select("html").on("click.results",function(){return t.hide()}),this.results.on("click.results",function(){return d3.event.stopPropagation()})}},{key:"hide",value:function(){this.results.style("display","none")}},{key:"unhide",value:function(){this.results.style("display","block")}},{key:"empty",value:function(){this.results.html("")}},{key:"display",value:function(t){var e=this;return new Promise(function(a,r){e.source.get(t).then(function(t){e.empty(),0===t.length?(e.hide(),a([])):(e.unhide(),a(e.source.display(e.results,t)))},function(t){throw t})})}},{key:"show",value:function(t,e){var a=this;this.empty();var r=t.map(function(t,r){var n=e[r];return t.display(a.results,n)});this.updateOptions(_.flatten(r)),this.unhide()}},{key:"updateOptions",value:function(t){var e=this;this.options=t.map(function(t){return d3.select(t)}),this.options.forEach(function(t,a){t.on("mouseover.results",function(){e.index=a,e.updateSelected()}).on("mouseout.results",function(){e.index=-1,e.updateSelected()})})}},{key:"updateSelected",value:function(){var t=this;this.options.forEach(function(e,a){e.classed("selected",a===t.index)})}},{key:"keydown",value:function(t){38==t?this.up():40==t&&this.down(),this.updateSelected()}},{key:"up",value:function(){this.index>0?this.index-=1:this.index=this.options.length-1}},{key:"down",value:function(){this.index<this.options.length-1?this.index+=1:this.index=0}},{key:"enter",value:function(){var t=this.options[this.index];t.on("click")(t.datum())}}]),t}(),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),Autosuggest=function(){function t(e,a){_classCallCheck(this,t),this.sources=a.map(AutosuggestSource.fromJSON),this.results=new AutosuggestResults(e),this._currentTerm="",this._time=Date.now()}return _createClass(t,[{key:"listen",value:function(t){var e=this;d3.select(t).on("keydown",function(){var t=d3.event.keyCode;13==t?(d3.event.preventDefault(),e.enter()):e.results.keydown(t)}).on("input",function(){e.throttledSuggest(this.value)})}},{key:"throttledSuggest",value:function(t){var e=this;delay(Constants.AUTOCOMPLETE_WAIT_MS).then(function(){t===e._currentTerm&&e.suggest(t)}),this._currentTerm=t}},{key:"suggest",value:function(t){var e=this;""===t?this.results.hide():!function(){var a=Date.now(),r=e.sources.map(function(e){return e.get(t)});Promise.all(r).then(function(t){a>e._time&&(e._time=a,e.results.show(e.sources,t))})}()}},{key:"enter",value:function(){if(this.results.index<0){var t="/search?"+$.param({q:this._currentTerm});window.location.href=t}else this.results.enter()}}]),t}(),domain="odn.data.socrata.com",_nameToColumn=new Map;_nameToColumn.set("population","population"),_nameToColumn.set("earnings","earnings"),_nameToColumn.set("education","education"),_nameToColumn.set("occupations","occupations"),_nameToColumn.set("cost_of_living","rpp"),_nameToColumn.set("gdp","gdp"),_nameToColumn.set("health","health");var defaultColumn="all",_withDataSource={name:"Regions with Data",domain:domain,fxf:"68ht-6puw",encoded:["id","type","population"],sort:function(t){return-parseFloat(t.population)}},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),Scale=function(){function t(e,a,r){_classCallCheck(this,t),this.values=e,this.range=a,this.scale=r}return _createClass(t,null,[{key:"quantile",value:function(e,a){e.sort(d3.ascending);var r=1/a.length,n=_.map(a.slice(1),function(t,a){return d3.quantile(e,(a+1)*r)}),i=d3.scale.quantile().domain(n).range(a);return new t(e,a,i)}}]),t}(),MapConstants={LIMIT:5e3,CSS_ID:"leaflet-map",MAPBOX_TOKEN:"pk.eyJ1IjoibGFuZWFhc2VuIiwiYSI6ImYxZjExYmYzOTMxYzgyZTc2NDY0NDBmNDNmZmEwYWM3In0.uy5ta6EsSEZggkVQHo2ygw",LABEL_LAYER_ID:"socrata-apps.cb421623",BASE_LAYER_ID:"socrata-apps.af2cc4ed",COLOR_SCALE:colorbrewer.Blues[9].slice(2),STOPLIGHT_COLOR_SCALE:colorbrewer.RdYlGn[7],SCALE:Scale.quantile,MAP_OPTIONS:{minZoom:3,maxZoom:12,zoomControl:!1,attributionControl:!1,scrollWheelZoom:!1},ZOOM_CONTROL:!0,ZOOM_CONTROL_OPTIONS:{position:"topleft"},INITIAL_CENTER:[37.1669,-95.9669],INITIAL_ZOOM:4,AUTO_ZOOM_OPTIONS:{animate:!1,maxZoom:10,paddingTopLeft:[50,0]},AUTO_ZOOM_OUT:1,POINT_RADIUS_SCALE:d3.scale.log,POINT_RADIUS_RANGE_METERS:[500,2e3],BASE_STYLE:{stroke:!0,color:"#2c3e50",opacity:1,weight:2,fill:!1},REFERENCE_STYLE:{fill:!0,fillOpacity:.35,stroke:!0,weight:1,opacity:1},SELECTED_STYLE:{weight:6,dashArray:"4, 8",lineCap:"round"},NO_DATA_STYLE:{fill:!1,stroke:!1},LEGEND_OPACITY:.5,TOOLTIP_OPTIONS:{offset:L.point(0,-20),closeButton:!1,closeOnClick:!1},TOOLTIP_PADDING:16,POPUP_OPTIONS:{closeButton:!1,closeOnClick:!1},TOPOJSON_DIRECTORY:"/geo/",TOPOJSON_SUFFIX:".topo.json",REGIONS:{nation:{name:"USA",id:"nation",topo:"nation",type:"choropleth"},region:{name:"Regions",id:"region",topo:"region",type:"choropleth"},division:{name:"Divisions",id:"division",topo:"division",type:"choropleth"},state:{name:"States",id:"state",topo:"state",type:"choropleth"},county:{name:"Counties",id:"county",topo:"county",type:"choropleth"},msa:{name:"Metros",id:"msa",topo:"cbsa",type:"choropleth"},place:{name:"Cities",id:"place",topo:"places",type:"point"}},DEFAULT_REGION:"state"},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),TopoModel=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"get",value:function(t){var e=MapConstants.TOPOJSON_DIRECTORY+t.topo+MapConstants.TOPOJSON_SUFFIX;return $.getJSON(e)}}]),t}(),MapModel=function(){function t(e,a,r,n,i){_classCallCheck(this,t),this.source=e,this.region=a,this.variable=r,this.year=n,this.regions=i,this.regionById=t.makeLookup(i,function(t){return t.id})}return _createClass(t,[{key:"values",value:function(){return this.regions.map(function(t){return t.value})}},{key:"scale",value:function(t,e){var a=e.slice(0);return this.variable.reverse&&a.reverse(),t(this.values(),a)}}],[{key:"makeLookup",value:function(t,e){var a=new Map;return _.each(t,function(t){return a.set(e(t),t)}),a}},{key:"create",value:function(e,a,r,n){var i=e.idColumn||"id",o=e.typeColumn||"type",s=e.nameColumn||"name",l=e.yearColumn||"year",c=e.hasPopulation||!1,u=e.populationColumn||"population",h=e.value||parseFloat;return new Promise(function(d,p){function m(i){var o=i.map(function(t){var e=h(t[r.column]);return{id:t.id,type:t.type,name:t.name,value:e,valueName:r.name,valueFormatted:r.format(e),year:n}});d(new t(e,a,r,n,o))}function f(t){throw t}var g=[i,o,s,l],v=g.concat([r.column]),y=_defineProperty({type:a.id,$select:v.join(),$limit:MapConstants.LIMIT},l,n),b=c?{$order:u+" DESC"}:{},w=_.extend({},y,b,r.params),C="https://"+e.domain+"/resource/"+e.fxf+".json?"+$.param(w);$.getJSON(C).then(m,f)})}}]),t}(),_slicedToArray=function(){function t(t,e){var a=[],r=!0,n=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(a.push(o.value),!e||a.length!==e);r=!0);}catch(l){n=!0,i=l}finally{try{!r&&s["return"]&&s["return"]()}finally{if(n)throw i}}return a}return function(e,a){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),LegendControl=L.Control.extend({options:{position:"bottomleft"},onAdd:function(t){var e=L.DomUtil.create("div","legend-control");return this.container=d3.select(e),e},update:function(t,e,a){this.container.selectAll("*").remove();var r=10,n=t.range.slice();n.reverse();var i=n.length*r,o=this.container.append("div").attr("class","legend-container"),s=_.filter(t.values,function(t){return!isNaN(t)}),l=d3.extent(s),c=_slicedToArray(l,2),u=c[0],h=c[1],d=d3.quantile(s,.25),p=d3.median(s),m=d3.quantile(s,.75),f=["maximum","upper quartile","median","lower quartile","minimum"],g=[h,m,p,d,u],v=i/(g.length-1),y=2,b="middle",w=o.append("svg").attr("height",i+15).attr("class","legend"),C=w.append("g").attr("class","labels"),T=C.selectAll("text").data(f).enter().append("text").attr("class","tick-label").text(function(t){return t}).attr("text-anchor","end").attr("alignment-baseline",b),k=C.node().getBBox().width+r+y;T.attr("transform",function(t,e){return"translate("+(k-y)+", "+(r+e*v)+")"});var S=w.append("g").attr("class","ticks"),O=S.selectAll("g.tick").data(g).enter().append("g").attr("class","tick").attr("transform",function(t,e){return"translate("+(k+r)+", "+(r+e*v)+")"});O.append("line").attr("class","tick-line").attr("x1",r).attr("y1",0).attr("x2",2*r).attr("y2",0),O.append("line").attr("class","tick-line").attr("x1",-r).attr("y1",0).attr("x2",0).attr("y2",0),O.append("text").attr("class","tick-value").text(function(t){return e.format(t)}).attr("alignment-baseline",b).attr("transform","translate("+(2*r+y)+", 0)");w.selectAll("rect").data(n).enter().append("rect").attr("class","legend-element").attr("x",k+r).attr("y",function(t,e){return(e+1)*r}).attr("width",r).attr("height",r).style("fill",function(t){return t}).style("fill-opacity",MapConstants.LEGEND_OPACITY);w.append("rect").attr("class","legend-box").attr("x",k+r).attr("y",r).attr("width",r).attr("height",i),w.attr("width",w.node().getBBox().width+2*r)}}),_slicedToArray=function(){function t(t,e){var a=[],r=!0,n=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(a.push(o.value),!e||a.length!==e);r=!0);}catch(l){n=!0,i=l}finally{try{!r&&s["return"]&&s["return"]()}finally{if(n)throw i}}return a}return function(e,a){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),MapBounds=function(){function t(e){_classCallCheck(this,t),this.$div=e,this.update()}return _createClass(t,[{key:"update",value:function(){var t=this.$div.offset(),e=t.left,a=t.top;this.x1=e,this.y1=a,this.x2=this.x1+this.$div.width(),this.y2=this.y1+this.$div.height(),this.centerX=this.x1+(this.x2-this.x1)/2,this.centerY=this.y1+(this.y2-this.y1)/2}},{key:"normalize",value:function(t){var e=_slicedToArray(t,2),a=e[0],r=e[1];return[a-this.x2,r-this.y2]}},{key:"quadrant",value:function(t){var e=_slicedToArray(t,2),a=e[0],r=e[1];return[a-this.centerX<0,r-this.centerY<0]}}]),t}(),Tooltip=function(){function t(e,a){_classCallCheck(this,t),this.name=e,this.value=a}return _createClass(t,[{key:"show",value:function(){}}],[{key:"fromRegion",value:function(e){var a=e.name,r=e.valueName+" ("+e.year+"): "+e.valueFormatted;return new t(a,r)}}]),t}(),TooltipControl=L.Control.extend({options:{position:"bottomright"},onAdd:function(t){var e=this,a=L.DomUtil.create("div","tooltip");this.container=d3.select(a).style("display","none").attr("id","tooltip"),this.$container=$(this.container[0]),this.name=this.container.append("div").attr("class","name"),this.value=this.container.append("div").attr("class","value"),this.shown=!1;var r=new MapBounds($("#leaflet-map"));return window.onresize=function(){r.update()},document.addEventListener("mousemove",function(t){if(e.shown){var a=[t.pageX,t.pageY],n=r.normalize(a),i=_slicedToArray(n,2),o=i[0],s=i[1],l=r.quadrant(a),c=_slicedToArray(l,2),u=c[0],h=c[1],d=MapConstants.TOOLTIP_PADDING,p=u?o+e.width+d:o-d,m=h?s+e.height+d:s-d;e.container.style("left",p+"px").style("top",m+"px")}}),a},show:function(t,e){this.name.text(t),this.value.text(e),this.width=this.$container.width(),this.height=48,this.unhide()},showRegion:function(t){this.show(t.name,t.valueName+" ("+t.year+"): "+t.valueFormatted)},hide:function(){this.shown=!1,this.container.style("display","none")},unhide:function(){this.shown=!0,this.container.style("display","inline")}}),VariableControl=L.Control.extend({initialize:function(t,e,a){this.variables=t,this.selectedIndices=e,this.callback=a},options:{position:"topleft"},onAdd:function(t){function e(t){var e=t.property("value"),a=t.select("option[value='"+e+"']");return a.datum()}function a(){c.selectAll("option").remove(),_.contains(i.years,o)||(o=i.years[i.years.length-1]),c.selectAll("option").data(i.years).enter().append("option").property("selected",function(t){return t===o}).attr("value",function(t){return t}).text(function(t){return t})}var r=this,n=L.DomUtil.create("div","variable-container");this.container=d3.select(n);var i=this.variables[this.selectedIndices.variableSelectedIndex],o=i.years[this.selectedIndices.yearSelectedIndex],s=function(){r.callback(i,o)};s();var l=this.container.append("select").attr("class","variable-select").on("change",function(){i=e(l),a(),s()}),c=(l.selectAll("option").data(this.variables).enter().append("option").property("selected",function(t){return t===i}).attr("value",function(t){return t.name}).text(function(t){return t.name}),this.container.append("select").attr("class","year-select").on("change",function(){o=e(c),s()}));return a(),n}}),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),MapView=function(){function t(e,a,r,n,i){var o=this;_classCallCheck(this,t),this.source=e,this.regionType=a,this.regions=r,this.regionIDs=new Set(r.map(function(t){return t.id})),this.features=n,this.onDisplay=i,this.legend=new LegendControl,this.tooltip=new TooltipControl,this.variableControl=new VariableControl(e.variables,e.selectedIndices,function(t,e){o.display(t,e),o.onDisplay&&o.onDisplay(t,e)}),this.zoomControl=new L.Control.Zoom(MapConstants.ZOOM_CONTROL_OPTIONS),this._popups=[]}return _createClass(t,[{key:"show",value:function(t){var e=this,a=(d3.select(t).append("div").attr("class","map-container").attr("id",MapConstants.CSS_ID),L.map(MapConstants.CSS_ID,MapConstants.MAP_OPTIONS));this.map=a,a.setView(MapConstants.INITIAL_CENTER,MapConstants.INITIAL_ZOOM),a.addControl(this.legend),a.addControl(this.variableControl),a.addControl(this.tooltip),MapConstants.ZOOM_CONTROL&&a.addControl(this.zoomControl),a.whenReady(function(){var t=function(t){return"https://api.mapbox.com/v4/"+t+"/{z}/{x}/{y}.png?access_token="+MapConstants.MAPBOX_TOKEN},r=(L.tileLayer(t(MapConstants.BASE_LAYER_ID)).addTo(a),e.features.addTo(a),a.createPane("labels"));L.tileLayer(t(MapConstants.LABEL_LAYER_ID),{pane:r}).addTo(a);e.zoomToSelected(a)})}},{key:"zoomToSelected",value:function(t){var e=this,a=[];this.features.eachLayer(function(t){e.regionIDs.has(t.feature.id)&&a.push(t)});var r=new L.featureGroup(a);t.fitBounds(r.getBounds(),MapConstants.AUTO_ZOOM_OPTIONS),"choropleth"===this.regionType.type&&1===a.length&&t.zoomOut(MapConstants.AUTO_ZOOM_OUT,MapConstants.AUTO_ZOOM_OPTIONS)}},{key:"display",value:function(t,e){var a=this;MapModel.create(this.source,this.regionType,t,e).then(function(t){return a.update(t)})["catch"](function(t){throw t})}},{key:"update",value:function(t){var e=t.variable.stoplight?MapConstants.STOPLIGHT_COLOR_SCALE:MapConstants.COLOR_SCALE,a=t.scale(MapConstants.SCALE,e);this.updateLegend(t,a),this.updateFeatures(t,a)}},{key:"updateLegend",value:function(t,e){this.legend.update(e,t.variable,t.year)}},{key:"updateFeatures",value:function(e,a){var r=this;this.features.eachLayer(function(n){var i=e.regionById.get(n.feature.id);if(i&&!isNaN(i.value)){var o=r.regionIDs.has(i.id),s=a.scale(i.value),l=_.extend({},MapConstants.REFERENCE_STYLE,{fillColor:s}),c=o?_.extend(l,MapConstants.SELECTED_STYLE):l;if(n.setStyle(c),o&&r.map){if(!(i.id in r._popups)){var u=L.popup(MapConstants.POPUP_OPTIONS).setLatLng(t.center(n));r._popups[i.id]=u}var h='<div class="name">'+i.name+'</div>                        <div class="value">'+i.valueName+" ("+i.year+"):                        "+i.valueFormatted+"</div>";r._popups[i.id].setContent(h).addTo(r.map)}n.on({mouseover:function(){r.closePopups(),r.tooltip.showRegion(i)},mouseout:function(){return r.tooltip.hide()}})}else n.setStyle(MapConstants.NO_DATA_STYLE)})}},{key:"closePopups",value:function(){var t=this;_.values(this._popups).forEach(function(e){return t.map.closePopup(e)})}}],[{key:"center",value:function(t){if(t.getLatLng)return t.getLatLng();var e=t.getLatLngs(),a=L.latLngBounds(_.flatten(e));return a.getCenter()}},{key:"create",value:function(e,a,r){if(a.length<1)throw"regions cannot be empty";return new Promise(function(n,i){var o=MapConstants.REGIONS[a[0].type];void 0===o?i("invalid region type for map: "+a[0].type):!function(){var s=_.filter(a,function(t){return t.type==o.id});TopoModel.get(o).then(function(a){var i=t._features(a,"choropleth"==o.type);n(new t(e,o,s,i,r))},i)}()})}},{key:"_features",value:function(t,e){var a=function(){var t={stroke:!1},a=e?MapConstants.BASE_STYLE:_.extend({},MapConstants.BASE_STYLE,t);return{style:function(){return a}}},r=function(){var e=t.objects,a=t.objects[Object.keys(e)[0]].geometries,r=function(t){return t.properties.population},n=a.map(r),i=MapConstants.POINT_RADIUS_SCALE().domain(d3.extent(n)).range(MapConstants.POINT_RADIUS_RANGE_METERS);return{pointToLayer:function(t,e){return L.circle(e,i(r(t)))}}},n=e?a():_.extend({},a(),r()),i=L.geoJson(null,n);return omnivore.topojson.parse(t,null,i)}}]),t}(),format={integer:d3.format(",.0f"),percent:function(t){return d3.format(".2f")(t)+"%"},ratio:d3.format(".1%"),dollar:d3.format("$,.0f")},_slicedToArray=function(){function t(t,e){var a=[],r=!0,n=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(a.push(o.value),!e||a.length!==e);r=!0);}catch(l){n=!0,i=l}finally{try{!r&&s["return"]&&s["return"]()}finally{if(n)throw i}}return a}return function(e,a){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),DOMAIN="odn.data.socrata.com",MapSources={population:{name:"population",domain:DOMAIN,fxf:"e3rd-zzmr",hasPopulation:!0,variables:[{name:"Population",column:"population",years:[2009,2010,2011,2012,2013],format:format.integer,metric:"population_value"},{name:"Population Change",column:"population_percent_change",years:[2010,2011,2012,2013],format:format.percent,stoplight:!0,metric:"population_change"}]},earnings:{name:"earnings",domain:DOMAIN,fxf:"wmwh-4vak",hasPopulation:!0,variables:variableGenerator()([["Median Earnings","median_earnings",format.dollar,!0,"median_earnings"],["Median Female Earnings","female_median_earnings",format.dollar,!0,"female_median_earnings"],["Median Male Earnings","male_median_earnings",format.dollar,!0,"male_median_earnings"],["Median Female Earnings (Full Time)","female_full_time_median_earnings",format.dollar,!0,"female_full_time_median_earnings"],["Median Male Earnings (Full Time)","male_full_time_median_earnings",format.dollar,!0,"male_full_time_median_earnings"],["Percent Earning less than $10,000","percent_with_earnings_1_to_9999",format.percent,!1,"percent_with_earnings_1_to_9999"],["Percent Earning $10,000 to $14,999","percent_with_earnings_10000_to_14999",format.percent,!1,"percent_with_earnings_10000_to_14999"],["Percent Earning $15,000 to $24,999","percent_with_earnings_15000_to_24999",format.percent,!1,"percent_with_earnings_15000_to_24999"],["Percent Earning $25,000 to $34,999","percent_with_earnings_25000_to_34999",format.percent,!1,"percent_with_earnings_25000_to_34999"],["Percent Earning $35,000 to $49,999","percent_with_earnings_35000_to_49999",format.percent,!1,"percent_with_earnings_35000_to_49999"],["Percent Earning $50,000 to $64,999","percent_with_earnings_50000_to_64999",format.percent,!1,"percent_with_earnings_50000_to_64999"],["Percent Earning $65,000 to $74,999","percent_with_earnings_65000_to_74999",format.percent,!1,"percent_with_earnings_65000_to_74999"],["Percent Earning $75,000 to $99,999","percent_with_earnings_75000_to_99999",format.percent,!1,"percent_with_earnings_75000_to_99999"],["Percent Earning over $100,000","percent_with_earnings_over_100000",format.percent,!1,"percent_with_earnings_over_100000"]])
},education:{name:"education",domain:DOMAIN,fxf:"uf4m-5u8r",hasPopulation:!0,variables:variableGenerator()([["High School Graduation Rate","percent_high_school_graduate_or_higher",format.percent,!0,"percent_high_school_graduate_or_higher"],["College Graduation Rate","percent_bachelors_degree_or_higher",format.percent,!0,"percent_bachelors_degree_or_higher"]])},occupations:{name:"occupations",domain:DOMAIN,fxf:"qfcm-fw3i",hasPopulation:!0,variables:["Business and Finance","Computers and Math","Construction and Extraction","Education","Engineering","Farming, Fishing, Foresty","Fire Fighting","Food Service","Healthcare","Health Support","Health Technicians","Janitorial","Law Enforcement","Legal","Management","Material Moving","Media","Office and Administration","Personal Care","Production","Repair","Sales","Social Sciences","Social Services","Transportation"].map(function(t){return{name:t,column:"percent_employed",params:{occupation:t},years:[2013],format:format.percent,metric:""+t.toLowerCase().replace(/\s/g,"_").replace(/,/g,"")}})},gdp:{name:"gdp",domain:DOMAIN,fxf:"ks2j-vhr8",variables:[{name:"GDP per Capita",column:"per_capita_gdp",years:_.range(2001,2014),format:format.dollar,stoplight:!0,metric:"per_capita_gdp"},{name:"Annual Change in GDP",column:"per_capita_gdp_percent_change",years:_.range(2002,2014),format:format.percent,stoplight:!0,metric:"per_capita_gdp_change"}]},rpp:{name:"rpp",domain:DOMAIN,fxf:"hpnf-gnfu",variables:["All","Goods","Rents","Other"].map(function(t){return{name:t,column:"index",reverse:!0,params:{component:t},years:_.range(2008,2014),format:d3.format(".1f"),stoplight:!0,metric:t.toLowerCase()}})},health:{name:"health",domain:DOMAIN,fxf:"7ayp-utp2",variables:["Adult Smoking","Adult Obesity","Physical Inactivity","Excessive Drinking"].map(function(t){return{name:t+" Rate",column:t.toLowerCase().replace(/\s/g,"_")+"_value",years:[2015],reverse:!0,format:format.ratio,stoplight:!0,metric:t.toLowerCase().replace(/\s/g,"_")+"_rate"}})}},MapSummaryFormatters={population:{format:"0,0",suffix:""},population_percent_change:{format:"0.00",suffix:"%"},percent_high_school_graduate_or_higher:{format:"0.0",suffix:"%"},percent_bachelors_degree_or_higher:{format:"0.0",suffix:"%"},median_earnings:{format:"$0,0",suffix:""},female_median_earnings:{format:"$0,0",suffix:""},male_median_earnings:{format:"$0,0",suffix:""},female_full_time_median_earnings:{format:"$0,0",suffix:""},male_full_time_median_earnings:{format:"$0,0",suffix:""},percent_with_earnings_1_to_9999:{format:"0.0",suffix:"%"},percent_with_earnings_10000_to_14999:{format:"0.0",suffix:"%"},percent_with_earnings_15000_to_24999:{format:"0.0",suffix:"%"},percent_with_earnings_25000_to_34999:{format:"0.0",suffix:"%"},percent_with_earnings_35000_to_49999:{format:"0.0",suffix:"%"},percent_with_earnings_50000_to_64999:{format:"0.0",suffix:"%"},percent_with_earnings_65000_to_74999:{format:"0.0",suffix:"%"},percent_with_earnings_75000_to_99999:{format:"0.0",suffix:"%"},percent_with_earnings_over_100000:{format:"0.0",suffix:"%"},percent_employed:{format:"0.0",suffix:"%"},per_capita_gdp:{format:"$0,0",suffix:""},per_capita_gdp_percent_change:{format:"0.0",suffix:"%"},adult_smoking_value:{format:"0.0%",suffix:""},adult_obesity_value:{format:"0.0%",suffix:""},physical_inactivity_value:{format:"0.0%",suffix:""},excessive_drinking_value:{format:"0.0%",suffix:""}},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),MapSummary=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"getSummaryString",value:function(t,e,a,r,n){var i=this,o=t.map(function(t,o){var s=_.filter(e[o],n)[0];return"The {0} in {1} for {2} was {3}.".format(a.name.toLowerCase(),r,t.name,i.formatValue(a.column,s[a.column]))});return o.join(" ")}},{key:"getCostOfLivingSummaryString",value:function(t,e,a,r,n){var i=this,o=t.map(function(t,o){var s=_.filter(e[o],n)[0];return"all"==a.name.toLowerCase()?"The cost of living index in {0} for {1} was {2}.".format(r,t.name,i.formatValue(a.column,s[a.column])):"The cost of living index for {0} in {1} for {2} was {3}.".format(a.name.toLowerCase(),r,t.name,i.formatValue(a.column,s[a.column]))});return o.join(" ")}},{key:"getOccupationsSummaryString",value:function(t,e,a,r,n){var i=this,o=t.map(function(t,o){var s=_.filter(e[o],n)[0];return"The percent working in {0} in {1} for {2} was {3}.".format(a.name.toLowerCase(),r,t.name,i.formatValue(a.column,s[a.column]))});return o.join(" ")}},{key:"formatValue",value:function(t,e){if(t in MapSummaryFormatters){var a=MapSummaryFormatters[t];return numeral(e).format(a.format)+a.suffix}return e}}]),t}(),_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),SearchPageController=function(){function t(e,a,r){function n(t){RegionLookup.byID(t.id).then(function(t){o.setAutoSuggestedRegion({id:t.id,name:t.name},!1),o.navigate()},function(t){throw t})}var i=this;_classCallCheck(this,t),this.params=e,this.tableData=a,this.mapVariables=r,this.fetching=!1,this.fetchedAll=!1,this.mostSimilar=[];var o=this;$(".refine-link").mouseenter(function(){$(this).addClass("refine-link-selected"),$(this).children("span").children("i").removeClass("fa-caret-down").addClass("fa-caret-up"),$(this).children("ul").slideDown(100)}),$(".refine-link").mouseleave(function(){$(this).removeClass("refine-link-selected"),$(this).children("span").children("i").removeClass("fa-caret-up").addClass("fa-caret-down"),$(this).children("ul").slideUp(100)}),this.attachCategoriesClickHandlers(),$("#refine-menu-categories-view-more").click(function(){var t=new ApiController;t.getCategories().then(function(t){var e=t.results.map(function(t){return'<li><i class="fa '+t.metadata.icon+'"></i>'+t.category+"</li>"}),a=e.join("");$("#refine-menu-categories").html(a),o.attachCategoriesClickHandlers()})["catch"](function(t){return console.error(t)})}),this.attachDomainsClickHandlers(),$("#refine-menu-domains-view-more").click(function(){var t=new ApiController;t.getDomains().then(function(t){var e=t.results.map(function(t){return"<li>"+t.domain+"</li>"}),a=e.join("");$("#refine-menu-domains").html(a),o.attachDomainsClickHandlers()})["catch"](function(t){return console.error(t)})}),this.attachTagsClickHandlers(),$(".region-token .fa-times-circle").click(function(){o.removeRegion($(this).parent().index()),o.navigate()}),$(".category-token .fa-times-circle").click(function(){o.toggleCategory($(this).parent().text().toLowerCase().trim()),o.navigate()}),$(".domain-token .fa-times-circle").click(function(){o.toggleDomain($(this).parent().text().toLowerCase().trim()),o.navigate()}),$(".standard-token .fa-times-circle").click(function(){o.toggleTag($(this).parent().text().toLowerCase().trim()),o.navigate()}),$(window).on("scroll",function(){var t=1e3;$(window).scrollTop()>=$(document).height()-$(window).height()-t&&o.fetchNextPage()}).scroll();var s=regionsWithData(this.params.vector,n),l=new Autosuggest(".add-region-results",s);if(l.listen(".add-region-input"),$(".add-region .fa-plus").click(function(){$('.add-region input[type="text"]').focus()}),this.params.regions.length>0)switch(this.params.vector){case"cost_of_living":this.drawCostOfLivingData();break;case"earnings":this.drawEarningsData();break;case"education":this.drawEducationData();break;case"gdp":this.drawGdpData();break;case"health":this.drawHealthData();break;case"occupations":this.drawOccupationsData();break;case"population":this.drawPopulationData();break;default:this.drawPopulationData()}$(".map-summary-more").click(function(){$(".map-summary-links").slideToggle(100),$(".map-summary-more").text("More Information"==$(".map-summary-more").text()?"Less Information":"More Information")}),$(window).resize(function(){$("#education-table-container").length&&i.drawEducationTable(),$("#earnings-table-container").length&&i.drawEarningsTable(),$("#cost-of-living-table-container").length&&i.drawCostOfLivingTable(),$("#health-outcomes-table-container").length&&i.drawHealthTables()})}return _createClass(t,[{key:"drawMap",value:function(t,e){var a="#map",r=this.params.regions;_.extend(t,{selectedIndices:this.mapVariables}),MapView.create(t,r,e).then(function(t){return t.show(a)},function(t){return console.warn(t)})}},{key:"drawMapSummaryLinks",value:function(t,e,a){var r=this,n=_.filter(t.variables,function(t){return t.name!=e.name}),i=$(".map-summary-links").empty();$.each(n,function(t){var e=n[t],o=$("<li/>").appendTo(i);$("<a/>").attr("href",r.getSearchPageUrl(!1,e.metric,a)).text(e.name).appendTo(o)})}},{key:"attachCategoriesClickHandlers",value:function(){var t=this;$("#refine-menu-categories li:not(.refine-view-more)").click(function(){t.toggleCategory($(this).text().toLowerCase().trim()),t.navigate()})}},{key:"attachDomainsClickHandlers",value:function(){var t=this;$("#refine-menu-domains li:not(.refine-view-more)").click(function(){var e=$(this).text().toLowerCase().trim();t.toggleDomain(e),t.navigate()})}},{key:"attachTagsClickHandlers",value:function(){var t=this;$("#refine-menu-tags li").click(function(){var e=$(this).text().toLowerCase().trim();t.toggleTag(e),t.navigate()})}},{key:"decrementPage",value:function(){this.params.page--}},{key:"drawCostOfLivingData",value:function(){var t=this;this.drawMap(MapSources.rpp,function(e,a){return t.drawCostOfLivingMapSummary(e,a)}),this.drawCostOfLivingChart(),this.drawCostOfLivingTable()}},{key:"drawCostOfLivingMapSummary",value:function(t,e){$(".map-summary").text(MapSummary.getCostOfLivingSummaryString(this.params.regions,this.tableData.costOfLivingData,t,e,function(t){return e==t.year})),this.drawMapSummaryLinks(MapSources.rpp,t,e)}},{key:"drawCostOfLivingChart",value:function(){this.drawCostOfLivingChartForComponent("cost-of-living-all-chart","All"),this.drawCostOfLivingChartForComponent("cost-of-living-goods-chart","Goods"),this.drawCostOfLivingChartForComponent("cost-of-living-rents-chart","Rents"),this.drawCostOfLivingChartForComponent("cost-of-living-other-chart","Other")}},{key:"drawCostOfLivingChartForComponent",value:function(t,e){for(var a=[],r=["Year"],n=0;n<this.params.regions.length;n++)r.push(this.params.regions[n].name);a.push(r);for(var i={},n=0;n<this.tableData.costOfLivingData.length;n++)for(var o=this.tableData.costOfLivingData[n],s=0;s<o.length;s++)o[s].component==e&&(void 0==i[o[s].year]&&(i[o[s].year]=[o[s].year]),i[o[s].year].push(parseFloat(o[s].index)));for(var l in i)a.push(i[l]);var c=google.visualization.arrayToDataTable(a);this.drawLineChart(t,c,{curveType:"function",legend:{position:"bottom"},pointShape:"square",pointSize:8,title:e})}},{key:"drawCostOfLivingTable",value:function(){var t=$(window).width();this.params.regions.length>=3||t>=1600?this.drawCostOfLivingTableHorizontal():this.drawCostOfLivingTableVertical()}},{key:"drawCostOfLivingTableVertical",value:function(){if(!this.ensureVisibleWithOrientation("#cost-of-living-table-container table","vertical")){var t='<table class="vertical">';t+="<tr>",t+='<th class="empty"></th>';for(var e=0;e<this.tableData.costOfLivingData.length;e++)t+='<th colspan="2" class="color-'+e+'">'+this.params.regions[e].name+"<div></div></th>";t+="</tr>",t+='<tr class="sub-header-row"><td class="empty"></td>';for(var e=0;e<this.tableData.costOfLivingData.length;e++)t+='<td>Value</td><td class="color-'+e+'">Percentile<div></div></td>';t+="</tr>";for(var a=["All","Goods","Other","Rents"],e=0;e<a.length;e++){t+="<tr>",t+='<td class="category-header">'+a[e]+"</td>";for(var r=0;r<this.params.regions.length;r++){var n=this.getLatestCostOfLiving(this.tableData.costOfLivingData[r],this.params.regions[r].id,a[e]),i=null!=n?parseFloat(n.index):"NA",o=null!=n?this.getPercentile(n.rank,n.total_ranks):"NA";t+="<td>"+i+"<div></div></td>",t+='<td class="color-'+r+'">'+o+"<div></div></td>"}t+="</tr>"}t+="</table>",$("#cost-of-living-table-container").html(t)}}},{key:"drawCostOfLivingTableHorizontal",value:function(){if(!this.ensureVisibleWithOrientation("#cost-of-living-table-container table","horizontal")){var t='<table class="horizontal">';t+="<tr>",t+='<td class="empty"></td>',t+='<td class="category-header">All<br>(Value)</td>',t+='<td class="category-header">All<br>(Percentile)</td>',t+='<td class="category-header">Goods<br>(Value)</td>',t+='<td class="category-header">Goods<br>(Percentile)</td>',t+='<td class="category-header">Other<br>(Value)</td>',t+='<td class="category-header">Other<br>(Percentile)</td>',t+='<td class="category-header">Rents<br>(Value)</td>',t+='<td class="category-header">Rents<br>(Percentile)</td>',t+="</tr>";for(var e=["All","Goods","Other","Rents"],a=0;a<this.params.regions.length;a++){t+='<tr class="color-'+a+'">',t+="<td>"+this.params.regions[a].name+"<div></div></td>";for(var r=0;r<e.length;r++){var n=this.getLatestCostOfLiving(this.tableData.costOfLivingData[a],this.params.regions[a].id,e[r]),i=null!=n?parseFloat(n.index):"NA",o=null!=n?this.getPercentile(n.rank,n.total_ranks):"NA";t+="<td>"+i+"<div></div></td>",t+="<td>"+o+"<div></div></td>"}t+="</tr>"}t+="</table>",$("#cost-of-living-table-container").html(t)}}},{key:"getPercentile",value:function(t,e){var a=parseInt(e),r=parseInt(t),n=parseInt((a-r)/a*100);return numeral(n).format("0o")}},{key:"getLatestCostOfLiving",value:function(t,e,a){for(var r=null,n=0;n<t.length;n++)t[n].id==e&&t[n].component==a&&(null!=r?parseInt(t[n].year)<=parseInt(r.year)||(r=t[n]):r=t[n]);return r}},{key:"drawEarningsData",value:function(){var t=this;this.drawMap(MapSources.earnings,function(e,a){return t.drawEarningsMapSummary(e,a)}),this.drawEarningsChart(),this.drawEarningsTable()}},{key:"drawEarningsMapSummary",value:function(t,e){$(".map-summary").text(MapSummary.getSummaryString(this.params.regions,this.tableData.earningsData,t,e,function(t){return e==t.year})),this.drawMapSummaryLinks(MapSources.earnings,t,e)}},{key:"drawEarningsChart",value:function(){for(var t=[],e=["Education Level"],a=0;a<this.params.regions.length;a++)e.push(this.params.regions[a].name);t.push(e);for(var r=["Some High School"],a=0;a<this.params.regions.length;a++)r.push(parseInt(this.tableData.earningsData[a][0].median_earnings_less_than_high_school));t.push(r);for(var n=["High School"],a=0;a<this.params.regions.length;a++)n.push(parseInt(this.tableData.earningsData[a][0].median_earnings_high_school));t.push(n);for(var i=["Some College"],a=0;a<this.params.regions.length;a++)i.push(parseInt(this.tableData.earningsData[a][0].median_earnings_some_college_or_associates));t.push(i);for(var o=["Bachelor's"],a=0;a<this.params.regions.length;a++)o.push(parseInt(this.tableData.earningsData[a][0].median_earnings_bachelor_degree));t.push(o);for(var s=["Graduate Degree"],a=0;a<this.params.regions.length;a++)s.push(parseInt(this.tableData.earningsData[a][0].median_earnings_graduate_or_professional_degree));t.push(s);for(var l=google.visualization.arrayToDataTable(t),c=new google.visualization.NumberFormat({pattern:"$###,###"}),a=0;a<this.params.regions.length;a++)c.format(l,a+1);this.drawSteppedAreaChart("earnings-chart",l,{areaOpacity:0,connectSteps:!0,curveType:"function",focusTarget:"category",legend:{position:"bottom"},title:"Earnings by Education Level",vAxis:{format:"currency"}})}},{key:"drawEarningsTable",value:function(){var t=$(window).width();this.params.regions.length>=3||t>=1600?this.drawEarningsTableHorizontal():this.drawEarningsTableVertical()}},{key:"drawEarningsTableVertical",value:function(){if(!this.ensureVisibleWithOrientation("#earnings-table-container table","vertical")){var t='<table class="vertical">';t+="<tr>",t+='<th class="empty"></th>';for(var e=0;e<this.tableData.earningsData.length;e++)t+='<th class="color-'+e+'">'+this.params.regions[e].name+"<div></div></th>";t+="</tr>",t+='<tr><td class="category-header">Median Earnings<br>(All Workers)</td>';for(var e=0;e<this.tableData.earningsData.length;e++)t+='<td class="color-'+e+'">'+numeral(this.tableData.earningsData[e][0].median_earnings).format("$0,0")+"<div></div></td>";t+="</tr>",t+='<tr><td class="category-header">Median Female Earnings<br>(Full Time)</td>';for(var e=0;e<this.tableData.earningsData.length;e++)t+='<td class="color-'+e+'">'+numeral(this.tableData.earningsData[e][0].female_full_time_median_earnings).format("$0,0")+"<div></div></td>";t+="</tr>",t+='<tr><td class="category-header">Median Male Earnings<br>(Full Time)</td>';for(var e=0;e<this.tableData.earningsData.length;e++)t+='<td class="color-'+e+'">'+numeral(this.tableData.earningsData[e][0].male_full_time_median_earnings).format("$0,0")+"<div></div></td>";t+="</tr>",t+="</table>",$("#earnings-table-container").html(t)}}},{key:"drawEarningsTableHorizontal",value:function(){if(!this.ensureVisibleWithOrientation("#earnings-table-container table","horizontal")){var t='<table class="horizontal">';t+="<tr>",t+='<td class="empty"></td>',t+='<td class="category-header">Median Earnings<br>(All Workers)</td>',t+='<td class="category-header">Median Female Earnings<br>(Full Time)</td>',t+='<td class="category-header">Median Male Earnings<br>(Full Time)</td>',t+="</tr>";for(var e=0;e<this.tableData.earningsData.length;e++)t+='<tr class="color-'+e+'">',t+="<td>"+this.params.regions[e].name+"<div></div></td>",t+="<td>"+numeral(this.tableData.earningsData[e][0].median_earnings).format("$0,0")+"<div></div></td>",t+="<td>"+numeral(this.tableData.earningsData[e][0].female_full_time_median_earnings).format("$0,0")+"<div></div></td>",t+="<td>"+numeral(this.tableData.earningsData[e][0].male_full_time_median_earnings).format("$0,0")+"<div></div></td>",t+="</tr>";t+="</table>",$("#earnings-table-container").html(t)}}},{key:"drawHealthData",value:function(){var t=this;this.drawMap(MapSources.health,function(e,a){return t.drawHealthMapSummary(e,a)}),this.drawHealthTables()}},{key:"drawHealthMapSummary",value:function(t,e){$(".map-summary").text(MapSummary.getSummaryString(this.params.regions,this.tableData.healthData,t,e,function(t){return e==t.year})),this.drawMapSummaryLinks(MapSources.health,t,e)}},{key:"drawHealthTables",value:function(){var t=$(window).width();this.params.regions.length>=8||t>=1600?this.drawHealthTablesHorizontal():this.drawHealthTablesVertical()}},{key:"drawHealthTablesVertical",value:function(){this.ensureVisibleWithOrientation("#health-outcomes-table-container table","vertical")||(this.drawHealthOutcomesTableVertical(),this.drawHealthFactorsTableVertical(),this.drawHealthClinicalCareTableVertical(),this.drawHealthSocialEconomicFactorsTableVertical(),this.drawHealthPhysicalEnvironmentTableVertical())}},{key:"drawHealthTablesHorizontal",value:function(){this.ensureVisibleWithOrientation("#health-outcomes-table-container table","horizontal")||(this.drawHealthOutcomesTableHorizontal(),this.drawHealthFactorsTableHorizontal(),this.drawHealthClinicalCareTableHorizontal(),this.drawHealthSocialEconomicFactorsTableHorizontal(),this.drawHealthPhysicalEnvironmentTableHorizontal())}},{key:"drawHealthOutcomesTableVertical",value:function(){var t='<table class="vertical">';t+="<tr>",t+='<th class="sub-header">Life Length</th>';for(var e=0;e<this.tableData.healthData.length;e++)t+='<th class="color-'+e+'">'+this.params.regions[e].name+"<div></div></th>";t+="</tr>",t+=this.drawHealthTableRowVertical("Premature Death","premature_death_value","0,0"),t+="</table>",t+='<table class="vertical">',t+="<tr>",t+='<th class="sub-header">Quality of Life</th>';for(var e=0;e<this.tableData.healthData.length;e++)t+='<th class="color-'+e+'">'+this.params.regions[e].name+"<div></div></th>";t+="</tr>",t+=this.drawHealthTableRowVertical("Poor or Fair Health","poor_or_fair_health_value","0.0%"),t+=this.drawHealthTableRowVertical("Poor Physical Health Days","poor_physical_health_days_value","0.0"),t+=this.drawHealthTableRowVertical("Poor Mental Health Days","poor_mental_health_days_value","0.0"),t+=this.drawHealthTableRowVertical("Low Birth Weight","low_birthweight_value","0.0"),t+="</table>",$("#health-outcomes-table-container").html(t)}},{key:"drawHealthOutcomesTableHorizontal",value:function(){var t='<table class="horizontal">';t+="<tr>",t+='<th class="empty"></th>',t+="<th>Life Length</th>",t+='<th class="empty"></th>',t+='<th colspan="4">Quality of Life</th>',t+="</tr>",t+="<tr>",t+='<td class="empty"></td>',t+='<td class="category-header">Premature Death</td>',t+='<td class="empty"></td>',t+='<td class="category-header">Poor or Fair Health</td>',t+='<td class="category-header">Poor Physical Health Days</td>',t+='<td class="category-header">Poor Mental Health Days</td>',t+='<td class="category-header">Low Birth Weight</td>',t+="</tr>";for(var e=0;e<this.tableData.healthData.length;e++){var a=this.tableData.healthData[e][0];t+='<tr class="color-'+e+'">',t+="<td>"+this.params.regions[e].name+"<div></div></td>",t+=this.drawHealthTableCellHorizontal(a,"premature_death_value","0,0"),t+='<td class="empty"></td>',t+=this.drawHealthTableCellHorizontal(a,"poor_or_fair_health_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"poor_physical_health_days_value","0.0"),t+=this.drawHealthTableCellHorizontal(a,"poor_mental_health_days_value","0.0"),t+=this.drawHealthTableCellHorizontal(a,"low_birthweight_value","0.0"),t+="</tr>"}t+="</table>",$("#health-outcomes-table-container").html(t)}},{key:"drawHealthFactorsTableVertical",value:function(){var t='<table class="vertical">';t+="<tr>",t+='<th class="sub-header">Health Behaviors</th>';for(var e=0;e<this.tableData.healthData.length;e++)t+='<th class="color-'+e+'">'+this.params.regions[e].name+"<div></div></th>";t+="</tr>",t+=this.drawHealthTableRowVertical("Adult Smoking","adult_smoking_value","0.0%"),t+=this.drawHealthTableRowVertical("Adult Obesity","adult_obesity_value","0.0%"),t+=this.drawHealthTableRowVertical("Food Environment Index","food_environment_index_value","0.0"),t+=this.drawHealthTableRowVertical("Physical Inactivity","physical_inactivity_value","0.0%"),t+=this.drawHealthTableRowVertical("Access to Exercise","access_to_exercise_opportunities_value","0.0%"),t+=this.drawHealthTableRowVertical("Excessive Drinking","excessive_drinking_value","0.0%"),t+=this.drawHealthTableRowVertical("Alcohol Impaired Driving Deaths","alcohol_impaired_driving_deaths_value","0.0%"),t+=this.drawHealthTableRowVertical("Sexually Transmitted Infections","sexually_transmitted_infections_value","0,0"),t+=this.drawHealthTableRowVertical("Teen Births","teen_births_value","0,0"),t+="</table>",$("#health-factors-table-container").html(t)}},{key:"drawHealthFactorsTableHorizontal",value:function(){var t='<table class="horizontal">';t+="<tr>",t+='<th class="empty"></th>',t+='<th colspan="9">Health Behaviors</th>',t+="</tr>",t+="<tr>",t+='<td class="empty"></td>',t+='<td class="category-header">Adult Smoking</td>',t+='<td class="category-header">Adult Obesity</td>',t+='<td class="category-header">Food Environment Index</td>',t+='<td class="category-header">Physical Inactivity</td>',t+='<td class="category-header">Access to Exercise</td>',t+='<td class="category-header">Excessive Drinking</td>',t+='<td class="category-header">Alcohol Impaired Driving Deaths</td>',t+='<td class="category-header">Sexually Transmitted Infections</td>',t+='<td class="category-header">Teen Births</td>',t+="</tr>";for(var e=0;e<this.params.regions.length;e++){var a=this.tableData.healthData[e][0];t+='<tr class="color-'+e+'">',t+="<td>"+this.params.regions[e].name+"<div></div></td>",t+=this.drawHealthTableCellHorizontal(a,"adult_smoking_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"adult_obesity_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"food_environment_index_value","0.0"),t+=this.drawHealthTableCellHorizontal(a,"physical_inactivity_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"access_to_exercise_opportunities_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"excessive_drinking_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"alcohol_impaired_driving_deaths_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"sexually_transmitted_infections_value","0,0"),t+=this.drawHealthTableCellHorizontal(a,"teen_births_value","0,0"),t+="</tr>"}t+="</table>",$("#health-factors-table-container").html(t)}},{key:"drawHealthClinicalCareTableVertical",value:function(){var t='<table class="vertical">';t+="<tr>",t+='<th class="sub-header">Clinical Care</th>';for(var e=0;e<this.tableData.healthData.length;e++)t+='<th class="color-'+e+'">'+this.params.regions[e].name+"<div></div></th>";t+="</tr>",t+=this.drawHealthTableRowVertical("Uninsured","uninsured_value","0.0%"),t+=this.drawHealthTableRowVertical("Primary Care Physicians","primary_care_physicians_value","0,0"),t+=this.drawHealthTableRowVertical("Dentists","dentists_value","0,0"),t+=this.drawHealthTableRowVertical("Mental Health Providers","mental_health_providers_value","0,0"),t+=this.drawHealthTableRowVertical("Preventable Hospital Stays","preventable_hospital_stays_value","0,0"),t+=this.drawHealthTableRowVertical("Diabetic Monitoring","diabetic_screening_value","0.0%"),t+=this.drawHealthTableRowVertical("Mammography Screening","mammography_screening_value","0.0%"),t+="</table>",$("#health-clinical-care-table-container").html(t)}},{key:"drawHealthClinicalCareTableHorizontal",value:function(){var t='<table class="horizontal">';t+="<tr>",t+='<th class="empty"></th>',t+='<th colspan="7">Clinical Care</th>',t+="</tr>",t+="<tr>",t+='<td class="empty"></td>',t+='<td class="category-header">Uninsured</td>',t+='<td class="category-header">Primary Care Physicians</td>',t+='<td class="category-header">Dentists</td>',t+='<td class="category-header">Mental Health Providers</td>',t+='<td class="category-header">Preventable Hospital Stays</td>',t+='<td class="category-header">Diabetic Monitoring</td>',t+='<td class="category-header">Mammography Screening</td>',t+="</tr>";for(var e=0;e<this.params.regions.length;e++){var a=this.tableData.healthData[e][0];t+='<tr class="color-'+e+'">',t+="<td>"+this.params.regions[e].name+"<div></div></td>",t+=this.drawHealthTableCellHorizontal(a,"uninsured_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"primary_care_physicians_value","0,0"),t+=this.drawHealthTableCellHorizontal(a,"dentists_value","0,0"),t+=this.drawHealthTableCellHorizontal(a,"mental_health_providers_value","0,0"),t+=this.drawHealthTableCellHorizontal(a,"preventable_hospital_stays_value","0,0"),t+=this.drawHealthTableCellHorizontal(a,"diabetic_screening_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"mammography_screening_value","0.0%"),t+="</tr>"}t+="</table>",$("#health-clinical-care-table-container").html(t)}},{key:"drawHealthSocialEconomicFactorsTableVertical",value:function(){var t='<table class="vertical">';t+="<tr>",t+='<th class="sub-header">Social &amp; Economic Factors</th>';for(var e=0;e<this.tableData.healthData.length;e++)t+='<th class="color-'+e+'">'+this.params.regions[e].name+"<div></div></th>";t+="</tr>",t+=this.drawHealthTableRowVertical("High School Graduation","high_school_graduation_value","0.0%"),t+=this.drawHealthTableRowVertical("Some College","some_college_value","0.0%"),t+=this.drawHealthTableRowVertical("Unemployment","unemployment_value","0.0%"),t+=this.drawHealthTableRowVertical("Children in Poverty","children_in_poverty_value","0.0%"),t+=this.drawHealthTableRowVertical("Income Inequality","income_inequality_value","0.0"),t+=this.drawHealthTableRowVertical("Children in Single-Parent Households","children_in_single_parent_households_value","0.0%"),t+=this.drawHealthTableRowVertical("Social Associations","social_associations_value","0.0"),t+=this.drawHealthTableRowVertical("Violent Crime","violent_crime_value","0.0"),t+=this.drawHealthTableRowVertical("Injury Deaths","injury_deaths_value","0.0"),t+="</table>",$("#health-social-economic-factors-table-container").html(t)}},{key:"drawHealthSocialEconomicFactorsTableHorizontal",value:function(){var t='<table class="horizontal">';t+="<tr>",t+='<th class="empty"></th>',t+='<th colspan="9">Social &amp; Economic Factors</th>',t+="</tr>",t+="<tr>",t+='<td class="empty"></td>',t+='<td class="category-header">High School Graduation</td>',t+='<td class="category-header">Some College</td>',t+='<td class="category-header">Unemployment</td>',t+='<td class="category-header">Children in Poverty</td>',t+='<td class="category-header">Income Inequality</td>',t+='<td class="category-header">Children in Single-Parent Households</td>',t+='<td class="category-header">Social Associations</td>',t+='<td class="category-header">Violent Crime</td>',t+='<td class="category-header">Injury Deaths</td>',t+="</tr>";for(var e=0;e<this.params.regions.length;e++){var a=this.tableData.healthData[e][0];t+='<tr class="color-'+e+'">',t+="<td>"+this.params.regions[e].name+"<div></div></td>",t+=this.drawHealthTableCellHorizontal(a,"high_school_graduation_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"some_college_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"unemployment_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"children_in_poverty_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"income_inequality_value","0.0"),t+=this.drawHealthTableCellHorizontal(a,"children_in_single_parent_households_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"social_associations_value","0.0"),t+=this.drawHealthTableCellHorizontal(a,"violent_crime_value","0.0"),t+=this.drawHealthTableCellHorizontal(a,"injury_deaths_value","0.0"),t+="</tr>"}t+="</table>",$("#health-social-economic-factors-table-container").html(t)}},{key:"drawHealthPhysicalEnvironmentTableVertical",value:function(){var t='<table class="vertical">';t+="<tr>",t+='<th class="sub-header">Physical Environment</th>';for(var e=0;e<this.tableData.healthData.length;e++)t+='<th class="color-'+e+'">'+this.params.regions[e].name+"<div></div></th>";t+="</tr>",t+=this.drawHealthTableRowVertical("Air Pollution - Particulate Matter","air_pollution_particulate_matter_value","0.0"),t+=this.drawHealthTableRowVertical("Drinking Water Violations","drinking_water_violations_value","0.0%"),t+=this.drawHealthTableRowVertical("Severe Housing Problems","severe_housing_problems_value","0.0%"),t+=this.drawHealthTableRowVertical("Driving Alone to Work","driving_alone_to_work_value","0.0%"),t+=this.drawHealthTableRowVertical("Long Commute - Driving Alone","long_commute_driving_alone_value","0.0%"),t+="</table>",$("#health-physical-environment-table-container").html(t)}},{key:"drawHealthPhysicalEnvironmentTableHorizontal",value:function(){var t='<table class="horizontal">';t+="<tr>",t+='<th class="empty"></th>',t+='<th colspan="5">Physical Environment</th>',t+="</tr>",t+="<tr>",t+='<td class="empty"></td>',t+='<td class="category-header">Air Pollution - Particulate Matter</td>',t+='<td class="category-header">Drinking Water Violations</td>',t+='<td class="category-header">Severe Housing Problems</td>',t+='<td class="category-header">Driving Alone to Work</td>',t+='<td class="category-header">Long Commute - Driving Alone</td>',t+="</tr>";for(var e=0;e<this.params.regions.length;e++){var a=this.tableData.healthData[e][0];t+='<tr class="color-'+e+'">',t+="<td>"+this.params.regions[e].name+"<div></div></td>",t+=this.drawHealthTableCellHorizontal(a,"air_pollution_particulate_matter_value","0.0"),t+=this.drawHealthTableCellHorizontal(a,"drinking_water_violations_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"severe_housing_problems_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"driving_alone_to_work_value","0.0%"),t+=this.drawHealthTableCellHorizontal(a,"long_commute_driving_alone_value","0.0%"),t+="</tr>"}t+="</table>",$("#health-physical-environment-table-container").html(t)}},{key:"drawHealthTableRowVertical",value:function(t,e,a){for(var r='<tr><td class="category-header">'+t+"</td>",n=0;n<this.tableData.healthData.length;n++){
var i=this.tableData.healthData[n][0];r+=this.drawHealthDataTableCellVertical(n,i,e,a)}return r+="</tr>"}},{key:"drawHealthDataTableCellVertical",value:function(t,e,a,r){var n='<td class="color-'+t+'">';return n+=void 0!=e[a]?numeral(e[a].replace(",","")).format(r):"",n+="<div></div></td>"}},{key:"drawHealthTableCellHorizontal",value:function(t,e,a){var r="<td>";return r+=void 0!=t[e]?numeral(t[e].replace(",","")).format(a):"",r+="<div></div></td>"}},{key:"drawEducationData",value:function(){var t=this;this.drawMap(MapSources.education,function(e,a){return t.drawEducationMapSummary(e,a)}),this.drawEducationTable()}},{key:"drawEducationMapSummary",value:function(t,e){$(".map-summary").text(MapSummary.getSummaryString(this.params.regions,this.tableData.educationData,t,e,function(t){return e==t.year})),this.drawMapSummaryLinks(MapSources.education,t,e)}},{key:"drawEducationTable",value:function(){var t=$(window).width();this.params.regions.length>=3||t>=1600?this.drawEducationTableHorizontal():this.drawEducationTableVertical()}},{key:"drawEducationTableVertical",value:function(){if(!this.ensureVisibleWithOrientation("#education-table-container table","vertical")){var t='<table class="vertical">';t+="<tr>",t+='<th class="empty"></th>';for(var e=0;e<this.tableData.educationData.length;e++)t+='<th colspan="2" class="color-'+e+'">'+this.params.regions[e].name+"<div></div></th>";t+="</tr>",t+='<tr class="sub-header-row"><td class="empty"></td>';for(var e=0;e<this.tableData.educationData.length;e++)t+='<td>Percent</td><td class="color-'+e+'">Percentile<div></div></td>';t+='<tr><td class="category-header">At Least Bachelor\'s Degree</td>';for(var e=0;e<this.tableData.educationData.length;e++){var a=this.tableData.educationData[e][0],r=parseInt(a.total_ranks),n=parseInt(a.percent_bachelors_degree_or_higher_rank),i=parseInt((r-n)/r*100);t+="<td>"+numeral(a.percent_bachelors_degree_or_higher).format("0.0")+"%</td>",t+='<td class="color-'+e+'">'+numeral(i).format("0o")+"<div></div></td>"}t+="</tr>",t+='<tr><td class="category-header">At Least High School Diploma</td>';for(var e=0;e<this.tableData.educationData.length;e++){var a=this.tableData.educationData[e][0],r=parseInt(a.total_ranks),o=parseInt(a.percent_high_school_graduate_or_higher_rank),s=parseInt((r-o)/r*100);t+="<td>"+numeral(a.percent_high_school_graduate_or_higher).format("0.0")+"%</td>",t+='<td class="color-'+e+'">'+numeral(s).format("0o")+"<div></div></td>"}t+="</tr>",t+="</table>",$("#education-table-container").html(t)}}},{key:"drawEducationTableHorizontal",value:function(){if(!this.ensureVisibleWithOrientation("#education-table-container table","horizontal")){var t='<table class="horizontal">';t+="<tr>",t+='<td class="empty"></td>',t+='<td class="category-header">At Least Bachelor\'s Degree<br>(Percent)</td>',t+='<td class="category-header">At Least Bachelor\'s Degree<br>(Percentile)</td>',t+='<td class="category-header">At Least High School Diploma<br>(Percent)</td>',t+='<td class="category-header">At Least High School Diploma<br>(Percentile)</td>',t+="</tr>";for(var e=0;e<this.tableData.educationData.length;e++){var a=this.tableData.educationData[e][0];t+='<tr class="color-'+e+'">',t+="<td>"+this.params.regions[e].name+"<div></div></td>";var r=parseInt(a.total_ranks),n=parseInt(a.percent_bachelors_degree_or_higher_rank),i=parseInt((r-n)/r*100);t+="<td>"+numeral(a.percent_bachelors_degree_or_higher).format("0.0")+"%<div></div></td>",t+="<td>"+numeral(i).format("0o")+"<div></div></td>";var o=parseInt(a.percent_high_school_graduate_or_higher_rank),s=parseInt((r-o)/r*100);t+="<td>"+numeral(a.percent_high_school_graduate_or_higher).format("0.0")+"%<div></div></td>",t+="<td>"+numeral(s).format("0o")+"<div></div></td>",t+="</tr>"}t+="</table>",$("#education-table-container").html(t)}}},{key:"drawGdpData",value:function(){var t=this;this.drawMap(MapSources.gdp,function(e,a){return t.drawGdpMapSummary(e,a)}),this.drawGdpChart(),this.drawGdpChangeChart()}},{key:"drawGdpMapSummary",value:function(t,e){$(".map-summary").text(MapSummary.getSummaryString(this.params.regions,this.tableData.gdpData,t,e,function(t){return e==t.year})),this.drawMapSummaryLinks(MapSources.gdp,t,e)}},{key:"drawGdpChart",value:function(){for(var t=[],e=["Year"],a=0;a<this.params.regions.length;a++)e[a+1]=this.params.regions[a].name;t.push(e);for(var r={},a=0;a<this.tableData.gdpData.length;a++)for(var n=this.tableData.gdpData[a],i=0;i<n.length;i++)void 0==r[n[i].year]&&(r[n[i].year]=[n[i].year]),r[n[i].year].push(parseFloat(n[i].per_capita_gdp));for(var o in r)t.push(r[o]);for(var s=google.visualization.arrayToDataTable(t),l=new google.visualization.NumberFormat({pattern:"$###,###"}),a=0;a<this.params.regions.length;a++)l.format(s,a+1);this.drawLineChart("per-capita-gdp-chart",s,{curveType:"function",legend:{position:"bottom"},pointShape:"square",pointSize:8,title:"Per Capita Real GDP over Time",vAxis:{format:"$###,###"}})}},{key:"drawGdpChangeChart",value:function(){for(var t=[],e=["Year"],a=0;a<this.params.regions.length;a++)e[a+1]=this.params.regions[a].name;t.push(e);for(var r={},a=0;a<this.tableData.gdpData.length;a++)for(var n=this.tableData.gdpData[a],i=0;i<n.length;i++)void 0==r[n[i].year]&&(r[n[i].year]=[n[i].year]),r[n[i].year].push(parseFloat(n[i].per_capita_gdp_percent_change)/100);for(var o in r)t.push(r[o]);for(var s=google.visualization.arrayToDataTable(t),l=new google.visualization.NumberFormat({pattern:"#.##%"}),a=0;a<this.params.regions.length;a++)l.format(s,a+1);this.drawLineChart("per-capita-gdp-change-chart",s,{curveType:"function",legend:{position:"bottom"},pointShape:"square",pointSize:8,title:"Annual Change in Per Capita GDP over Time",vAxis:{format:"#.#%"}})}},{key:"drawOccupationsData",value:function(){var t=this;this.drawMap(MapSources.occupations,function(e,a){return t.drawOccupationsMapSummary(e,a)})}},{key:"drawOccupationsMapSummary",value:function(t,e){$(".map-summary").text(MapSummary.getOccupationsSummaryString(this.params.regions,this.tableData.occupationsData,t,e,function(a){return e==a.year&&t.name==a.occupation})),this.drawMapSummaryLinks(MapSources.occupations,t,e)}},{key:"drawPopulationData",value:function(){var t=this;this.drawMap(MapSources.population,function(e,a){return t.drawPopulationMapSummary(e,a)}),this.drawPopulationChart(),this.drawPopulationChangeChart()}},{key:"drawPopulationMapSummary",value:function(t,e){$(".map-summary").text(MapSummary.getSummaryString(this.params.regions,this.tableData.populationData,t,e,function(t){return e==t.year})),this.drawMapSummaryLinks(MapSources.population,t,e)}},{key:"drawPopulationChart",value:function(){for(var t=[],e=["Year"],a=0;a<this.params.regions.length;a++)e[a+1]=this.params.regions[a].name;t.push(e);for(var r={},a=0;a<this.tableData.populationData.length;a++)for(var n=this.tableData.populationData[a],i=0;i<n.length;i++)void 0==r[n[i].year]&&(r[n[i].year]=[n[i].year]),r[n[i].year].push(parseInt(n[i].population));for(var o in r)t.push(r[o]);for(var s=google.visualization.arrayToDataTable(t),l=new google.visualization.NumberFormat({pattern:"###,###"}),a=0;a<this.params.regions.length;a++)l.format(s,a+1);this.drawLineChart("population-chart",s,{curveType:"function",legend:{position:"bottom"},pointShape:"square",pointSize:8,title:"Population"})}},{key:"drawPopulationChangeChart",value:function(){for(var t=[],e=["Year"],a=0;a<this.params.regions.length;a++)e[a+1]=this.params.regions[a].name;t.push(e);for(var r={},a=0;a<this.tableData.populationData.length;a++)for(var n=this.tableData.populationData[a],i=0;i<n.length;i++)void 0==r[n[i].year]&&(r[n[i].year]=[n[i].year]),r[n[i].year].push(parseFloat(n[i].population_percent_change)/100);for(var o in r)t.push(r[o]);for(var s=google.visualization.arrayToDataTable(t),l=new google.visualization.NumberFormat({pattern:"#.##%"}),a=0;a<this.params.regions.length;a++)l.format(s,a+1);this.drawLineChart("population-change-chart",s,{curveType:"function",legend:{position:"bottom"},pointShape:"square",pointSize:8,title:"Population Change",vAxis:{format:"#.#%"}})}},{key:"ensureVisibleWithOrientation",value:function(t,e){var a=$(t);return a.is(":visible")||a.show(),a.hasClass(e)}},{key:"drawLineChart",value:function(t,e,a){var r=new google.visualization.LineChart(document.getElementById(t));this.applyStandardOptions(a),r.draw(e,a)}},{key:"drawSteppedAreaChart",value:function(t,e,a){var r=new google.visualization.SteppedAreaChart(document.getElementById(t));this.applyStandardOptions(a),r.draw(e,a)}},{key:"applyStandardOptions",value:function(t){t.series={0:{color:"#2980b9"},1:{color:"#ee3b3b"},2:{color:"#3bdbee"},3:{color:"#ff9900"},4:{color:"#109618"},5:{color:"#0099c6"},6:{color:"#dd4477"},7:{color:"#66aa00"},8:{color:"#b82e2e"},9:{color:"#316395"}},t.legend={position:"top",maxLines:4,textStyle:{color:"#222",fontSize:14}}}},{key:"drawMarkersForPlaces",value:function(t,e){e.forEach(function(e){var a={type:"Feature",properties:{name:e.name},geometry:{coordinates:e.location.coordinates,type:"Point"}};L.geoJson(a).addTo(t)})}},{key:"getPlacesForRegion",value:function(t){var e=this,a=[];return t.forEach(function(t){e.params.regions.forEach(function(e){t.id==e.id&&a.push(t)})}),a}},{key:"fetchNextPage",value:function(){if(!this.fetching&&!this.fetchedAll){this.fetching=!0,this.incrementPage();var t=this;$.ajax(this.getSearchResultsUrl()).done(function(e,a,r){return 204==r.status?(t.decrementPage(),t.fetching=!1,void(t.fetchedAll=!0)):($(".datasets").append(e),void(t.fetching=!1))})}}},{key:"getSearchPageForRegionVectorMetricYearUrl",value:function(t,e,a,r,n,i,o){var s="";if(t&&t.length>0){if(s+="/region/"+t.join("-"),e&&e.length>0){var l=e.map(function(t){return t.replace(/ /g,"_").replace(/\//g,"_").replace(/,/g,"")});s+="/"+l.join("-")}else s+="/-";i?s+="/search-results":(a&&(s+="/"+a),r&&(s+="/"+r),n&&(s+="/"+n))}else s+="/search";return o&&(s+=o),s}},{key:"getSearchPageUrl",value:function(t,e,a){if(this.params.regions.length>0||this.params.autoSuggestedRegion){var r=[],n=[];return 0==this.params.resetRegions&&(r=this.params.regions.map(function(t){return t.id}),n=this.params.regions.map(function(t){return t.name})),this.params.autoSuggestedRegion&&(r.push(this.params.autoSuggestedRegion.id),n.push(this.params.autoSuggestedRegion.name)),this.getSearchPageForRegionVectorMetricYearUrl(r,n,this.params.vector||"population",e,a,t,this.getSearchQueryString())}return this.getSearchPageForRegionVectorMetricYearUrl(null,null,this.params.vector||"population",e,a,t,this.getSearchQueryString())}},{key:"getSearchResultsUrl",value:function(){return this.getSearchPageUrl(!0)}},{key:"getSearchQueryString",value:function(){var t=[];return this.params.q.length>0&&t.push("q="+encodeURIComponent(this.params.q)),this.params.page>1&&t.push("page="+this.params.page),this.params.categories.length>0&&this.params.categories.forEach(function(e){return t.push("categories="+encodeURIComponent(e))}),this.params.domains.length>0&&this.params.domains.forEach(function(e){return t.push("domains="+encodeURIComponent(e))}),this.params.tags.length>0&&this.params.tags.forEach(function(e){return t.push("tags="+encodeURIComponent(e))}),this.params.debug&&t.push("debug="),t.length>0?"?"+t.join("&"):""}},{key:"incrementPage",value:function(){this.params.page++}},{key:"navigate",value:function(){window.location.href=this.getSearchPageUrl()}},{key:"removeRegion",value:function(t){this.params.regions.splice(t,1),this.params.page=1,0==this.params.regions.length&&(this.params.vector="")}},{key:"setAutoSuggestedRegion",value:function(t,e){this.params.autoSuggestedRegion=t,this.params.resetRegions=e,this.params.page=1}},{key:"toggleCategory",value:function(t){var e=this.params.categories.indexOf(t);e>-1?this.params.categories.splice(e,1):this.params.categories.push(t),this.params.page=1}},{key:"toggleDomain",value:function(t){var e=this.params.domains.indexOf(t);e>-1?this.params.domains.splice(e,1):this.params.domains.push(t),this.params.page=1}},{key:"toggleTag",value:function(t){var e=this.params.tags.indexOf(t);e>-1?this.params.tags.splice(e,1):this.params.tags=[t],this.params.page=1,this.params.categories=[],this.params.domains=[],this.params.q="",this.params.regions=[],this.params.vector=""}}]),t}();$(document).ready(function(){new SearchPageController(_params,_tableData,_mapVariables),multiComplete("#q",".region-list").listen(),$(".fa-close").click(function(){$(".current-category").fadeOut()}),$(".info-icon").mouseenter(function(){$(".info-tooltip").fadeIn()}),$(".info-icon").mouseleave(function(){$(".info-tooltip").fadeOut()})});
//# sourceMappingURL=search.min.js.map
