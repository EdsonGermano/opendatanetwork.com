"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function delay(e){return new Promise(function(t,n){setTimeout(t,e)})}function multiComplete(e,t){function n(e){window.location.href=e}var a="odn.data.socrata.com",r=[{name:"Datasets",image:"fa-bar-chart",domain:a,fxf:"fpum-bjbr",column:"encoded",encoded:["domain","fxf"],select:function(e){return n("/dataset/"+e.domain+"/"+e.fxf)},show:function(e,t){e.append("span").attr("class","name").text(t.text).append("span").attr("id","tag").text(t.domain)}},{name:"Regions",image:"fa-globe",domain:a,fxf:"68ht-6puw",column:"all",encoded:["id","type","population"],select:function(e){n("/region/"+e.id+"/"+e.text.replace(/ /g,"_").replace(/\//g,"_").replace(/,/g,""))},sort:function(e){return-parseFloat(e.population)}},{name:"Publishers",image:"fa-newspaper-o",domain:a,fxf:"8ae5-ghum",column:"domain",select:function(e){return n("/search?domains="+e.text)}},{name:"Categories",image:"fa-fighter-jet",domain:a,fxf:"864v-r7tf",column:"category",select:function(e){return n("/search?categories="+e.text)},show:function(e,t){e.append("span").attr("class","capitalize").text(t.text)}}],o=new Autosuggest(t,r);return o.listen(e),o}function regionsWithData(e,t){var n=_nameToColumn.has(e)?_nameToColumn.get(e):defaultColumn;return[_.extend({},_withDataSource,{select:t,column:n})]}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function variableGenerator(e,t){return e=e||[2013],t=t||parseFloat,function(n){return n.map(function(n){return{years:e,value:t,name:n[0],column:n[1],format:n[2],stoplight:n[3]}})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPercent(e){return function(t){return t.map(function(t){return _.extend(t,_defineProperty({},e,parseFloat(t[e])/100))})}}function _rename(e,t){return function(n){return n.map(function(n){var a=t[n[e]]||n[e];return _.extend(n,_defineProperty({},e,a))})}}function _order(e,t){return function(n){return _.sortBy(n,function(n){return t.indexOf(n[e])})}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}$(document).ready(function(){$(".search-link").click(function(){var e=$("#q").val().trim();0===e.length?$("#q").focus():$("#form").submit()})}),Array.prototype.includes=function(e){return this.indexOf(e)>-1},String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})},String.prototype.split2=function(e){var t=this.split(e);return 1==t.length&&""===t[0]?[]:t};var Constants={ROSTER_URL:"https://federal.demo.socrata.com/resource/bdeb-mf9k.json",AUTOCOMPLETE_SEPARATOR:":",AUTOCOMPLETE_URL:function(e,t,n,a){return"https://"+e+"/views/"+t+"/columns/"+n+"/suggest/"+a},AUTOCOMPLETE_WAIT_MS:150,AUTOCOMPLETE_MAX_OPTIONS:100,AUTOCOMPLETE_SHOWN_OPTIONS:5,PEER_REGIONS:5,PEER_REGIONS_MAX:10},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),RegionLookup=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"get",value:function(e){return $.getJSON(Constants.ROSTER_URL+"?"+$.param(e))}},{key:"getOne",value:function(t){function n(e){if(0===e.length)return console.warn("no regions found for params: "),console.warn(t),null;if(1===e.length)return e[0];var n=_.filter(e,function(e){return"place"===e.type});return n.length>0?n[0]:e[0]}return new Promise(function(a,r){e.get(t).then(function(e){a(n(e))},function(e){throw e})})}},{key:"byName",value:function(t){return e.getOne({name:t})}},{key:"byID",value:function(t){return e.getOne({id:t})}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Base64=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"encode",value:function(e){return btoa(unescape(encodeURIComponent(str)))}},{key:"decode",value:function(e){return decodeURIComponent(escape(atob(e)))}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),AutosuggestSource=function(){function e(t,n,a,r,o,i,s,l,c){_classCallCheck(this,e),this.name=t,this.image=n,this.domain=a,this.fxf=r,this.column=o,this.encoded=i,this.select=s,this.show=l,this.sort=c}return _createClass(e,[{key:"get",value:function(e){var t=this;return new Promise(function(n,a){if(""===e)n([]);else{var r=Constants.AUTOCOMPLETE_URL(t.domain,t.fxf,t.column,e),o=t.sort?Constants.AUTOCOMPLETE_MAX_OPTIONS:Constants.AUTOCOMPLETE_SHOWN_OPTIONS,i={size:o},s=r+"?"+$.param(i);$.getJSON(s).then(function(e){n(e.options.map(function(e){return t.decode(e)}))},a)}})}},{key:"decode",value:function(e){if(this.encoded.length>0){var t=e.text,n=t.lastIndexOf(" "),a=t.substring(0,n),r=t.substring(n+1),o=Base64.decode(r),i=o.split(Constants.AUTOCOMPLETE_SEPARATOR);return _.extend({text:a},_.object(this.encoded,i))}return{text:e.text}}},{key:"display",value:function(e,t){var n=this;if(0===t.length)return[];this.sort&&(t=_.sortBy(t,this.sort).slice(0,Constants.AUTOCOMPLETE_SHOWN_OPTIONS));var a=e.append("li").attr("class","autocomplete-category");if(this.image){a.append("label").attr("class","autocomplete-title").text(this.name);if(t.length>1){a.append("div").append("i").attr("class","fa "+this.image)}}var r=a.append("ul").attr("class","autocomplete-options sub-list"),o=this;return r.selectAll("li").data(t).enter().append("li").attr("class","autocomplete-option").each(function(e){o.show(d3.select(this),e)}).on("click",function(e){return n.select(e)}).on("mouseover.source",function(){d3.select(this).classed("selected hovered",!0)}).on("mouseout.source",function(){d3.select(this).classed("selected hovered",!1)})[0]}}],[{key:"fromJSON",value:function(t){var n=t.encoded||[],a=t.show||function(e,t){e.append("span").text(t.text)};return new e(t.name,t.image,t.domain,t.fxf,t.column,n,t.select,a,t.sort)}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),AutosuggestResults=function(){function e(t){_classCallCheck(this,e),this.results=d3.select(t),this.options=[],this.index=-1,this.autohide()}return _createClass(e,[{key:"autohide",value:function(){var e=this;d3.select("html").on("click.results",function(){return e.hide()}),this.results.on("click.results",function(){return d3.event.stopPropagation()})}},{key:"hide",value:function(){this.results.style("display","none")}},{key:"unhide",value:function(){this.results.style("display","block")}},{key:"empty",value:function(){this.results.html("")}},{key:"display",value:function(e){var t=this;return new Promise(function(n,a){t.source.get(e).then(function(e){t.empty(),0===e.length?(t.hide(),n([])):(t.unhide(),n(t.source.display(t.results,e)))},function(e){throw e})})}},{key:"show",value:function(e,t){var n=this;this.empty();var a=e.map(function(e,a){var r=t[a];return e.display(n.results,r)});this.updateOptions(_.flatten(a)),this.unhide()}},{key:"updateOptions",value:function(e){var t=this;this.options=e.map(function(e){return d3.select(e)}),this.options.forEach(function(e,n){e.on("mouseover.results",function(){t.index=n,t.updateSelected()}).on("mouseout.results",function(){t.index=-1,t.updateSelected()})})}},{key:"updateSelected",value:function(){var e=this;this.options.forEach(function(t,n){t.classed("selected",n===e.index)})}},{key:"keydown",value:function(e){38==e?this.up():40==e&&this.down(),this.updateSelected()}},{key:"up",value:function(){this.index>0?this.index-=1:this.index=this.options.length-1}},{key:"down",value:function(){this.index<this.options.length-1?this.index+=1:this.index=0}},{key:"enter",value:function(){var e=this.options[this.index];e.on("click")(e.datum())}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Autosuggest=function(){function e(t,n){_classCallCheck(this,e),this.sources=n.map(AutosuggestSource.fromJSON),this.results=new AutosuggestResults(t),this._currentTerm="",this._time=Date.now()}return _createClass(e,[{key:"listen",value:function(e){var t=this;d3.select(e).on("keydown",function(){var e=d3.event.keyCode;13==e?(d3.event.preventDefault(),t.enter()):t.results.keydown(e)}).on("input",function(){t.throttledSuggest(this.value)})}},{key:"throttledSuggest",value:function(e){var t=this;delay(Constants.AUTOCOMPLETE_WAIT_MS).then(function(){e===t._currentTerm&&t.suggest(e)}),this._currentTerm=e}},{key:"suggest",value:function(e){var t=this;""===e?this.results.hide():!function(){var n=Date.now(),a=t.sources.map(function(t){return t.get(e)});Promise.all(a).then(function(e){n>t._time&&(t._time=n,t.results.show(t.sources,e))})}()}},{key:"enter",value:function(){if(this.results.index<0){if(1==this.results.options.length)return this.results.index=0,void this.results.enter();var e="/search?"+$.param({q:this._currentTerm});window.location.href=e}else this.results.enter()}}]),e}(),domain="odn.data.socrata.com",_nameToColumn=new Map;_nameToColumn.set("population","population"),_nameToColumn.set("earnings","earnings"),_nameToColumn.set("education","education"),_nameToColumn.set("occupations","occupations"),_nameToColumn.set("cost_of_living","rpp"),_nameToColumn.set("gdp","gdp"),_nameToColumn.set("health","health");var defaultColumn="all",_withDataSource={name:"Regions with Data",domain:domain,fxf:"68ht-6puw",encoded:["id","type","population"],sort:function(e){return-parseFloat(e.population)}},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Scale=function(){function e(t,n,a){_classCallCheck(this,e),this.values=t,this.range=n,this.scale=a}return _createClass(e,null,[{key:"quantile",value:function(t,n){t.sort(d3.ascending);var a=1/n.length,r=_.map(n.slice(1),function(e,n){return d3.quantile(t,(n+1)*a)}),o=d3.scale.quantile().domain(r).range(n);return new e(t,n,o)}}]),e}(),MapConstants={LIMIT:5e3,CSS_ID:"leaflet-map",MAPBOX_TOKEN:"pk.eyJ1IjoibGFuZWFhc2VuIiwiYSI6ImYxZjExYmYzOTMxYzgyZTc2NDY0NDBmNDNmZmEwYWM3In0.uy5ta6EsSEZggkVQHo2ygw",LABEL_LAYER_ID:"socrata-apps.cb421623",BASE_LAYER_ID:"socrata-apps.af2cc4ed",COLOR_SCALE:colorbrewer.Blues[9].slice(2),STOPLIGHT_COLOR_SCALE:colorbrewer.RdYlGn[7],SCALE:Scale.quantile,MAP_OPTIONS:{minZoom:3,maxZoom:12,zoomControl:!1,attributionControl:!1,scrollWheelZoom:!1},ZOOM_CONTROL:!0,ZOOM_CONTROL_OPTIONS:{position:"topleft"},INITIAL_CENTER:[37.1669,-95.9669],INITIAL_ZOOM:4,AUTO_ZOOM_OPTIONS:{animate:!1,maxZoom:10,paddingTopLeft:[50,0]},AUTO_ZOOM_OUT:1,POINT_RADIUS_SCALE:d3.scale.log,POINT_RADIUS_RANGE_METERS:[500,2e3],BASE_STYLE:{stroke:!0,color:"#2c3e50",opacity:1,weight:2,fill:!1},REFERENCE_STYLE:{fill:!0,fillOpacity:.35,stroke:!0,weight:1,opacity:1},SELECTED_STYLE:{weight:6,dashArray:"4, 8",lineCap:"round"},NO_DATA_STYLE:{fill:!1,stroke:!1},LEGEND_OPACITY:.5,TOOLTIP_OPTIONS:{offset:L.point(0,-20),closeButton:!1,closeOnClick:!1},TOOLTIP_PADDING:16,POPUP_OPTIONS:{closeButton:!1,closeOnClick:!1},TOPOJSON_DIRECTORY:"/geo/",TOPOJSON_SUFFIX:".topo.json",REGIONS:{nation:{name:"USA",id:"nation",topo:"nation",type:"choropleth"},region:{name:"Regions",id:"region",topo:"region",type:"choropleth"},division:{name:"Divisions",id:"division",topo:"division",type:"choropleth"},state:{name:"States",id:"state",topo:"state",type:"choropleth"},county:{name:"Counties",id:"county",topo:"county",type:"choropleth"},msa:{name:"Metros",id:"msa",topo:"cbsa",type:"choropleth"},place:{name:"Cities",id:"place",topo:"places",type:"point"}},DEFAULT_REGION:"state"},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),TopoModel=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"get",value:function(e){var t=MapConstants.TOPOJSON_DIRECTORY+e.topo+MapConstants.TOPOJSON_SUFFIX;return $.getJSON(t)}}]),e}(),MapModel=function(){function e(t,n,a,r,o){_classCallCheck(this,e),this.source=t,this.region=n,this.variable=a,this.year=r,this.regions=o,this.regionById=e.makeLookup(o,function(e){return e.id})}return _createClass(e,[{key:"values",value:function(){return this.regions.map(function(e){return e.value})}},{key:"scale",value:function(e,t){var n=t.slice(0);return this.variable.reverse&&n.reverse(),e(this.values(),n)}}],[{key:"makeLookup",value:function(e,t){var n=new Map;return _.each(e,function(e){return n.set(t(e),e)}),n}},{key:"create",value:function(t,n,a,r){var o=t.idColumn||"id",i=t.typeColumn||"type",s=t.nameColumn||"name",l=t.yearColumn||"year",c=t.hasPopulation||!1,u=t.populationColumn||"population",h=t.value||parseFloat;return new Promise(function(p,d){function m(l){var c=l.map(function(e){var t=h(e[a.column]);return{id:e[o],type:e[i],name:e[s],value:t,valueName:a.name,valueFormatted:a.format(t),year:r}});p(new e(t,n,a,r,c))}function f(e){throw e}var g,v=[o,i,s,l],y=v.concat([a.column]),b=(g={},_defineProperty(g,i,n.id),_defineProperty(g,"$select",y.join()),_defineProperty(g,"$limit",MapConstants.LIMIT),_defineProperty(g,l,r),g),C=c?{$order:u+" DESC"}:{},w=_.extend({},b,C,a.params),O="https://"+t.domain+"/resource/"+t.fxf+".json?"+$.param(w);$.getJSON(O).then(m,f)})}}]),e}(),_slicedToArray=function(){function e(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(l){r=!0,o=l}finally{try{!a&&s["return"]&&s["return"]()}finally{if(r)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),LegendControl=L.Control.extend({options:{position:"bottomleft"},onAdd:function(e){var t=L.DomUtil.create("div","legend-control");return this.container=d3.select(t),t},update:function(e,t,n){this.container.selectAll("*").remove();var a=10,r=e.range.slice();r.reverse();var o=r.length*a,i=this.container.append("div").attr("class","legend-container"),s=_.filter(e.values,function(e){return!isNaN(e)}),l=d3.extent(s),c=_slicedToArray(l,2),u=c[0],h=c[1],p=d3.quantile(s,.25),d=d3.median(s),m=d3.quantile(s,.75),f=["maximum","upper quartile","median","lower quartile","minimum"],g=[h,m,d,p,u],v=o/(g.length-1),y=2,b="middle",C=i.append("svg").attr("height",o+15).attr("class","legend"),w=C.append("g").attr("class","labels"),O=w.selectAll("text").data(f).enter().append("text").attr("class","tick-label").text(function(e){return e}).attr("text-anchor","end").attr("alignment-baseline",b),S=w.node().getBBox().width+a+y;O.attr("transform",function(e,t){return"translate("+(S-y)+", "+(a+t*v)+")"});var x=C.append("g").attr("class","ticks"),T=x.selectAll("g.tick").data(g).enter().append("g").attr("class","tick").attr("transform",function(e,t){return"translate("+(S+a)+", "+(a+t*v)+")"});T.append("line").attr("class","tick-line").attr("x1",a).attr("y1",0).attr("x2",2*a).attr("y2",0),T.append("line").attr("class","tick-line").attr("x1",-a).attr("y1",0).attr("x2",0).attr("y2",0),T.append("text").attr("class","tick-value").text(function(e){return t.format(e)}).attr("alignment-baseline",b).attr("transform","translate("+(2*a+y)+", 0)");C.selectAll("rect").data(r).enter().append("rect").attr("class","legend-element").attr("x",S+a).attr("y",function(e,t){return(t+1)*a}).attr("width",a).attr("height",a).style("fill",function(e){return e}).style("fill-opacity",MapConstants.LEGEND_OPACITY);C.append("rect").attr("class","legend-box").attr("x",S+a).attr("y",a).attr("width",a).attr("height",o),C.attr("width",C.node().getBBox().width+2*a)}}),_slicedToArray=function(){function e(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(l){r=!0,o=l}finally{try{!a&&s["return"]&&s["return"]()}finally{if(r)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),MapBounds=function(){function e(t){_classCallCheck(this,e),this.$div=t,this.update()}return _createClass(e,[{key:"update",value:function(){var e=this.$div.offset(),t=e.left,n=e.top;this.x1=t,this.y1=n,this.x2=this.x1+this.$div.width(),this.y2=this.y1+this.$div.height(),this.centerX=this.x1+(this.x2-this.x1)/2,this.centerY=this.y1+(this.y2-this.y1)/2}},{key:"normalize",value:function(e){var t=_slicedToArray(e,2),n=t[0],a=t[1];return[n-this.x2,a-this.y2]}},{key:"quadrant",value:function(e){var t=_slicedToArray(e,2),n=t[0],a=t[1];return[n-this.centerX<0,a-this.centerY<0]}}]),e}(),Tooltip=function(){function e(t,n){_classCallCheck(this,e),this.name=t,this.value=n}return _createClass(e,[{key:"show",value:function(){}}],[{key:"fromRegion",value:function(t){var n=t.name,a=t.valueName+" ("+t.year+"): "+t.valueFormatted;return new e(n,a)}}]),e}(),TooltipControl=L.Control.extend({options:{position:"bottomright"},onAdd:function(e){var t=this,n=L.DomUtil.create("div","tooltip");this.container=d3.select(n).style("display","none").attr("id","tooltip"),this.$container=$(this.container[0]),this.name=this.container.append("div").attr("class","name"),this.value=this.container.append("div").attr("class","value"),this.shown=!1;var a=new MapBounds($("#leaflet-map"));return window.onresize=function(){a.update()},document.addEventListener("mousemove",function(e){if(t.shown){var n=[e.pageX,e.pageY],r=a.normalize(n),o=_slicedToArray(r,2),i=o[0],s=o[1],l=a.quadrant(n),c=_slicedToArray(l,2),u=c[0],h=c[1],p=MapConstants.TOOLTIP_PADDING,d=u?i+t.width+p:i-p,m=h?s+t.height+p:s-p;t.container.style("left",d+"px").style("top",m+"px")}}),n},show:function(e,t){this.name.text(e),this.value.text(t),this.width=this.$container.width(),this.height=48,this.unhide()},showRegion:function(e){this.show(e.name,e.valueName+" ("+e.year+"): "+e.valueFormatted)},hide:function(){this.shown=!1,this.container.style("display","none")},unhide:function(){this.shown=!0,this.container.style("display","inline")}}),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Navigate=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"url",value:function(t){var n=t.regions.map(function(e){return e.id}).join("-"),a=t.regions.map(function(e){return e.name}).map(e.escapeName).join("-"),r=[];return t.vector&&""!==t.vector&&(r.push(t.vector),t.metric&&r.push(t.metric),t.year&&r.push(t.year)),"/region/"+n+"/"+a+"/"+r.join("/")+window.location.search}},{key:"escapeName",value:function(e){return e.replace(/,/g,"").replace(/[ \/]/g,"_")}}]),e}(),VariableControl=L.Control.extend({initialize:function(e,t,n){this.source=e,this.variables=e.variables,this.params=t,this.onUpdate=n,this.variable=_.find(this.variables,function(e){return Navigate.escapeName(e.name).toLowerCase()===t.metric}),this.variable=this.variable||this.variables[0],t.year=parseInt(t.year),this.year=_.contains(this.variable.years,t.year)?t.year:_.max(this.variable.years)},options:{position:"topleft"},update:function(){var e=Navigate.url(_.extend(this.params,{vector:Navigate.escapeName(this.source.name),year:this.year,metric:Navigate.escapeName(this.variable.name).toLowerCase()}));history.replaceState(null,null,e),this.onUpdate(this.variable,this.year)},onAdd:function(e){function t(e){var t=e.property("value"),n=e.select("option[value='"+t+"']");return n.datum()}var n=this,a=L.DomUtil.create("div","variable-container");this.container=d3.select(a),this.update();var r=this.container.append("select").attr("class","variable-select").on("change",function(){n.variable=t(r),_.contains(n.variable.years,n.year)||(n.year=_.max(n.variable.years)),i(),n.update()}),o=(r.selectAll("option").data(this.variables).enter().append("option").property("selected",function(e){return e===n.variable}).attr("value",function(e){return e.name}).text(function(e){return e.name}),this.container.append("select").attr("class","year-select").on("change",function(){n.year=t(o),n.update()})),i=function(){o.selectAll("option").remove(),o.selectAll("option").data(n.variable.years).enter().append("option").property("selected",function(e){return e===n.year}).attr("value",function(e){return e}).text(function(e){return e})};return i(),a}}),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();if("undefined"!=typeof require)var _=require("lodash"),Navigate=require("../../controllers/navigate"),Requests=require("../../controllers/request"),MAP_SOURCES=require("../data/map-sources");var MapSource=function(){function e(t){_classCallCheck(this,e),this.source=t,this.variables=t.variables,this.id=t.idColumn||"id",this.year=t.yearColumn||"year"}return _createClass(e,[{key:"summarize",value:function(e,t,n){var a=this;return new Promise(function(r,o){a.getData(e,t,n).then(function(o){if(0===o.length)r("");else{var i=n.map(function(n){var r=_.find(o,function(e){return e[a.id]===n.id}),i=e.format(r[e.column]);return"The "+e.name.toLowerCase()+" of "+n.name+" in "+t+" was "+i+"."}).join(" ");r(i)}},o)})}},{key:"otherVariables",value:function(e){return this.variables.filter(function(t){return t.name!==e.name})}},{key:"getData",value:function(e,t,n){var a="https://"+this.source.domain+"/resource/"+this.source.fxf+".json",r=[this.id].concat(e.column),o=_.extend(_defineProperty({$select:r.join(","),$where:this.id+" in ("+n.map(function(e){return"'"+e.id+"'"})+")"},this.year,t),e.params||{});if("undefined"==typeof Requests){var i=a+"?"+$.param(o);return d3.promise.json(i)}var i=Requests.buildURL(a,o);return Requests.getJSON(i)}},{key:"getVariable",value:function(e){var t=_.find(this.variable,function(t){return t.column===e});return t?t:this.variables[0]}},{key:"getYear",value:function(e,t){return t&&""!==t&&_.contains(e.years,parseFloat(t))?parseFloat(t):_.max(e.years)}}]),e}(),MapDescription=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"summarizeFromParams",value:function(e){return new Promise(function(t,n){if(e.vector&&e.vector in MAP_SOURCES){var a=new MapSource(MAP_SOURCES[e.vector]),r=a.getVariable(e.metric),o=a.getYear(r,e.year),i=e.regions;a.summarize(r,o,i).then(t,n)}else t("")})}},{key:"variablesFromParams",value:function(e){if(e.vector&&e.vector in MAP_SOURCES){var t=new MapSource(MAP_SOURCES[e.vector]),n=t.getVariable(e.metric),a=t.otherVariables(n);return a.map(function(t){var n=Navigate.escapeName(t.name).toLowerCase(),a=_.extend({},e,{metric:n,year:void 0}),r=Navigate.url(a);return _.extend(t,{url:r})})}return[]}}]),e}();"undefined"!=typeof module&&(module.exports=MapDescription);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),MapView=function(){function e(t,n,a,r,o){var i=this;_classCallCheck(this,e),this.source=t,this.regionType=n,this.regions=a,this.regionIDs=new Set(a.map(function(e){return e.id})),this.features=r,this.legend=new LegendControl,this.tooltip=new TooltipControl,this.variableControl=new VariableControl(t,o,function(e,t){i.display(e,t)}),this.zoomControl=new L.Control.Zoom(MapConstants.ZOOM_CONTROL_OPTIONS),this._popups=[]}return _createClass(e,[{key:"show",value:function(e){var t=this,n=(d3.select(e).append("div").attr("class","map-container").attr("id",MapConstants.CSS_ID),L.map(MapConstants.CSS_ID,MapConstants.MAP_OPTIONS));this.map=n,n.setView(MapConstants.INITIAL_CENTER,MapConstants.INITIAL_ZOOM),n.addControl(this.legend),n.addControl(this.variableControl),n.addControl(this.tooltip),MapConstants.ZOOM_CONTROL&&n.addControl(this.zoomControl),n.whenReady(function(){var e=function(e){return"https://api.mapbox.com/v4/"+e+"/{z}/{x}/{y}.png?access_token="+MapConstants.MAPBOX_TOKEN},a=(L.tileLayer(e(MapConstants.BASE_LAYER_ID)).addTo(n),t.features.addTo(n),n.createPane("labels"));L.tileLayer(e(MapConstants.LABEL_LAYER_ID),{pane:a}).addTo(n);t.zoomToSelected(t.map)})}},{key:"zoomToSelected",value:function(e){var t=this,n=[];this.features.eachLayer(function(e){t.regionIDs.has(e.feature.id)&&n.push(e)});var a=new L.featureGroup(n);e.fitBounds(a.getBounds(),MapConstants.AUTO_ZOOM_OPTIONS),"choropleth"===this.regionType.type&&1===n.length&&e.zoomOut(MapConstants.AUTO_ZOOM_OUT,MapConstants.AUTO_ZOOM_OPTIONS)}},{key:"display",value:function(e,t){var n=this;MapModel.create(this.source,this.regionType,e,t).then(function(e){return n.update(e)})["catch"](function(e){throw e}),new MapSource(this.source).summarize(e,t,this.regions).then(function(e){d3.select("p.map-summary").text(e)})}},{key:"update",value:function(e){var t=e.variable.stoplight?MapConstants.STOPLIGHT_COLOR_SCALE:MapConstants.COLOR_SCALE,n=e.scale(MapConstants.SCALE,t);this.updateLegend(e,n),this.updateFeatures(e,n)}},{key:"updateLegend",value:function(e,t){this.legend.update(t,e.variable,e.year)}},{key:"updateFeatures",value:function(t,n){var a=this;this.features.eachLayer(function(r){var o=t.regionById.get(r.feature.id);if(o&&!isNaN(o.value)){var i=a.regionIDs.has(o.id),s=n.scale(o.value),l=_.extend({},MapConstants.REFERENCE_STYLE,{fillColor:s}),c=i?_.extend(l,MapConstants.SELECTED_STYLE):l;if(r.setStyle(c),i&&a.map){if(!(o.id in a._popups)){var u=L.popup(MapConstants.POPUP_OPTIONS).setLatLng(e.center(r));a._popups[o.id]=u}var h='<div class="name">'+o.name+'</div>                        <div class="value">'+o.valueName+" ("+o.year+"):                        "+o.valueFormatted+"</div>";a._popups[o.id].setContent(h).addTo(a.map)}r.on({mouseover:function(){a.closePopups(),a.tooltip.showRegion(o)},mouseout:function(){return a.tooltip.hide()}})}else r.setStyle(MapConstants.NO_DATA_STYLE)})}},{key:"closePopups",value:function(){var e=this;_.values(this._popups).forEach(function(t){return e.map.closePopup(t)})}}],[{key:"center",value:function(e){if(e.getLatLng)return e.getLatLng();var t=e.getLatLngs(),n=L.latLngBounds(_.flatten(t));return n.getCenter()}},{key:"create",value:function(t,n,a){if(n.length<1)throw"regions cannot be empty";return new Promise(function(r,o){var i=MapConstants.REGIONS[n[0].type];void 0===i?o("invalid region type for map: "+n[0].type):!function(){var s=_.filter(n,function(e){return e.type==i.id});TopoModel.get(i).then(function(n){var o=e._features(n,"choropleth"==i.type);r(new e(t,i,s,o,a))},o)}()})}},{key:"_features",value:function(e,t){var n=function(){var e={stroke:!1},n=t?MapConstants.BASE_STYLE:_.extend({},MapConstants.BASE_STYLE,e);return{style:function(){return n}}},a=function(){var t=e.objects,n=e.objects[Object.keys(t)[0]].geometries,a=function(e){return e.properties.population},r=n.map(a),o=MapConstants.POINT_RADIUS_SCALE().domain(d3.extent(r)).range(MapConstants.POINT_RADIUS_RANGE_METERS);return{pointToLayer:function(e,t){return L.circle(t,o(a(e)))}}},r=t?n():_.extend({},n(),a()),o=L.geoJson(null,r);return omnivore.topojson.parse(e,null,o)}}]),e}();if("undefined"!=typeof require)var d3=require("d3"),_=require("lodash");var DOMAIN="odn.data.socrata.com",format={integer:d3.format(",.0f"),percent:function(e){return d3.format(".1f")(e)+"%"},ratio:d3.format(".1%"),dollar:d3.format("$,.0f"),millionDollar:function(e){return d3.format("$,.0f")(e)+"M"}},MAP_SOURCES={population:{name:"population",domain:DOMAIN,fxf:"e3rd-zzmr",hasPopulation:!0,variables:[{name:"Population",column:"population",years:[2009,2010,2011,2012,2013],format:format.integer},{name:"Population Change",column:"population_percent_change",years:[2010,2011,2012,2013],format:format.percent,stoplight:!0}]},earnings:{name:"earnings",domain:DOMAIN,fxf:"wmwh-4vak",hasPopulation:!0,variables:variableGenerator()([["Median Earnings","median_earnings",format.dollar,!0],["Median Female Earnings","female_median_earnings",format.dollar,!0],["Median Male Earnings","male_median_earnings",format.dollar,!0],["Median Female Earnings (Full Time)","female_full_time_median_earnings",format.dollar,!0],["Median Male Earnings (Full Time)","male_full_time_median_earnings",format.dollar,!0],["Percent Earning less than $10,000","percent_with_earnings_1_to_9999",format.percent,!1],["Percent Earning $10,000 to $14,999","percent_with_earnings_10000_to_14999",format.percent,!1],["Percent Earning $15,000 to $24,999","percent_with_earnings_15000_to_24999",format.percent,!1],["Percent Earning $25,000 to $34,999","percent_with_earnings_25000_to_34999",format.percent,!1],["Percent Earning $35,000 to $49,999","percent_with_earnings_35000_to_49999",format.percent,!1],["Percent Earning $50,000 to $64,999","percent_with_earnings_50000_to_64999",format.percent,!1],["Percent Earning $65,000 to $74,999","percent_with_earnings_65000_to_74999",format.percent,!1],["Percent Earning $75,000 to $99,999","percent_with_earnings_75000_to_99999",format.percent,!1],["Percent Earning over $100,000","percent_with_earnings_over_100000",format.percent,!1]])
},education:{name:"education",domain:DOMAIN,fxf:"uf4m-5u8r",hasPopulation:!0,variables:variableGenerator()([["High School Graduation Rate","percent_high_school_graduate_or_higher",format.percent,!0],["College Graduation Rate","percent_bachelors_degree_or_higher",format.percent,!0]])},occupations:{name:"occupations",domain:DOMAIN,fxf:"qfcm-fw3i",hasPopulation:!0,variables:["Business and Finance","Computers and Math","Construction and Extraction","Education","Engineering","Farming, Fishing, Foresty","Fire Fighting","Food Service","Healthcare","Health Support","Health Technicians","Janitorial","Law Enforcement","Legal","Management","Material Moving","Media","Office and Administration","Personal Care","Production","Repair","Sales","Social Sciences","Social Services","Transportation"].map(function(e){return{name:e,column:"percent_employed",params:{occupation:e},years:[2013],format:format.percent}})},gdp:{name:"gdp",domain:DOMAIN,fxf:"ks2j-vhr8",variables:[{name:"GDP per Capita",column:"per_capita_gdp",years:_.range(2001,2014),format:format.dollar,stoplight:!0},{name:"Annual Change in GDP",column:"per_capita_gdp_percent_change",years:_.range(2002,2014),format:format.percent,stoplight:!0}]},cost_of_living:{name:"cost_of_living",domain:DOMAIN,fxf:"hpnf-gnfu",variables:["All","Goods","Rents","Other"].map(function(e){return{name:e,column:"index",reverse:!0,params:{component:e},years:_.range(2008,2014),format:d3.format(".1f"),stoplight:!0}})},consumption:{name:"consumption",domain:DOMAIN,fxf:"va5j-wsjq",variables:[{name:"Personal Consumption Expenditure",column:"personal_consumption_expenditures",years:_.range(1997,2015),format:format.millionDollar},{name:"Annual Change in PCE",column:"expenditures_percent_change",years:_.range(1998,2015),format:format.percent}]},job_proximity:{name:"job_proximity",domain:DOMAIN,fxf:"5pnb-mvzq",variables:[["Median","median",!0],["Mean","mean",!0]].map(function(e){return{name:e[0]+" Jobs Proximity Index",column:"value",params:{variable:"jobs-prox-idx-"+e[1]},years:[2015],format:format.integer,stoplight:!0}})},environmental_health:{name:"environmental_health",domain:DOMAIN,fxf:"nax7-t6ga",variables:[["Median","median",!0],["Mean","mean",!0]].map(function(e){return{name:e[0]+" Environmental Health Hazard Index",column:"value",params:{variable:"env-health-idx-"+e[1]},years:[2015],format:format.integer,stoplight:!0}})},health:{name:"health",domain:DOMAIN,fxf:"7ayp-utp2",variables:["Adult Obesity","Adult Smoking","Physical Inactivity","Excessive Drinking","Access to Exercise Opportunities"].map(function(e,t){return{name:e+" Rate",column:e.toLowerCase().replace(/\s/g,"_")+"_value",years:[2015],reverse:4!=t,format:format.ratio,stoplight:!0}})},health_indicators:{name:"health_indicators",domain:DOMAIN,fxf:"n4rt-3rmd",idColumn:"_geoid",typeColumn:"_type",nameColumn:"Locationdesc",variables:[["Asthma","Adults who have been told they currently have asthma"],["Arthritis","Adults who have been told they have arthritis"],["Heart Attack","Ever told you had a heart attack (myocardial infarction)?"],["Heart Disease","Ever told you had angina or coronary heart disease?"],["Skin Cancer","Ever told you had skin cancer?"],["Other Cancer","Ever told you had any other types of cancer?"],["COPD","Ever told you have COPD?"],["Kidney Disease","Ever told you have kidney disease?"],["Depression","Ever told you that you have a form of depression?"],["Diabetes","Have you ever been told by a doctor that you have diabetes?"]].map(function(e){return{name:e[0]+" Rate",column:"data_value",years:[2011,2012,2013],params:{break_out:"Overall",response:"Yes",question:e[1]},format:format.percent,stoplight:!0,reverse:!0}})}};"undefined"!=typeof module&&(module.exports=MAP_SOURCES);var ChartConstants={CHART_TYPES:{line:google.visualization.LineChart,bar:google.visualization.BarChart,column:google.visualization.ColumnChart,table:google.visualization.Table,"stepped-area":google.visualization.SteppedAreaChart},CHART_OPTIONS:{curveType:"function",lineWidth:2,legend:{position:"top"},pointShape:"square",pointSize:8,colors:["#2980b9","#ee3b3b","#3bdbee","#ff9900","#109618","#0099c6","#dd4477","#66aa00","#b82e2e","#316395"]}},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();if("undefined"!=typeof require)var _=require("lodash");var ODN_DOMAIN="odn.data.socrata.com",ATTRIBUTIONS={acs:{name:"U.S. Census American Community Survey",url:"https://www.census.gov/programs-surveys/acs/"},bea:{name:"U.S. Bureau of Economic Analysis",url:"http://www.bea.gov/"},hud:{name:"U.S. Department of Housing and Urban Development",url:"http://www.hud.gov/"},rwjf:{name:"Robert Wood Johnson Foundation",url:"http://www.rwjf.org/"},cdc:{name:"Centers for Disease Control and Prevention",url:"http://www.cdc.gov/"}},ALL_REGIONS=["nation","region","division","state","county","msa","place","zip_code"],SOURCES=[{tabName:"Population",vector:"population",name:"Population",attribution:ATTRIBUTIONS.acs,domain:ODN_DOMAIN,fxf:"e3rd-zzmr",datalensFXF:"va7f-2qjr",regions:ALL_REGIONS,charts:[{name:"Population",data:[{column:"year",label:"Year",type:"string"},{column:"population",label:"Population",format:{pattern:"###,###"}}],chart:"line",options:{height:300}},{name:"Population Change",data:[{column:"year",label:"Year",type:"string"},{column:"population_percent_change",label:"Population Change",type:"number",format:{pattern:"#.##%"}}],transform:function(e){return e.filter(function(e){return"2009"!==e.year}).map(function(e){return _.extend(e,{population_percent_change:parseFloat(e.population_percent_change)/100})})},chart:"line",options:{height:300,vAxis:{format:"#.##%"}}}]},{tabName:"Education",vector:"education",name:"Education",attribution:ATTRIBUTIONS.acs,domain:ODN_DOMAIN,fxf:"uf4m-5u8r",regions:ALL_REGIONS,charts:[{name:"Graduation Rates",data:[{column:"percent_high_school_graduate_or_higher",label:"High School"},{column:"percent_bachelors_degree_or_higher",label:"College"}],transpose:[{column:"variable",label:"",type:"string"},{column:"value",label:"Value",format:{pattern:"#.#%"}}],transform:_toPercent("value"),chart:"table",options:{cssClassNames:{headerCell:"header-cell",headerRow:"header-row",tableCell:"table-cell"},vAxis:{format:"percent",viewWindow:{min:0,max:1}}}}]},{tabName:"Earnings",vector:"earnings",name:"Earnings",attribution:ATTRIBUTIONS.acs,domain:ODN_DOMAIN,fxf:"wmwh-4vak",regions:ALL_REGIONS,charts:[{name:"Earnings and Gender",description:"\n                    Median earnings of full-time and part-time workers broken down by gender.",data:[{column:"median_earnings",label:"All Workers"},{column:"male_median_earnings",label:"Male"},{column:"female_median_earnings",label:"Female"}],transpose:[{column:"variable",label:"",type:"string"},{column:"value",label:"Value",format:{pattern:"###,###",prefix:"$"}}],chart:"table",options:{cssClassNames:{headerCell:"header-cell",headerRow:"header-row",tableCell:"table-cell"}}},{name:"Earnings and Education",description:"\n                    Median earnings of full-time and part-time workers broken down\n                    by level of education.",data:[{column:"median_earnings_less_than_high_school",label:"Less than High School"},{column:"median_earnings_high_school",label:"High School"},{column:"median_earnings_some_college_or_associates",label:"Some College or Associates"},{column:"median_earnings_bachelor_degree",label:"Bachelor's Degree"},{column:"median_earnings_graduate_or_professional_degree",label:"Graduate or Professional Degree"}],transpose:[{column:"variable",label:"Level of Education",type:"string"},{column:"value",label:"Value",format:{pattern:"###,###",prefix:"$"}}],chart:"stepped-area",options:{height:300,vAxis:{format:"currency"},areaOpacity:0,lineWidth:2}}]},{tabName:"Occupations",vector:"occupations",name:"Occupations",attribution:ATTRIBUTIONS.acs,domain:ODN_DOMAIN,fxf:"qfcm-fw3i",regions:ALL_REGIONS,charts:[{name:"Occupations",description:"\n                    Percentage of workers employed in each occupation.",data:[{column:"occupation",label:"",type:"string"},{column:"percent_employed",label:"Percent Employed",format:{pattern:"#.#%"}}],transform:_toPercent("percent_employed"),chart:"table",options:{cssClassNames:{headerCell:"header-cell",headerRow:"header-row",tableCell:"table-cell"}}}]},{tabName:"GDP",vector:"gdp",name:"Gross Domestic Product (GDP)",sourceURL:"http://www.bea.gov/regional/index.htm",description:"\n            Gross Domestic Product (GDP) is a measure of the value of all goods and services\n            produced in a region minus the value of the goods and services used up in production.\n            Real GDP is adjusted for changes in the value of money (inflation and deflation)\n            so that values can be compared between years.\n            Data is available for U.S. states and metropolitan areas.",attribution:ATTRIBUTIONS.bea,domain:ODN_DOMAIN,fxf:"ks2j-vhr8",regions:["state","msa"],include:function(e){return _.contains(e.name,"Metro")},charts:[{name:"GDP",description:"\n                    Real (inflation adjusted) GDP per Capita over time.",data:[{column:"year",label:"Year",type:"string"},{column:"per_capita_gdp",label:"Per Capita GDP",format:{pattern:"$###,###"}}],chart:"line",options:{height:300,vAxis:{format:"$###,###"}}},{name:"Change in GDP",description:"\n                    Annual change in real GDP.",data:[{column:"year",label:"Year",type:"string"},{column:"per_capita_gdp_percent_change",label:"Annual Change in Per Capita GDP over Time",format:{pattern:"##.#%"}}],transform:_toPercent("per_capita_gdp_percent_change"),chart:"line",options:{height:300,vAxis:{format:"##.#%"}}}]},{tabName:"Cost of Living",vector:"cost_of_living",name:"Cost of Living Indexes (100 is the U.S. Average)",sourceURL:"http://www.bea.gov/newsreleases/regional/rpp/rpp_newsrelease.htm",description:"\n            The cost of living index measures the difference in the price levels of goods\n            and services across regions.\n            The average cost of living index in the U.S. is 100,\n            with higher values corresponding to costlier goods and services.\n            Data is available for U.S. states and metropolitan areas.",attribution:ATTRIBUTIONS.bea,domain:ODN_DOMAIN,fxf:"hpnf-gnfu",regions:["state","msa"],include:function(e){return _.contains(e.name,"Metro")},charts:[{name:"Cost of Living",data:[{column:"component",label:"",type:"string"},{column:"index",label:"Index"},{column:"year",label:"Year"}],chart:"table",options:{cssClassNames:{headerCell:"header-cell",headerRow:"header-row",tableCell:"table-cell"}}}].concat(["All","Rents","Goods","Other"].map(function(e){return{name:""+e,params:{component:e},data:[{column:"year",label:"Year",type:"string"},{column:"index",label:"Index"}],chart:"line"}}))},{tabName:"Consumption",vector:"consumption",name:"Personal Consumption Expenditures",sourceURL:"http://blog.bea.gov/2015/12/03/bureau-of-economic-analysis-releases-two-new-data-sets-to-deepen-understanding-of-u-s-economy/",description:"\n            Personal consumption expenditure is a measure of goods and services\n            purchased by or on behalf of households.\n            Data is available for U.S. states and for the nation as a whole.",attribution:ATTRIBUTIONS.bea,domain:ODN_DOMAIN,fxf:"va5j-wsjq",regions:["state","nation"],charts:[{name:"Personal Consumption Expenditures over Time (Millions of USD)",data:[{column:"year",label:"Year",type:"string"},{column:"personal_consumption_expenditures",label:"Personal Consumption Expenditures (Millions of USD)",format:{pattern:"$###,###M"}}],chart:"line",options:{height:300,vAxis:{format:"$###,###M"}}},{name:"Change in Personal Consumption Expenditures over Time",data:[{column:"year",label:"Year",type:"string"},{column:"expenditures_percent_change",label:"Annual Change",format:{pattern:"#.##%"}}],transform:function(e){return e.filter(function(e){return"1997"!==e.year}).map(function(e){return _.extend(e,{expenditures_percent_change:parseFloat(e.expenditures_percent_change)/100})})},chart:"line",options:{height:300,vAxis:{format:"#.##%"}}}]},{tabName:"Job Proximity",vector:"job_proximity",name:"Jobs Proximity Index",sourceURL:"http://egis.hud.opendata.arcgis.com/datasets/636ecbfb0ee5480ea5b68e65991e4815_0",description:"\n            The jobs proximity index quantifies access to employment opportunities in a region.\n            Values are percentile ranked and range from 0 to 100,\n            with higher values corresponding to better access to jobs.\n            Data is computed for U.S. counties by applying summary statistics across all\n            census tracts present in a county and is current as of 2015.\n            <br /><br />\n            The underlying index quantifies the accessibility of a given residential neighborhood\n            as a function of its distance to all job locations within a census tract,\n            with distance to larger employment centers weighted more heavily.\n            Specifically, a gravity model is used, where the accessibility (Ai)\n            of a given residential block-group is a summary description of the\n            distance to all job locations, with the distance from any single job\n            location positively weighted by the size of employment (job opportunities)\n            at that location and inversely weighted by the labor supply (competition) to that location.",attribution:ATTRIBUTIONS.hud,domain:ODN_DOMAIN,fxf:"5pnb-mvzq",regions:["county"],charts:[{name:"Median Jobs Promiximity Index",params:{variable:"jobs-prox-idx-median"},data:[{column:"variable",label:"Job Proximity Index",type:"string"},{column:"value",label:"Value"}],transform:_rename("variable",{"jobs-prox-idx-median":"Median Jobs Proximity Index"}),chart:"column",options:{height:300,vAxis:{viewWindow:{min:0}}}}]},{tabName:"Environment",vector:"environmental_health",name:"Environmental Health Hazard Index",sourceURL:"http://egis.hud.opendata.arcgis.com/datasets/53a856bef6f24356abee30653399e94a_0",description:"\n            The environmental health hazard exposure index summarizes potential exposure to harmful toxins\n            including carcinogenic, respiratory, and neurological hazards.\n            Values are percentile ranked and range from 0 to 100,\n            with higher values corresponding to less exposure to harmful toxins.\n            Data is computed for U.S. counties by applying summary statistics across\n            all census tracts present in a county and is current as of 2015.",attribution:ATTRIBUTIONS.hud,domain:ODN_DOMAIN,fxf:"nax7-t6ga",regions:["county"],charts:[{name:"Median Environmental Health Hazard Index",params:{variable:"env-health-idx-median"},data:[{column:"variable",label:"Environmental Health Hazard Index",type:"string"},{column:"value",label:"Value"}],transform:_rename("variable",{"env-health-idx-median":"Median Environmental Health Hazard Index"}),chart:"column",options:{height:300,vAxis:{viewWindow:{min:0}}}}]},{tabName:"Health Behaviors",vector:"health",name:"Health Behaviors",sourceURL:"http://www.countyhealthrankings.org/rankings/data",description:"\n            The Robert Wood Johnson Foundation produces health rankings for states and counties.\n            They explore many aspects of health including quality of life, health behaviors,\n            access to clinical care, socioeconomic factors, and environmental factors.",attribution:ATTRIBUTIONS.rwjf,domain:ODN_DOMAIN,fxf:"7ayp-utp2",regions:["county","state"],charts:[{name:"Health Behaviors",description:"\n                    Adult Smoking is the percentage of the adult population that currently smokes\n                    every day or most days and has smoked at least 100 cigarettes in their lifetime.\n                    <br /><br />\n                    Adult Obesity is the percentage of the adult population (age 20 and older) that\n                    reports a body mass index (BMI) greater than or equal to 30 kg/m^2.\n                    <br /><br />\n                    Physical Inactivity is the percentage of adults aged 20 and over reporting no\n                    leisure-time physical activity. Examples of physical activities provided\n                    include running, calisthenics, golf, gardening, or walking for exercise.\n                    <br /><br />\n                    Access to Exercise Opportunities measures the percentage of individuals\n                    in a county who live reasonably close to a location for physical activity.\n                    Locations for physical activity are defined as parks or recreational facilities.\n                    Individuals who reside in a census block within half a mile from a park,\n                    reside in an urban census tract within one mile of a recreational facility, or\n                    reside in a rural census tract within three miles of a recreational facility\n                    are considered to have adequate access for opportunities for physical activity.\n                    <br /><br />\n                    Excessive Drinking is the percentage of adults that report either binge drinking,\n                    defined as consuming more than 4 (women) or 5 (men) alcoholic beverages on a\n                    single occasion in the past 30 days, or heavy drinking, defined as drinking\n                    more than one (women) or 2 (men) drinks per day on average.",data:[{column:"Adult obesity Value",label:"Adult Obesity Rate"},{column:"Adult smoking Value",label:"Adult Smoking Rate"},{column:"Physical inactivity Value",label:"Physical Inactivity Rate"},{column:"Access to exercise opportunities Value",label:"Access to Exercise Opportunities Rate"},{column:"Excessive drinking Value",label:"Excessive Drinking Rate"}],transpose:[{column:"variable",label:"",type:"string"},{column:"value",label:"Value",format:{pattern:"#.##%"}}],chart:"table",options:{cssClassNames:{headerCell:"header-cell",headerRow:"header-row",tableCell:"table-cell"}}}]},{tabName:"Health Indicators",vector:"health_indicators",name:"Health",sourceURL:"http://www.cdc.gov/brfss/",description:"\n            The CDC's Behavioral Risk Factor Surveillance System (BRFSS) is the nation's\n            premier system of health-related telephone surveys that collect state data\n            about U.S. residents regarding their health-related risk behaviors,\n            chronic health conditions, and use of preventive services.\n            Established in 1984 with 15 states, BRFSS now collects data in\n            all 50 states as well as the District of Columbia and three U.S. territories.\n            BRFSS completes more than 400,000 adult interviews each year,\n            making it the largest continuously conducted health survey system in the world.",attribution:ATTRIBUTIONS.cdc,domain:ODN_DOMAIN,fxf:"n4rt-3rmd",regions:["state"],idColumn:"_geoid",charts:[{name:"Chronic Health Indicators",params:{break_out:"Overall",year:"2013",response:"Yes",classid:"CLASS03"},data:[{column:"question",label:"",type:"string"},{column:"data_value",label:"Value",format:{pattern:"#.#%"}}],transform:_toPercent("data_value"),chart:"table",options:{cssClassNames:{headerCell:"header-cell",headerRow:"header-row",tableCell:"table-cell"}}},{name:"Disability Status",params:{break_out:"Overall",year:"2013",response:"Yes",classid:"CLASS05",topicid:"Topic19"},data:[{column:"question",label:"",type:"string"},{column:"data_value",label:"Value",format:{pattern:"#.#%"}}],transform:_toPercent("data_value"),chart:"table",options:{cssClassNames:{headerCell:"header-cell",headerRow:"header-row",tableCell:"table-cell"}}},{name:"Time of Last Checkup",params:{break_out:"Overall",year:"2013",classid:"CLASS07",topicid:"Topic36"},data:[{column:"response",label:"Response",type:"string"},{column:"data_value",label:"Value",format:{pattern:"#.#%"}}],transform:function(e){var t=["Never","5 or more years ago","Within the past 5 years","Within the past 2 years","Within the past year"],n=_toPercent("data_value"),a=_order("response",t);return a(n(e))},chart:"column",options:{height:300,vAxis:{format:"#.##%",viewWindow:{min:0}}}},{name:"Health Status",params:{break_out:"Overall",year:"2013",classid:"CLASS08",topicid:"Topic41"},data:[{column:"response",label:"Response",type:"string"},{column:"data_value",label:"Value",format:{pattern:"#.#%"}}],transform:function(e){var t=["Poor","Fair","Good","Very good","Excellent"],n=_toPercent("data_value"),a=_order("response",t);return a(n(e))},chart:"column",options:{height:300,vAxis:{format:"#.##%",viewWindow:{min:0}}}}]}],SOURCES_BY_VECTOR=_.indexBy(SOURCES,function(e){return e.vector}),Sources=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"has",value:function(e){return e in SOURCES_BY_VECTOR}},{key:"get",value:function(e){return SOURCES_BY_VECTOR[e]}},{key:"defaultVector",value:function(){return SOURCES[0]}},{key:"supportsVector",value:function(t,n){return t in SOURCES_BY_VECTOR?e.supports(SOURCES_BY_VECTOR[t],n):!1}},{key:"supports",value:function(e,t){var n=!0,a=!1,r=void 0;try{for(var o,i=t[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var s=o.value;if(!_.contains(e.regions,s.type)||e.include&&!e.include(s))return!1}}catch(l){a=!0,r=l}finally{try{!n&&i["return"]&&i["return"]()}finally{if(a)throw r}}return!0}},{key:"forRegions",value:function(t){return SOURCES.filter(function(n){return e.supports(n,t)})}}]),e}();"undefined"!=typeof module&&(module.exports=Sources);var _slicedToArray=function(){function e(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(l){r=!0,o=l}finally{try{!a&&s["return"]&&s["return"]()}finally{if(r)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Tab=function(){function e(t){var n=this;if(_classCallCheck(this,e),!t.tabName)throw Error("tab missing tab");if(this.tabName=t.tabName,this.description=t.description||"",this.name=t.name||this.tabName,!t.attribution)throw Error("tab missing attribution");if(this.attribution=t.attribution,!t.domain)throw Error("tab missing domain");if(this.domain=t.domain,!t.fxf)throw Error("tab missing fxf");if(this.fxf=t.fxf,this.path="https://"+this.domain+"/resource/"+this.fxf+".json",this.idColumn=t.idColumn||"id",!t.charts)throw Error("tab missing charts");this.charts=t.charts.map(function(e){return new Chart(n,e)})}return _createClass(e,[{key:"render",value:function(e,t){this.charts.forEach(function(e){e.render(t)})}}]),e}(),Chart=function(){function e(t,n){if(_classCallCheck(this,e),this.tab=t,!n.data)throw Error("chart missing name");if(this.name=n.name,!n.data)throw Error("chart missing data");if(this.data=e._columns(n.data),this.x=n.data[0],this.y=n.data[1],!n.chart)throw Error("chart missing chart");if(!(n.chart in ChartConstants.CHART_TYPES))throw Error("invalid chart type: "+n.chart);if(this.chart=ChartConstants.CHART_TYPES[n.chart],this.options=_.extend({},ChartConstants.CHART_OPTIONS,n.options||{},{title:n.name}),this.transform=n.transform,n.transpose&&2!==n.transpose.length)throw Error("transpose requires two variables");n.transpose&&(this.transpose=e._columns(n.transpose)),this.params=n.params||{},this.description=n.description||""}return _createClass(e,[{key:"render",value:function(e){var t=this;this.getData(e).then(function(n){t.transpose&&(n=t._transpose(n)),t.transform&&(n=t.transform(n));var a=d3.select("div.chart#"+t.name.toLowerCase().replace(/\W/g,"")).select(".chart-container"),r=t.dataTable(n,e),o=new t.chart(a[0][0]);o.draw(r,t.options)},function(e){console.error(e)})}},{key:"renderTable",value:function(e,t,n){var a=e.append("table").attr("class","vertical"),r=a.append("tr");r.append("th").attr("class","empty"),t.forEach(function(e,t){r.append("th").attr("class","color-"+t).text(e.name).append("div")}),n.forEach(function(e){var t=a.append("tr");e.forEach(function(e,n){0==n?t.append("td").attr("class","category-header").text(e):t.append("td").attr("class","color-"+(n-1)).text(e).append("div")})})}},{key:"_transpose",value:function(e){var t=this;return this.x=this.transpose[0],this.y=this.transpose[1],_.flatten(e.map(function(e){return t.data.map(function(n){var a;return a={id:e[t.tab.idColumn]},_defineProperty(a,t.x.column,n.label),_defineProperty(a,t.y.column,e[n.column]),a})}))}},{key:"getData",value:function(e){var t=[this.tab.idColumn].concat(this.data.map(function(e){return e.column})),n=_.extend({$select:t.join(","),$where:this.tab.idColumn+" in ("+e.map(function(e){return"'"+e.id+"'"})+")",$order:t.map(function(e){return e+" ASC"}).join(",")},this.params),a=this.tab.path+"?"+$.param(n);return d3.promise.json(a)}},{key:"dataTable",value:function(e,t){var n=this,a=t.map(function(e){return{label:e.name,type:n.y.type}}),r=[this.x].concat(a),o=_.groupBy(e,function(e){return e[n.x.column]}),i=_.pairs(o).map(function(e){var a=_slicedToArray(e,2),r=a[0],o=a[1],i=_.indexBy(o,function(e){return e[n.tab.idColumn]});return[r].concat(t.map(function(e){return i[e.id][n.y.column]}))}),s=google.visualization.arrayToDataTable([r].concat(i));if(this.x.format){var l=new google.visualization.NumberFormat(this.x.format);l.format(s,0)}return this.y.format&&!function(){var e=new google.visualization.NumberFormat(n.y.format);_.range(1,r.length).forEach(function(t){e.format(s,t)})}(),s}}],[{key:"_columns",value:function(e){return e.map(function(e){return e.type=e.type||"number",e.label=e.label||"",e.column=e.column||"",e.column=e.column.replace(/ /g,"_"),e})}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),SearchPageController=function(){function e(t){function n(e){RegionLookup.byID(e.id).then(function(e){a.setAutoSuggestedRegion({id:e.id,name:e.name},!1),a.navigate()},function(e){throw e})}_classCallCheck(this,e),this.params=t,this.fetching=!1,this.fetchedAll=!1;var a=this;$(".refine-link").mouseenter(function(){$(this).addClass("refine-link-selected"),$(this).children("span").children("i").removeClass("fa-caret-down").addClass("fa-caret-up"),$(this).children("ul").slideDown(100)}),$(".refine-link").mouseleave(function(){$(this).removeClass("refine-link-selected"),$(this).children("span").children("i").removeClass("fa-caret-up").addClass("fa-caret-down"),$(this).children("ul").slideUp(100)}),this.attachCategoriesClickHandlers(),$("#refine-menu-categories-view-more").click(function(){d3.promise.json("/categories.json").then(function(e){var t=e.results.map(function(e){return'<li><i class="fa '+e.metadata.icon+'"></i>'+e.category+"</li>"}),n=t.join("");$("#refine-menu-categories").html(n),a.attachCategoriesClickHandlers()},console.error)}),this.attachDomainsClickHandlers(),$("#refine-menu-domains-view-more").click(function(){d3.promise.json("https://api.us.socrata.com/api/catalog/v1/domains").then(function(e){var t=e.results.map(function(e){return"<li>"+e.domain+"</li>"}),n=t.join("");$("#refine-menu-domains").html(n),a.attachDomainsClickHandlers()},console.error)}),this.attachTagsClickHandlers(),$(".region-token .fa-times-circle").click(function(){a.removeRegion($(this).parent().index()),a.navigate()}),$(".category-token .fa-times-circle").click(function(){a.toggleCategory($(this).parent().text().toLowerCase().trim()),a.navigate()}),$(".domain-token .fa-times-circle").click(function(){a.toggleDomain($(this).parent().text().toLowerCase().trim()),a.navigate()}),$(".standard-token .fa-times-circle").click(function(){a.toggleTag($(this).parent().text().toLowerCase().trim()),a.navigate()}),$(window).on("scroll",function(){var e=1e3;$(window).scrollTop()>=$(document).height()-$(window).height()-e&&a.fetchNextPage()}).scroll();var r=regionsWithData(this.params.vector,n),o=new Autosuggest(".add-region-results",r);o.listen(".add-region-input"),$(".add-region .fa-plus").click(function(){$('.add-region input[type="text"]').focus()});var i=this.params.regions,s=this.params.vector||"population";if(i.length>0){if(s in MAP_SOURCES){var l=MAP_SOURCES[s];MapView.create(l,i,this.params).then(function(e){e.show("#map")},function(e){return console.warn(e)})}else console.warn("no map source found for vector: "+s);if(s in SOURCES_BY_VECTOR){var c=SOURCES_BY_VECTOR[s];new Tab(c).render(d3.select("div.charts"),i)}else console.warn("no source found for vector: "+s)}$(".map-summary-more").click(function(){$(".map-summary-links").slideToggle(100),$(".map-summary-more").text("More Information"==$(".map-summary-more").text()?"Less Information":"More Information")})}return _createClass(e,[{key:"attachCategoriesClickHandlers",value:function(){var e=this;$("#refine-menu-categories li:not(.refine-view-more)").click(function(){e.toggleCategory($(this).text().toLowerCase().trim()),e.navigate()})}},{key:"attachDomainsClickHandlers",value:function(){var e=this;$("#refine-menu-domains li:not(.refine-view-more)").click(function(){var t=$(this).text().toLowerCase().trim();e.toggleDomain(t),e.navigate()})}},{key:"attachTagsClickHandlers",value:function(){var e=this;$("#refine-menu-tags li").click(function(){var t=$(this).text().toLowerCase().trim();e.toggleTag(t),e.navigate()})}},{key:"decrementPage",value:function(){this.params.page--}},{key:"fetchNextPage",value:function(){if(!this.fetching&&!this.fetchedAll){this.fetching=!0,this.incrementPage();var e=this;$.ajax(this.getSearchResultsUrl()).done(function(t,n,a){return 204==a.status?(e.decrementPage(),e.fetching=!1,void(e.fetchedAll=!0)):($(".datasets").append(t),void(e.fetching=!1))})}}},{key:"getSearchPageForRegionVectorMetricYearUrl",value:function(e,t,n,a,r,o,i){var s="";if(e&&e.length>0)if(s+="/region/"+e.join("-"),t&&t.length>0){var l=t.map(function(e){return e.replace(/ /g,"_").replace(/\//g,"_").replace(/,/g,"")});s+="/"+l.join("-")}else s+="/-";else s+="/search";return o?s+="/search-results":(n&&(s+="/"+n),a&&(s+="/"+a),r&&(s+="/"+r)),i&&(s+=i),s}},{key:"getSearchPageUrl",value:function(e,t,n){if(this.params.regions.length>0||this.params.autoSuggestedRegion){var a=[],r=[];return this.params.resetRegions===!1&&(a=this.params.regions.map(function(e){return e.id}),r=this.params.regions.map(function(e){return e.name})),this.params.autoSuggestedRegion&&(a.push(this.params.autoSuggestedRegion.id),r.push(this.params.autoSuggestedRegion.name)),this.getSearchPageForRegionVectorMetricYearUrl(a,r,this.params.vector||"population",t,n,e,this.getSearchQueryString(e))}return this.getSearchPageForRegionVectorMetricYearUrl(null,null,this.params.vector||"population",t,n,e,this.getSearchQueryString(e))}},{key:"getSearchResultsUrl",value:function(){return this.getSearchPageUrl(!0)}},{key:"getSearchQueryString",value:function(e){var t=[];return this.params.q.length>0&&t.push("q="+encodeURIComponent(this.params.q)),this.params.page>1&&e&&t.push("page="+this.params.page),this.params.categories.length>0&&this.params.categories.forEach(function(e){return t.push("categories="+encodeURIComponent(e))}),this.params.domains.length>0&&this.params.domains.forEach(function(e){return t.push("domains="+encodeURIComponent(e))}),this.params.tags.length>0&&this.params.tags.forEach(function(e){return t.push("tags="+encodeURIComponent(e))}),t.length>0?"?"+t.join("&"):""}},{key:"incrementPage",value:function(){this.params.page++}},{key:"navigate",value:function(){window.location.href=this.getSearchPageUrl();
}},{key:"removeRegion",value:function(e){this.params.regions.splice(e,1),this.params.page=1,0===this.params.regions.length&&(this.params.vector="")}},{key:"setAutoSuggestedRegion",value:function(e,t){this.params.autoSuggestedRegion=e,this.params.resetRegions=t,this.params.page=1}},{key:"toggleCategory",value:function(e){var t=this.params.categories.indexOf(e);t>-1?this.params.categories.splice(t,1):this.params.categories.push(e),this.params.page=1}},{key:"toggleDomain",value:function(e){var t=this.params.domains.indexOf(e);t>-1?this.params.domains.splice(t,1):this.params.domains.push(e),this.params.page=1}},{key:"toggleTag",value:function(e){var t=this.params.tags.indexOf(e);t>-1?this.params.tags.splice(t,1):this.params.tags=[e],this.params.page=1,this.params.categories=[],this.params.domains=[],this.params.q="",this.params.regions=[],this.params.vector=""}}]),e}();$(document).ready(function(){new SearchPageController(_params),multiComplete("#q",".region-list").listen(),$(".fa-close").click(function(){$(".current-category").fadeOut()}),$(".info-icon").mouseenter(function(){$(".info-tooltip").fadeIn()}),$(".info-icon").mouseleave(function(){$(".info-tooltip").fadeOut()})});
//# sourceMappingURL=search.min.js.map
