"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function delay(e){return new Promise(function(t,n){setTimeout(t,e)})}function multiComplete(e,t){function n(e){window.location.href=e}var o="odn.data.socrata.com",s=[{name:"Datasets",image:"fa-bar-chart",domain:o,fxf:"fpum-bjbr",column:"encoded",encoded:["domain","fxf"],select:function(e){return n("/dataset/"+e.domain+"/"+e.fxf)},show:function(e,t){e.append("span").attr("class","name").text(t.text).append("span").attr("id","tag").text(t.domain)}},{name:"Regions",image:"fa-globe",domain:o,fxf:"68ht-6puw",column:"all",encoded:["id","type","population"],select:function(e){n("/region/"+e.id+"/"+e.text.replace(/ /g,"_").replace(/\//g,"_").replace(/,/g,""))},sort:function(e){return-parseFloat(e.population)}},{name:"Publishers",image:"fa-newspaper-o",domain:o,fxf:"8ae5-ghum",column:"domain",select:function(e){return n("/search?domains="+e.text)}},{name:"Categories",image:"fa-fighter-jet",domain:o,fxf:"864v-r7tf",column:"category",select:function(e){return n("/search?categories="+e.text)},show:function(e,t){e.append("span").attr("class","capitalize").text(t.text)}}],i=new Autosuggest(t,s);return i.listen(e),i}function regionsWithData(e,t){var n=_nameToColumn.has(e)?_nameToColumn.get(e):defaultColumn;return[_.extend({},_withDataSource,{select:t,column:n})]}$(document).ready(function(){$(".search-link").click(function(){var e=$("#q").val().trim();0===e.length?$("#q").focus():$("#form").submit()})}),Array.prototype.includes=function(e){return this.indexOf(e)>-1},String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})},String.prototype.split2=function(e){var t=this.split(e);return 1==t.length&&""===t[0]?[]:t};var Constants={ROSTER_URL:"https://federal.demo.socrata.com/resource/bdeb-mf9k.json",AUTOCOMPLETE_SEPARATOR:":",AUTOCOMPLETE_URL:function(e,t,n,o){return"https://"+e+"/views/"+t+"/columns/"+n+"/suggest/"+o},AUTOCOMPLETE_WAIT_MS:150,AUTOCOMPLETE_MAX_OPTIONS:100,AUTOCOMPLETE_SHOWN_OPTIONS:5,PEER_REGIONS:5,PEER_REGIONS_MAX:10},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),RegionLookup=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"get",value:function(e){return $.getJSON(Constants.ROSTER_URL+"?"+$.param(e))}},{key:"getOne",value:function(t){function n(e){if(0===e.length)return console.warn("no regions found for params: "),console.warn(t),null;if(1===e.length)return e[0];var n=_.filter(e,function(e){return"place"===e.type});return n.length>0?n[0]:e[0]}return new Promise(function(o,s){e.get(t).then(function(e){o(n(e))},function(e){throw e})})}},{key:"byName",value:function(t){return e.getOne({name:t})}},{key:"byID",value:function(t){return e.getOne({id:t})}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Base64=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"encode",value:function(e){return btoa(unescape(encodeURIComponent(str)))}},{key:"decode",value:function(e){return decodeURIComponent(escape(atob(e)))}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),AutosuggestSource=function(){function e(t,n,o,s,i,a,u,r,c){_classCallCheck(this,e),this.name=t,this.image=n,this.domain=o,this.fxf=s,this.column=i,this.encoded=a,this.select=u,this.show=r,this.sort=c}return _createClass(e,[{key:"get",value:function(e){var t=this;return new Promise(function(n,o){if(""===e)n([]);else{var s=Constants.AUTOCOMPLETE_URL(t.domain,t.fxf,t.column,e),i=t.sort?Constants.AUTOCOMPLETE_MAX_OPTIONS:Constants.AUTOCOMPLETE_SHOWN_OPTIONS,a={size:i},u=s+"?"+$.param(a);$.getJSON(u).then(function(e){n(e.options.map(function(e){return t.decode(e)}))},o)}})}},{key:"decode",value:function(e){if(this.encoded.length>0){var t=e.text,n=t.lastIndexOf(" "),o=t.substring(0,n),s=t.substring(n+1),i=Base64.decode(s),a=i.split(Constants.AUTOCOMPLETE_SEPARATOR);return _.extend({text:o},_.object(this.encoded,a))}return{text:e.text}}},{key:"display",value:function(e,t){var n=this;if(0===t.length)return[];this.sort&&(t=_.sortBy(t,this.sort).slice(0,Constants.AUTOCOMPLETE_SHOWN_OPTIONS));var o=e.append("li").attr("class","autocomplete-category");if(this.image){o.append("label").attr("class","autocomplete-title").text(this.name);if(t.length>1){o.append("div").append("i").attr("class","fa "+this.image)}}var s=o.append("ul").attr("class","autocomplete-options sub-list"),i=this;return s.selectAll("li").data(t).enter().append("li").attr("class","autocomplete-option").each(function(e){i.show(d3.select(this),e)}).on("click",function(e){return n.select(e)}).on("mouseover.source",function(){d3.select(this).classed("selected hovered",!0)}).on("mouseout.source",function(){d3.select(this).classed("selected hovered",!1)})[0]}}],[{key:"fromJSON",value:function(t){var n=t.encoded||[],o=t.show||function(e,t){e.append("span").text(t.text)};return new e(t.name,t.image,t.domain,t.fxf,t.column,n,t.select,o,t.sort)}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),AutosuggestResults=function(){function e(t){_classCallCheck(this,e),this.results=d3.select(t),this.options=[],this.index=-1,this.autohide()}return _createClass(e,[{key:"autohide",value:function(){var e=this;d3.select("html").on("click.results",function(){return e.hide()}),this.results.on("click.results",function(){return d3.event.stopPropagation()})}},{key:"hide",value:function(){this.results.style("display","none")}},{key:"unhide",value:function(){this.results.style("display","block")}},{key:"empty",value:function(){this.results.html("")}},{key:"display",value:function(e){var t=this;return new Promise(function(n,o){t.source.get(e).then(function(e){t.empty(),0===e.length?(t.hide(),n([])):(t.unhide(),n(t.source.display(t.results,e)))},function(e){throw e})})}},{key:"show",value:function(e,t){var n=this;this.empty();var o=e.map(function(e,o){var s=t[o];return e.display(n.results,s)});this.updateOptions(_.flatten(o)),this.unhide()}},{key:"updateOptions",value:function(e){var t=this;this.options=e.map(function(e){return d3.select(e)}),this.options.forEach(function(e,n){e.on("mouseover.results",function(){t.index=n,t.updateSelected()}).on("mouseout.results",function(){t.index=-1,t.updateSelected()})})}},{key:"updateSelected",value:function(){var e=this;this.options.forEach(function(t,n){t.classed("selected",n===e.index)})}},{key:"keydown",value:function(e){38==e?this.up():40==e&&this.down(),this.updateSelected()}},{key:"up",value:function(){this.index>0?this.index-=1:this.index=this.options.length-1}},{key:"down",value:function(){this.index<this.options.length-1?this.index+=1:this.index=0}},{key:"enter",value:function(){var e=this.options[this.index];e.on("click")(e.datum())}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Autosuggest=function(){function e(t,n){_classCallCheck(this,e),this.sources=n.map(AutosuggestSource.fromJSON),this.results=new AutosuggestResults(t),this._currentTerm="",this._time=Date.now()}return _createClass(e,[{key:"listen",value:function(e){var t=this;d3.select(e).on("keydown",function(){var e=d3.event.keyCode;13==e?(d3.event.preventDefault(),t.enter()):t.results.keydown(e)}).on("input",function(){t.throttledSuggest(this.value)})}},{key:"throttledSuggest",value:function(e){var t=this;delay(Constants.AUTOCOMPLETE_WAIT_MS).then(function(){e===t._currentTerm&&t.suggest(e)}),this._currentTerm=e}},{key:"suggest",value:function(e){var t=this;""===e?this.results.hide():!function(){var n=Date.now(),o=t.sources.map(function(t){return t.get(e)});Promise.all(o).then(function(e){n>t._time&&(t._time=n,t.results.show(t.sources,e))})}()}},{key:"enter",value:function(){if(this.results.index<0){var e="/search?"+$.param({q:this._currentTerm});window.location.href=e}else this.results.enter()}}]),e}(),domain="odn.data.socrata.com",_nameToColumn=new Map;_nameToColumn.set("population","population"),_nameToColumn.set("earnings","earnings"),_nameToColumn.set("education","education"),_nameToColumn.set("occupations","occupations"),_nameToColumn.set("cost_of_living","rpp"),_nameToColumn.set("gdp","gdp"),_nameToColumn.set("health","health");var defaultColumn="all",_withDataSource={name:"Regions with Data",domain:domain,fxf:"68ht-6puw",encoded:["id","type","population"],sort:function(e){return-parseFloat(e.population)}};$(document).ready(function(){$(".slider").slick({arrows:!1,autoplay:!0,autoplaySpeed:2e3,slidesToScroll:1,slidesToShow:5}),multiComplete("#q",".region-list").listen(),$("#search-button").click(function(){window.location.href="/search?q="+encodeURIComponent($("#q").val())}),$("#menu-item-communities").mouseenter(function(){$("#menu-communities").slideToggle(100),$("#menu-item-communities").addClass("selected")}),$("#menu-item-communities").mouseleave(function(){$("#menu-communities").hide(100),$("#menu-item-communities").removeClass("selected")}),$(".more-subregions-link").click(function(){$(this).parent().removeClass("state-collapsed"),$(this).hide()}),$(".more-regions-link").click(function(){$(".states-list").removeClass("states-list-collapsed"),$(this).hide()})});
//# sourceMappingURL=home.min.js.map
