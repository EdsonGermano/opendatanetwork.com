"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function multiComplete(inputSelector,resultSelector){function autocompleteURL(domain,fxf,column){return function(query){return"https://"+domain+"/views/"+fxf+"/columns/"+column+"/suggest/"+query+"?size=5"}}function navigate(path){window.location.href=path}var domain="odn.data.socrata.com",inputSelection=d3.select(inputSelector),resultSelection=d3.select(resultSelector),datasetURL=autocompleteURL(domain,"fpum-bjbr","name"),datasetSelect=function(dataset){return navigate("/search?q="+dataset)},datasetResults=new Results("Datasets",resultSelection,datasetSelect),datasetComplete=new Complete(datasetURL,datasetResults),regionURL=autocompleteURL(domain,"7g2b-8brv","autocomplete_name"),regionSelect=function(region){return navigate("/"+region.replace(/ /g,"_"))},regionResults=new Results("Regions",resultSelection,regionSelect),regionComplete=new Complete(regionURL,regionResults),publisherURL=autocompleteURL(domain,"8ae5-ghum","domain"),publisherSelect=function(publisher){return navigate("/search?domains="+publisher)},publisherResults=new Results("Publishers",resultSelection,publisherSelect),publisherComplete=new Complete(publisherURL,publisherResults),categoryURL=autocompleteURL(domain,"864v-r7tf","category"),categorySelect=function(category){return navigate("/search?categories="+category)},categoryResults=new Results("Categories",resultSelection,categorySelect),categoryComplete=new Complete(categoryURL,categoryResults),completers=[datasetComplete,regionComplete,publisherComplete,categoryComplete];return new AutoSuggestRegionController(inputSelection,resultSelection,completers)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();$(document).ready(function(){$(".search-link").click(function(){var text=$("#q").val().trim();0==text.length?$("#q").focus():$("#form").submit()})}),Array.prototype.includes=function(s){return this.indexOf(s)>-1},String.prototype.format=function(){var args=arguments;return this.replace(/{(\d+)}/g,function(match,number){return"undefined"!=typeof args[number]?args[number]:match})},String.prototype.split2=function(s){var rg=this.split(s);return 1==rg.length&&""==rg[0]?[]:rg};var ApiController=function(){function ApiController(){_classCallCheck(this,ApiController),this.autoCompleteNameSuggestUrl="https://odn.data.socrata.com/views/7g2b-8brv/columns/autocomplete_name/suggest/{0}?size=10&fuzz=0",this.categoriesUrl="/categories.json",this.childRegionsUrl="https://odn.data.socrata.com/resource/eyae-8jfy?parent_id={0}&$limit={1}",this.costOfLivingUrl="https://odn.data.socrata.com/resource/hpnf-gnfu.json?$order=name&$where=",this.domainsUrl="https://api.us.socrata.com/api/catalog/v1/domains",this.earningsByPlaceUrl="https://odn.data.socrata.com/resource/wmwh-4vak.json/?type=place&$limit=50000&$where=population%20%3E%205000",this.earningsUrl="https://odn.data.socrata.com/resource/wmwh-4vak.json?$where=",this.educationByPlaceUrl="https://odn.data.socrata.com/resource/uf4m-5u8r.json?type=place&$limit=50000&$where=population%20%3E%205000",this.educationUrl="https://odn.data.socrata.com/resource/uf4m-5u8r.json?$where=",this.gdpUrl="https://odn.data.socrata.com/resource/ks2j-vhr8.json?$where=",this.mostPopulousRegionTypeUrl="https://odn.data.socrata.com/resource/eyae-8jfy?parent_id={0}&child_type={1}&$limit={2}&$order=child_population desc",this.occupationsByPlaceUrl="https://odn.data.socrata.com/resource/qfcm-fw3i.json?occupation={0}&type=place&$limit=50000&$where=population%20%3E%205000",this.occupationsUrl="https://odn.data.socrata.com/resource/qfcm-fw3i.json?$order=occupation&$where=",this.parentStateUrl="https://odn.data.socrata.com/resource/eyae-8jfy?parent_type=state&child_id={0}",this.placesUrl="https://odn.data.socrata.com/resource/gm3u-gw57.json/?type=place&$limit=50000&$where=population%20%3E%205000",this.populationUrl="https://odn.data.socrata.com/resource/e3rd-zzmr.json?$order=year,name&$where=",this.similarRegionsUrl="https://socrata-peers.herokuapp.com/peers.json?vectors=population_change,earnings,occupation,education,population&n=10&id={0}",this.healthDataUrls={rwjf_county_health_rankings_2015:"https://odn.data.socrata.com/resource/7ayp-utp2.json?$where=",cdc_brfss_prevalence_2011_2013:"https://odn.data.socrata.com/resource/n4rt-3rmd.json?$where="}}return _createClass(ApiController,[{key:"getAutoCompleteNameSuggestions",value:function(searchTerm){return d3.promise.json(this.autoCompleteNameSuggestUrl.format(encodeURIComponent(searchTerm)))}},{key:"getCategories",value:function(){return d3.promise.json(this.categoriesUrl)}},{key:"getChildRegions",value:function(regionId){var limit=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.childRegionsUrl.format(regionId,limit))}},{key:"getCitiesInState",value:function(stateId){var limit=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.mostPopulousRegionTypeUrl.format(stateId,"place",limit))}},{key:"getCostOfLivingData",value:function(regionIds){return this.getData(this.costOfLivingUrl,regionIds)}},{key:"getCountiesInState",value:function(stateId){var limit=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.mostPopulousRegionTypeUrl.format(stateId,"county",limit))}},{key:"getData",value:function(url,regionIds){var segments=regionIds.map(function(regionId){return"id='"+regionId+"'"});return d3.promise.json(url+encodeURI(segments.join(" OR ")))}},{key:"getDomains",value:function(){return d3.promise.json(this.domainsUrl)}},{key:"getEarningsByPlace",value:function(){return d3.promise.json(this.earningsByPlaceUrl)}},{key:"getEarningsData",value:function(regionIds){return this.getData(this.earningsUrl,regionIds)}},{key:"getEducationByPlace",value:function(){return d3.promise.json(this.educationByPlaceUrl)}},{key:"getEducationData",value:function(regionIds){return this.getData(this.educationUrl,regionIds)}},{key:"getGdpData",value:function(regionIds){return this.getData(this.gdpUrl,regionIds)}},{key:"getMetrosInState",value:function(stateId){var limit=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.mostPopulousRegionTypeUrl.format(stateId,"msa",limit))}},{key:"getOccupationsByPlace",value:function(occupation){return d3.promise.json(this.occupationsByPlaceUrl.format(occupation))}},{key:"getOccupationsData",value:function(regionIds){return this.getData(this.occupationsUrl,regionIds)}},{key:"getParentState",value:function(region){return d3.promise.json(this.parentStateUrl.format(region.id))}},{key:"getPopulationData",value:function(regionIds){return this.getData(this.populationUrl,regionIds)}},{key:"getPlaces",value:function(){return d3.promise.json(this.placesUrl)}},{key:"getSimilarRegions",value:function(regionId){return d3.promise.json(this.similarRegionsUrl.format(regionId))}},{key:"getHealthRwjfChrData",value:function(regionIds){return this.getData(this.healthDataUrls.rwjf_county_health_rankings_2015,regionIds)}}]),ApiController}(),Constants={ROSTER_URL:"https://federal.demo.socrata.com/resource/7g2b-8brv.json",LIMIT:5e4},RegionLookup=function(){function RegionLookup(){_classCallCheck(this,RegionLookup)}return _createClass(RegionLookup,null,[{key:"get",value:function(params){return $.getJSON(Constants.ROSTER_URL+"?"+$.param(params))}},{key:"getOne",value:function(params){function selectRegion(regions){if(0===regions.length)return console.warn("no regions found for params: "),console.warn(params),null;if(1===regions.length)return regions[0];var places=_.filter(regions,function(region){return"place"===region.type});return places.length>0?places[0]:regions[0]}return new Promise(function(resolve,reject){RegionLookup.get(params).then(function(regions){resolve(selectRegion(regions))},function(error){throw error})})}},{key:"byName",value:function(name){return RegionLookup.getOne({name:name})}},{key:"byID",value:function(id){return RegionLookup.getOne({id:id})}},{key:"byAutocompleteName",value:function(name){return RegionLookup.getOne({autocomplete_name:name})}}]),RegionLookup}(),Complete=function(){function Complete(queryBuilder,results){_classCallCheck(this,Complete),this.queryBuilder=queryBuilder,this.results=results}return _createClass(Complete,[{key:"get",value:function(query){return""==query?[]:void this.results.handle($.getJSON(this.queryBuilder(query)))}}]),Complete}(),Results=function(){function Results(type,resultSelection,onSelect){_classCallCheck(this,Results),this.type=type,this.onSelect=onSelect,this.container=resultSelection.append("div").attr("class","autocomplete-results-container").style("display","none"),this.title=this.container.append("p").attr("class","autocomplete-results-title").text(this.type),this.results=this.container.append("div").attr("class","autocomplete-results")}return _createClass(Results,[{key:"hide",value:function(){this.container.style("display","none")}},{key:"unhide",value:function(){this.container.style("display","block")}},{key:"empty",value:function(){this.results.html("")}},{key:"handle",value:function(resultsPromise){var _this=this,success=function(results){_this.empty();var options=results.options;0==options.length?_this.hide():(_this.unhide(),_this.show(options))},failure=function(error){throw error};resultsPromise.then(success,failure)}},{key:"show",value:function(options){var _this2=this;this.results.selectAll("li").data(options).enter().append("li").html(function(option){return option.text}).on("mouseover",function(){d3.select(this).classed("selected",!0)}).on("mouseout",function(){d3.select(this).classed("selected",!1)}).on("click",function(option){_this2.onSelect(option.text)})}}]),Results}(),AutoSuggestRegionController=function(){function AutoSuggestRegionController(inputSelection,resultSelection,completers){_classCallCheck(this,AutoSuggestRegionController),this.inputSelection=inputSelection,this.resultSelection=resultSelection,this.completers=completers}return _createClass(AutoSuggestRegionController,[{key:"listen",value:function(){var self=this;self.inputSelection.on("input",function(){self.suggest(this.value)})}},{key:"navigate",value:function(path){window.location.href=path}},{key:"suggest",value:function(term){""==term?this.resultSelection.style("display","none"):(this.resultSelection.style("display","block"),this.completers.forEach(function(completer){completer.get(term)}))}}]),AutoSuggestRegionController}(),sourceComplete=function(){function urlFor(column){return function(query){return"https://"+domain+"/views/"+fxf+"/columns/"+column+"/suggest/"+query+"?size=5"}}var domain="odn.data.socrata.com",fxf="pfgp-ifph",nameToColumn=new Map;nameToColumn.set("population","population"),nameToColumn.set("earnings","earnings"),nameToColumn.set("education","education"),nameToColumn.set("occupations","occupations"),nameToColumn.set("cost_of_living","rpp"),nameToColumn.set("gdp","gdp");var defaultColumn="population";return function(inputSelector,resultSelector,name,select){var inputSelection=d3.select(inputSelector),resultSelection=d3.select(resultSelector),column=nameToColumn.has(name)?nameToColumn.get(name):defaultColumn,url=urlFor(column),results=new Results("Regions with Data",resultSelection,select),complete=new Complete(url,results);return new AutoSuggestRegionController(inputSelection,resultSelection,[complete])}}();$(document).ready(function(){$(".slider").slick({arrows:!1,autoplay:!0,autoplaySpeed:2e3,slidesToScroll:1,slidesToShow:5}),multiComplete("#q",".region-list").listen(),$("#search-button").click(function(){$("#form").submit()}),$("#menu-item-communities").mouseenter(function(){$("#menu-communities").slideToggle(100),$("#menu-item-communities").addClass("selected"),searchMenu.hideOptionsMenu()}),$("#menu-item-communities").mouseleave(function(){$("#menu-communities").hide(100),$("#menu-item-communities").removeClass("selected")})});
//# sourceMappingURL=home.min.js.map