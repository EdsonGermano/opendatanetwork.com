{"version":3,"sources":["../v4-api-controller.js"],"names":[],"mappings":";;;;;;IAAM,aAAa;AAEf,aAFE,aAAa,GAED;8BAFZ,aAAa;;AAIX,YAAI,CAAC,0BAA0B,GAAG,mGAAmG,CAAC;AACtI,YAAI,CAAC,aAAa,GAAG,kBAAkB,CAAC;AACxC,YAAI,CAAC,eAAe,GAAG,0EAA0E,CAAC;AAClG,YAAI,CAAC,UAAU,GAAG,mDAAmD,CAAC;AACtE,YAAI,CAAC,WAAW,GAAG,8DAA8D,CAAC;AAClF,YAAI,CAAC,SAAS,GAAG,8DAA8D,CAAC;AAChF,YAAI,CAAC,YAAY,GAAG,8DAA8D,CAAC;AACnF,YAAI,CAAC,MAAM,GAAG,8DAA8D,CAAC;AAC7E,YAAI,CAAC,yBAAyB,GAAG,sHAAsH,CAAC;AACxJ,YAAI,CAAC,cAAc,GAAG,gFAAgF,CAAC;AACvG,YAAI,CAAC,cAAc,GAAG,gFAAgF,CAAC;AACvG,YAAI,CAAC,iBAAiB,GAAG,4DAA4D,CAAC;AACtF,YAAI,CAAC,aAAa,GAAG,+EAA+E,CAAC;AACrG,YAAI,CAAC,iBAAiB,GAAG,+HAA+H,CAAC;AACzJ,YAAI,CAAC,cAAc,GAAG;AAClB,4CAAgC,EAAE,8DAA8D;AAChG,0CAA8B,EAAE,8DAA8D;SACjG,CAAA;KACJ;;;;AAAA;iBAtBC,aAAa;;wCA0BC;;AAEZ,mBAAO,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CACrC,KAAK,CAAC,UAAA,KAAK;uBAAI,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC;aAAA,CAAC,CAAC;SAC7C;;;2CAEkB,OAAO,EAAc;gBAAZ,KAAK,yDAAG,EAAE;;AAElC,mBAAO,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,yBAAyB,CAAC,MAAM,CAAC,OAAO,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC,CAClF,KAAK,CAAC,UAAA,KAAK;uBAAI,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC;aAAA,CAAC,CAAC;SAC7C;;;qCAEY;;AAET,mBAAO,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAClC,KAAK,CAAC,UAAA,KAAK;uBAAI,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC;aAAA,CAAC,CAAC;SAC7C;;;uCAEc,MAAM,EAAE;;AAEnB,mBAAO,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,CACxD,KAAK,CAAC,UAAA,KAAK;uBAAI,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC;aAAA,CAAC,CAAC;SAC7C;;;oDAE2B,OAAO,EAAc;gBAAZ,KAAK,yDAAG,EAAE;;AAE3C,gBAAI,aAAa,GAAG,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,yBAAyB,CAAC,MAAM,CAAC,OAAO,EAAE,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC;AACpG,gBAAI,eAAe,GAAG,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,yBAAyB,CAAC,MAAM,CAAC,OAAO,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC,CAAC;;AAEvG,mBAAO,OAAO,CAAC,GAAG,CAAC,CAAC,aAAa,EAAE,eAAe,CAAC,CAAC,CAC/C,IAAI,CAAC,UAAA,MAAM;uBAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;aAAA,CAAC,CAC5D,KAAK,CAAC,UAAA,KAAK;uBAAI,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC;aAAA,CAAC,CAAC;SAC7C;;;yCAEgB,OAAO,EAAc;gBAAZ,KAAK,yDAAG,EAAE;;AAEhC,mBAAO,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,yBAAyB,CAAC,MAAM,CAAC,OAAO,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC,CAC/E,KAAK,CAAC,UAAA,KAAK;uBAAI,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC;aAAA,CAAC,CAAC;SAC7C;;;yCAEgB,OAAO,EAAc;gBAAZ,KAAK,yDAAG,EAAE;;AAEhC,mBAAO,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,yBAAyB,CAAC,MAAM,CAAC,OAAO,EAAE,OAAO,EAAE,KAAK,CAAC,CAAC,CACjF,KAAK,CAAC,UAAA,KAAK;uBAAI,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC;aAAA,CAAC,CAAC;SAC7C;;;0CAEiB,QAAQ,EAAE;;AAExB,mBAAO,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAC1D,KAAK,CAAC,UAAA,KAAK;uBAAI,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC;aAAA,CAAC,CAAC;SAC7C;;;;;;;uDAI8B,UAAU,EAAE,iBAAiB,EAAE;;AAE1D,aAAC,CAAC,OAAO,CAAC,IAAI,CAAC,0BAA0B,CAAC,MAAM,CAAC,kBAAkB,CAAC,UAAU,CAAC,CAAC,EAAE,iBAAiB,CAAC,CAAC;SACxG;;;4CAEmB,SAAS,EAAE,iBAAiB,EAAE;;AAE9C,gBAAI,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,EAAE,SAAS,EAAE,iBAAiB,CAAC,CAAC;SACpE;;;wCAEe,SAAS,EAAE,iBAAiB,EAAE;;AAE1C,gBAAI,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,EAAE,SAAS,EAAE,iBAAiB,CAAC,CAAC;SAChE;;;yCAEgB,SAAS,EAAE,iBAAiB,EAAE;;AAE3C,gBAAI,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,EAAE,SAAS,EAAE,iBAAiB,CAAC,CAAC;SACjE;;;mCAEU,SAAS,EAAE,iBAAiB,EAAE;;AAErC,gBAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,iBAAiB,CAAC,CAAC;SAC3D;;;2CAEkB,SAAS,EAAE,iBAAiB,EAAE;;AAE7C,gBAAI,CAAC,OAAO,CAAC,IAAI,CAAC,cAAc,EAAE,SAAS,EAAE,iBAAiB,CAAC,CAAC;SACnE;;;0CAEiB,SAAS,EAAE,iBAAiB,EAAE;;AAE5C,gBAAI,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa,EAAE,SAAS,EAAE,iBAAiB,CAAC,CAAC;SAClE;;;;;;6CAGoB,SAAS,EAAE,iBAAiB,EAAE;AAC/C,gBAAI,CAAC,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,gCAAgC,EAAE,SAAS,EAAE,iBAAiB,CAAC,CAAC;SACpG;;;wDAC+B,SAAS,EAAE,iBAAiB,EAAE;AAC1D,gBAAI,CAAC,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,EAAE,SAAS,EAAE,iBAAiB,EAAE,QAAQ,CAAC,CAAC;SACjF;;;gCAEO,GAAG,EAAE,SAAS,EAAE,iBAAiB,EAA2B;gBAAzB,gBAAgB,yDAAG,IAAI;;AAE9D,gBAAI,QAAQ,GAAG,SAAS,CAAC,GAAG,CAAC,UAAS,QAAQ,EAAE;AAC5C,uBAAO,gBAAgB,GAAC,KAAK,GAAG,QAAQ,GAAG,IAAI,CAAC;aACnD,CAAC,CAAC;;AAEH,aAAC,CAAC,OAAO,CAAC,GAAG,GAAG,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,iBAAiB,CAAC,CAAC;SACxE;;;WAlIC,aAAa","file":"v4-api-controller.js","sourcesContent":["class ApiController {\n\n    constructor() {\n\n        this.autoCompleteNameSuggestUrl = 'https://odn.data.socrata.com/views/7g2b-8brv/columns/autocomplete_name/suggest/{0}?size=10&fuzz=0';\n        this.categoriesUrl = '/categories.json';\n        this.costOfLivingUrl = 'https://odn.data.socrata.com/resource/hpnf-gnfu.json?$order=name&$where=';\n        this.domainsUrl = 'https://api.us.socrata.com/api/catalog/v1/domains';\n        this.earningsUrl = 'https://odn.data.socrata.com/resource/wmwh-4vak.json?$where=';\n        this.healthUrl = 'https://odn.data.socrata.com/resource/wmwh-4vak.json?$where=';\n        this.educationUrl = 'https://odn.data.socrata.com/resource/uf4m-5u8r.json?$where=';\n        this.gdpUrl = 'https://odn.data.socrata.com/resource/ks2j-vhr8.json?$where=';\n        this.mostPopulousRegionTypeUrl = 'https://odn.data.socrata.com/resource/eyae-8jfy?parent_id={0}&child_type={1}&$limit={2}&$order=child_population desc';\n        this.occupationsUrl = 'https://odn.data.socrata.com/resource/qfcm-fw3i.json?$order=occupation&$where=';\n        this.parentStateUrl = 'https://odn.data.socrata.com/resource/eyae-8jfy?parent_type=state&child_id={0}';\n        this.placesInRegionUrl = 'https://odn.data.socrata.com/resource/eyae-8jfy?parent_id=';\n        this.populationUrl = 'https://odn.data.socrata.com/resource/e3rd-zzmr.json?$order=year,name&$where=';\n        this.similarRegionsUrl = 'https://socrata-peers.herokuapp.com/peers.json?vectors=population_change,earnings,occupation,education,population&n=10&id={0}';\n        this.healthDataUrls = {\n            rwjf_county_health_rankings_2015: \"https://odn.data.socrata.com/resource/7ayp-utp2.json?$where=\",\n            cdc_brfss_prevalence_2011_2013: \"https://odn.data.socrata.com/resource/n4rt-3rmd.json?$where=\"\n        }\n    }\n\n    // Promises\n    //\n    getCategories() {\n\n        return d3.promise.json(this.categoriesUrl)\n            .catch(error => console.error(error));\n    }\n\n    getCountiesInState(stateId, limit = 10) {\n\n        return d3.promise.json(this.mostPopulousRegionTypeUrl.format(stateId, 'county', limit))\n            .catch(error => console.error(error));\n    }\n\n    getDomains() {\n\n        return d3.promise.json(this.domainsUrl)\n            .catch(error => console.error(error));\n    }\n\n    getParentState(region) {\n\n        return d3.promise.json(this.parentStateUrl.format(region.id))\n            .catch(error => console.error(error));\n    }\n\n    getPlacesAndCountiesInState(stateId, limit = 10) {\n\n        var placesPromise = d3.promise.json(this.mostPopulousRegionTypeUrl.format(stateId, 'place', limit));\n        var countiesPromise = d3.promise.json(this.mostPopulousRegionTypeUrl.format(stateId, 'county', limit));\n\n        return Promise.all([placesPromise, countiesPromise])\n            .then(values => Promise.resolve(values[0].concat(values[1])))\n            .catch(error => console.error(error));\n    }\n\n    getMetrosInState(stateId, limit = 10) {\n\n        return d3.promise.json(this.mostPopulousRegionTypeUrl.format(stateId, 'msa', limit))\n            .catch(error => console.error(error));\n    }\n\n    getPlacesInState(stateId, limit = 10) {\n\n        return d3.promise.json(this.mostPopulousRegionTypeUrl.format(stateId, 'place', limit))\n            .catch(error => console.error(error));\n    }\n\n    getSimilarRegions(regionId) {\n\n        return d3.promise.json(this.similarRegionsUrl.format(regionId))\n            .catch(error => console.error(error));\n    }\n\n    // Callbacks\n    //\n    getAutoCompleteNameSuggestions(searchTerm, completionHandler) {\n\n        $.getJSON(this.autoCompleteNameSuggestUrl.format(encodeURIComponent(searchTerm)), completionHandler);\n    }\n\n    getCostOfLivingData(regionIds, completionHandler) {\n\n        this.getData(this.costOfLivingUrl, regionIds, completionHandler);\n    }\n\n    getEarningsData(regionIds, completionHandler) {\n\n        this.getData(this.earningsUrl, regionIds, completionHandler);\n    }\n\n    getEducationData(regionIds, completionHandler) {\n\n        this.getData(this.educationUrl, regionIds, completionHandler);\n    }\n\n    getGdpData(regionIds, completionHandler) {\n\n        this.getData(this.gdpUrl, regionIds, completionHandler);\n    }\n\n    getOccupationsData(regionIds, completionHandler) {\n\n        this.getData(this.occupationsUrl, regionIds, completionHandler);\n    }\n\n    getPopulationData(regionIds, completionHandler) {\n\n        this.getData(this.populationUrl, regionIds, completionHandler);\n    }\n\n    // health data retrievers\n    getHealthRwjfChrData(regionIds, completionHandler) {\n        this.getData(this.healthDataUrls.rwjf_county_health_rankings_2015, regionIds, completionHandler);\n    }\n    getHealthCdcBrfssPrevalenceData(regionIds, completionHandler) {\n        this.getData(this.healthDataUrls.cdc, regionIds, completionHandler, '_geoid');\n    }\n\n    getData(url, regionIds, completionHandler, region_id_column = 'id') {\n\n        var segments = regionIds.map(function(regionId) {\n            return region_id_column+'=\\'' + regionId + '\\''; \n        });\n\n        $.getJSON(url + encodeURI(segments.join(' OR ')), completionHandler);\n    }\n}"]}