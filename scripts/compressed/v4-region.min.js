function RegionPageController(params){this.params=params;var self=this;$("section.refine .fa-times-circle").click(function(){self.removeRegion($(this).parent().index()),self.navigate()})}function ApiController(){this.populationUrl="https://federal.demo.socrata.com/resource/e3rd-zzmr.json/?id=",this.educationUrl="https://federal.demo.socrata.com/resource/uf4m-5u8r.json/?id=",this.earningsUrl="https://federal.demo.socrata.com/resource/wmwh-4vak.json/?id=",this.occupationsUrl="https://federal.demo.socrata.com/resource/qfcm-fw3i.json/?id=",this.gdpUrl="https://federal.demo.socrata.com/resource/ks2j-vhr8.json/?type=state&$limit=50000&year=2013&$order=name",this.costOfLivingUrl="https://federal.demo.socrata.com/resource/hpnf-gnfu.json/?type=state&$limit=50000&year=2013&component=All&$order=name"}$(document).ready(function(){function drawCharts(){apiController.getPopulationData(regionId,function(data){var rg=data.map(function(item){return[item.year,parseInt(item.population)]});rg.reverse(),rg.unshift(["Year","Population"]);var dataTable=google.visualization.arrayToDataTable(rg),options={title:"Seattle Population",curveType:"function",legend:{position:"bottom"}},chart=new google.visualization.LineChart(document.getElementById("population-chart"));chart.draw(dataTable,options)}),apiController.getPopulationChangeData(regionId,function(data){var rg=data.map(function(item){return[item.year,parseFloat(item.population_percent_change)]});rg.reverse(),rg.unshift(["Year","Population Change"]);var dataTable=google.visualization.arrayToDataTable(rg),options={title:"Seattle Population Change",curveType:"function",legend:{position:"bottom"}},chart=new google.visualization.LineChart(document.getElementById("population-change-chart"));chart.draw(dataTable,options)})}if(new RegionPageController(_params),_params.regions.length>0){var apiController=new ApiController,regionId=_params.regions[0].id;apiController.getEducationData(regionId),apiController.getEarningsData(regionId),apiController.getOccupationsData(regionId),apiController.getGdpData(),apiController.getCostOfLivingData(),google.setOnLoadCallback(drawCharts)}}),RegionPageController.prototype.getRegionPageUrl=function(){var url="./",regionNames=this.params.regions.map(function(region){return region.name.replace(/,/g,"").replace(/ /g,"_")});return url+=regionNames.join("_vs_")+this.getRegionQueryString()},RegionPageController.prototype.getRegionQueryString=function(){var url="";return this.params.page>1&&(url+="?page="+this.params.page),url},RegionPageController.prototype.navigate=function(){window.location.href=this.getRegionPageUrl()},RegionPageController.prototype.removeRegion=function(regionIndex){this.params.regions.splice(regionIndex,1),this.params.page=1},ApiController.prototype.getPopulationData=function(id,completion){$.getJSON(this.populationUrl+id,function(data){var items=data.map(function(item){return"<li>"+item.year+" : "+item.population+"</li>"});$(".population").html(items.join("")),completion&&completion(data)})},ApiController.prototype.getPopulationChangeData=function(id,completion){$.getJSON(this.populationUrl+id,function(data){var items=data.map(function(item){return"<li>"+item.year+" : "+item.population_percent_change+"%</li>"});$(".population-change").html(items.join("")),completion&&completion(data)})},ApiController.prototype.getEducationData=function(id){$.getJSON(this.educationUrl+id,function(data){var s="<li>High school or higher : "+data[0].percent_high_school_graduate_or_higher+"%</li>";s+="<li>Bachelor's or higher : "+data[0].percent_bachelors_degree_or_higher+"%</li>",$(".education").html(s)})},ApiController.prototype.getEarningsData=function(id){$.getJSON(this.earningsUrl+id,function(data){var s="<li>Median Earnings (All Workers) : $"+data[0].median_earnings+"</li>";s+="<li>Median Female Earnings (Full Time) : $"+data[0].female_full_time_median_earnings+"</li>",s+="<li>Median Male Earnings (Full Time) : $"+data[0].male_full_time_median_earnings+"</li>",$(".earnings").html(s)})},ApiController.prototype.getOccupationsData=function(id){$.getJSON(this.occupationsUrl+id,function(data){var items=data.map(function(item){return"<li>"+item.occupation+" : "+item.employed+" : "+Math.floor(item.employed/item.total_employed*100)+"%</li>"});$(".occupations").html(items.join(""))})},ApiController.prototype.getGdpData=function(){$.getJSON(this.gdpUrl,function(data){var items=data.map(function(item){return"<li>"+item.name+" : $"+item.per_capita_gdp+"</li>"});$(".gdp").html(items.join(""))})},ApiController.prototype.getCostOfLivingData=function(){$.getJSON(this.costOfLivingUrl,function(data){var items=data.map(function(item){return"<li>"+item.name+" : "+item.index+"</li>"});$(".costOfLiving").html(items.join(""))})};