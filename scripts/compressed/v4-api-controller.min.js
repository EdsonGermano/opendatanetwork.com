"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ApiController=function(){function ApiController(){_classCallCheck(this,ApiController),this.autoCompleteNameSuggestUrl="https://odn.data.socrata.com/views/7g2b-8brv/columns/autocomplete_name/suggest/{0}?size=10&fuzz=0",this.categoriesUrl="/categories.json",this.costOfLivingUrl="https://odn.data.socrata.com/resource/hpnf-gnfu.json?$order=name&$where=",this.domainsUrl="https://api.us.socrata.com/api/catalog/v1/domains",this.earningsUrl="https://odn.data.socrata.com/resource/wmwh-4vak.json?$where=",this.healthUrl="https://odn.data.socrata.com/resource/wmwh-4vak.json?$where=",this.educationUrl="https://odn.data.socrata.com/resource/uf4m-5u8r.json?$where=",this.gdpUrl="https://odn.data.socrata.com/resource/ks2j-vhr8.json?$where=",this.mostPopulousRegionTypeUrl="https://odn.data.socrata.com/resource/eyae-8jfy?parent_id={0}&child_type={1}&$limit={2}&$order=child_population desc",this.occupationsUrl="https://odn.data.socrata.com/resource/qfcm-fw3i.json?$order=occupation&$where=",this.parentStateUrl="https://odn.data.socrata.com/resource/eyae-8jfy?parent_type=state&child_id={0}",this.placesInRegionUrl="https://odn.data.socrata.com/resource/eyae-8jfy?parent_id=",this.populationUrl="https://odn.data.socrata.com/resource/e3rd-zzmr.json?$order=year,name&$where=",this.similarRegionsUrl="https://socrata-peers.herokuapp.com/peers.json?vectors=population_change,earnings,occupation,education,population&n=10&id={0}",this.healthDataUrls={rwjf_county_health_rankings_2015:"https://odn.data.socrata.com/resource/7ayp-utp2.json?$where=",cdc_brfss_prevalence_2011_2013:"https://odn.data.socrata.com/resource/n4rt-3rmd.json?$where="}}return _createClass(ApiController,[{key:"getCategories",value:function(){return d3.promise.json(this.categoriesUrl)["catch"](function(error){return console.error(error)})}},{key:"getCountiesInState",value:function(stateId){var limit=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.mostPopulousRegionTypeUrl.format(stateId,"county",limit))["catch"](function(error){return console.error(error)})}},{key:"getDomains",value:function(){return d3.promise.json(this.domainsUrl)["catch"](function(error){return console.error(error)})}},{key:"getParentState",value:function(region){return d3.promise.json(this.parentStateUrl.format(region.id))["catch"](function(error){return console.error(error)})}},{key:"getPlacesAndCountiesInState",value:function(stateId){var limit=arguments.length<=1||void 0===arguments[1]?10:arguments[1],placesPromise=d3.promise.json(this.mostPopulousRegionTypeUrl.format(stateId,"place",limit)),countiesPromise=d3.promise.json(this.mostPopulousRegionTypeUrl.format(stateId,"county",limit));return Promise.all([placesPromise,countiesPromise]).then(function(values){return Promise.resolve(values[0].concat(values[1]))})["catch"](function(error){return console.error(error)})}},{key:"getMetrosInState",value:function(stateId){var limit=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.mostPopulousRegionTypeUrl.format(stateId,"msa",limit))["catch"](function(error){return console.error(error)})}},{key:"getPlacesInState",value:function(stateId){var limit=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.mostPopulousRegionTypeUrl.format(stateId,"place",limit))["catch"](function(error){return console.error(error)})}},{key:"getSimilarRegions",value:function(regionId){return d3.promise.json(this.similarRegionsUrl.format(regionId))["catch"](function(error){return console.error(error)})}},{key:"getAutoCompleteNameSuggestions",value:function(searchTerm,completionHandler){$.getJSON(this.autoCompleteNameSuggestUrl.format(encodeURIComponent(searchTerm)),completionHandler)}},{key:"getCostOfLivingData",value:function(regionIds,completionHandler){this.getData(this.costOfLivingUrl,regionIds,completionHandler)}},{key:"getEarningsData",value:function(regionIds,completionHandler){this.getData(this.earningsUrl,regionIds,completionHandler)}},{key:"getEducationData",value:function(regionIds,completionHandler){this.getData(this.educationUrl,regionIds,completionHandler)}},{key:"getGdpData",value:function(regionIds,completionHandler){this.getData(this.gdpUrl,regionIds,completionHandler)}},{key:"getOccupationsData",value:function(regionIds,completionHandler){this.getData(this.occupationsUrl,regionIds,completionHandler)}},{key:"getPopulationData",value:function(regionIds,completionHandler){this.getData(this.populationUrl,regionIds,completionHandler)}},{key:"getHealthRwjfChrData",value:function(regionIds,completionHandler){this.getData(this.healthDataUrls.rwjf_county_health_rankings_2015,regionIds,completionHandler)}},{key:"getHealthCdcBrfssPrevalenceData",value:function(regionIds,completionHandler){this.getData(this.healthDataUrls.cdc,regionIds,completionHandler,"_geoid")}},{key:"getData",value:function(url,regionIds,completionHandler){var region_id_column=arguments.length<=3||void 0===arguments[3]?"id":arguments[3],segments=regionIds.map(function(regionId){return region_id_column+"='"+regionId+"'"});$.getJSON(url+encodeURI(segments.join(" OR ")),completionHandler)}}]),ApiController}();