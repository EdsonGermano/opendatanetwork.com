function SearchPageController(params){this.params=params,this.fetching=!1,this.fetchedAll=!1;var self=this;$(".applied-filter-category").click(function(){self.toggleCategory($(this).text()),self.navigate()}),$(".applied-filter-domain").click(function(){self.toggleDomain($(this).text()),self.navigate()}),$(".applied-filter-tag").click(function(){self.toggleTag($(this).text()),self.navigate()}),$(".filter-pane-categories li a").click(function(){self.toggleCategory($(this).text()),self.navigate()}),$(".filter-pane-domains li a").click(function(){self.toggleDomain($(this).text()),self.navigate()}),$(".filter-pane-tags li a").click(function(){self.toggleTag($(this).text()),self.navigate()}),$(".view-more-categories").click(function(){self.toggleCategoryFilters(),self.navigate()}),$(".view-more-domains").click(function(){self.toggleDomainFilters(),self.navigate()}),$(".view-more-tags").click(function(){self.toggleTagFilters(),self.navigate()}),$(".fa-close").click(function(){$(".current-category").fadeOut(),setCookie("current-category-hidden","1")}),$(window).on("scroll",function(){var bottomOffsetToBeginRequest=1e3;$(window).scrollTop()>=$(document).height()-$(window).height()-bottomOffsetToBeginRequest&&self.fetchNextPage()}).scroll()}function setCookie(key,value){var expires=new Date;expires.setTime(expires.getTime()+31536e6),document.cookie=key+"="+value+";expires="+expires.toUTCString()}function getCookie(key){var keyValue=document.cookie.match("(^|;) ?"+key+"=([^;]*)(;|$)");return keyValue?keyValue[2]:null}$(document).ready(function(){new SearchPageController(_params)}),SearchPageController.prototype.fetchNextPage=function(){if(!this.fetching&&!this.fetchedAll){this.fetching=!0,this.incrementPage();var self=this;$.ajax(this.getSearchResultsUrl()).done(function(data,textStatus,jqXHR){return console.log(jqXHR.status+" "+textStatus),204==jqXHR.status?(self.decrementPage(),self.fetching=!1,void(self.fetchedAll=!0)):($(".search-results-pane ul").append(data),void(self.fetching=!1))})}},SearchPageController.prototype.decrementPage=function(){this.params.page--},SearchPageController.prototype.incrementPage=function(){this.params.page++},SearchPageController.prototype.getSearchResultsUrl=function(){var searchResultsUrl="./v3-search-results",url=searchResultsUrl+this.getSearchQueryString();return console.log(url),url},SearchPageController.prototype.getSearchUrl=function(){var searchUrl="./v3-search",url=searchUrl+this.getSearchQueryString();return console.log(url),url},SearchPageController.prototype.getSearchQueryString=function(){var url="?q="+encodeURIComponent($("#q").val());return this.params.page>1&&(url+="&page="+this.params.page),this.params.categories.length>0&&(url+="&categories="+encodeURIComponent(this.params.categories.join(","))),this.params.domains.length>0&&(url+="&domains="+encodeURIComponent(this.params.domains.join(","))),this.params.tags.length>0&&(url+="&tags="+encodeURIComponent(this.params.tags.join(","))),this.params.ec&&(url+="&ec=1"),this.params.ed&&(url+="&ed=1"),this.params.et&&(url+="&et=1"),url},SearchPageController.prototype.navigate=function(){window.location.href=this.getSearchUrl()},SearchPageController.prototype.toggleCategory=function(category){category=category.toLowerCase().trim();var i=this.params.categories.indexOf(category);i>-1?this.params.categories.splice(i,1):this.params.categories.push(category),this.params.page=1},SearchPageController.prototype.toggleDomain=function(domain){domain=domain.toLowerCase().trim();var i=this.params.domains.indexOf(domain);i>-1?this.params.domains.splice(i,1):this.params.domains.push(domain),this.params.page=1},SearchPageController.prototype.toggleTag=function(tag){tag=tag.toLowerCase().trim();var i=this.params.tags.indexOf(tag);i>-1?this.params.tags.splice(i,1):this.params.tags.push(tag),this.params.page=1},SearchPageController.prototype.toggleCategoryFilters=function(){this.params.ec=!this.params.ec},SearchPageController.prototype.toggleDomainFilters=function(){this.params.ed=!this.params.ed},SearchPageController.prototype.toggleTagFilters=function(){this.params.et=!this.params.et};