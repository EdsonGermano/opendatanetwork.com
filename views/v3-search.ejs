<% include v3-header %>

<script>var _params = <%- JSON.stringify(params) %>;</script>

<section class="results-bar">
  <% if (selectedCategory) { %>
    <label><strong><%= searchResults.resultSetSizeString %></strong> results for <%= selectedCategory.title %></label>
  <% } else if (params.q) { %>
      <% if (params.categories.length == 0) { %>
        <label><strong><%= searchResults.resultSetSizeString %></strong> results for "<strong><%= params.q %></strong>"</label>
      <% } else { %>
        <label>
            <strong><%= searchResults.resultSetSizeString %></strong> results for "<strong><%= params.q %></strong>" in
            <% params.categories.forEach(function(category) { %>
                <span class="applied-category"><%= category %> <a class="fa fa-times-circle"></a></span> 
            <% }); %>
        </label>
      <% } %>
  <% } else { %>
    <label><strong><%= searchResults.resultSetSizeString %></strong> results</label>
  <% } %>
</section>

<section class="main">

    <div class="filters-pane">

        <div class="filters-section">
            <strong>CATEGORIES</strong>
            <ul class="filter-pane-categories">
            <% categoryResults.results.forEach(function(result) { %>
                <li><a><span><i class="fa<%- getSelectedIfCategory(result.category) %>"></i></span><%= result.category %></a></li>
            <% }); %>
            </ul>
            <a class="view-more view-more-categories">
              <% if (params.ec) { %>
                <i class="fa fa-minus"></i><span>View Less</span>
              <% } else { %>
                <i class="fa fa-plus"></i><span>View More</span>
              <% } %>
            </a>
            <strong>PUBLISHERS</strong>
            <ul class="filter-pane-domains">
            <% domainResults.results.forEach(function(result) { %>
                <li><a><span><i class="fa<%- getSelectedIfDomain(result.domain) %>"></i></span><%= result.domain %></a></li>
            <% }); %>
            </ul>
            <a class="view-more view-more-domains">
              <% if (params.ed) { %>
                <i class="fa fa-minus"></i><span>View Less</span>
              <% } else { %>
                <i class="fa fa-plus"></i><span>View More</span>
              <% } %>
            </a>
            <strong>TAGS</strong>
            <ul class="filter-pane-tags">
            <% tagResults.results.forEach(function(result) { %>
                <li><a><span><i class="fa<%- getSelectedIfTag(result.tag) %>"></i></span><%= result.tag %></a></li>
            <% }); %>
            </ul>
            <a class="view-more view-more-tags">
              <% if (params.et) { %>
                <i class="fa fa-minus"></i><span>View Less</span>
              <% } else { %>
                <i class="fa fa-plus"></i><span>View More</span>
              <% } %>
            </a>
        </div>

        <div class="about-section">
            <ul>
                <li><a class="blue-button-link">Leave Feedback</a></li>
                <li><a class="blue-link" href="http://www.socrata.com/company-info/">About Socrata</a></li>
                <li><a class="blue-link" href="http://www.opendatanetwork.com/join-open-data-network">Join the Network</a></li>
                <li><a class="socrata-link" href="http://www.socrata.com/company-info/"><img src="/images/v3-powered-by-socrata.png"></a></li>
            </ul>
        </div>
    </div>

    <div class="search-results-pane">
      <% if (selectedCategory) { %>
        <div class="yellow-box">
            <a class="fa fa-close"></a>
            <strong><%= selectedCategory.title %></strong> - <%= selectedCategory.description %>
        </div>
      <% } %>
        <ul>
<% include v3-search-results %>
        </ul>
    </div>

    <div class="showcase-pane">
    </div>

</section>

<%
function getSelectedIfCategory(category) {

    for (var i in params.categories) {

        if (params.categories[i].toLowerCase() == category.toLowerCase())
            return ' fa-check';
    }

    return '';
}

function getSelectedIfDomain(domain) {

    for (var i in params.domains) {

        if (params.domains[i].toLowerCase() == domain.toLowerCase())
            return ' fa-check';
    }

    return '';
}

function getSelectedIfTag(tag) {

    for (var i in params.tags) {

        if (params.tags[i].toLowerCase() == tag.toLowerCase())
            return ' fa-check';
    }

    return '';
}
%>
