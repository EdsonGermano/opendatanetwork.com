<% include _header %>
<% include _search-bar %>

<script>
var _params = <%- JSON.stringify(params) %>;
var _mapVariables = <%- JSON.stringify(mapVariables) %>;
var _tableData = <%- JSON.stringify(tableData) %>;
</script>

<section class="refine">

    <a class="refine-link">
        <span>Standards<i class="fa fa-caret-down"></i></span>
        <ul id="refine-menu-tags" style="display:none">
            <li>BLDS</li>
            <li>LIVES</li>
        </ul>
    </a>

    <a class="refine-link">
        <span>Publishers<i class="fa fa-caret-down"></i></span>
        <ul id="refine-menu-domains" style="display:none">
          <% domainResults.results.forEach(function(result) { %>
            <li><%= result.domain %></li>
          <% }); %>
            <li id="refine-menu-domains-view-more" class="refine-view-more">View More...</li>
        </ul>
    </a>

    <a class="refine-link">
        <span>Categories<i class="fa fa-caret-down"></i></span>
        <ul id="refine-menu-categories" style="display:none">
        <% if (typeof categories != 'undefined' && categories.length > 0) { %>
            <% categories.forEach(function(category) { %>
                <li><i class="fa <%= category.metadata.icon %>"></i><%= category.category %></li>
           <% }); %>
       <% } %>
            <li id="refine-menu-categories-view-more" class="refine-view-more">View More...</li>
        </ul>
    </a>

    <label class="refine-by-label">Refine by:</label>

<% if (params.q.length > 0) { %>
      <% if (searchResults.results.length > 0) { %>
        <strong><%= searchResults.resultSetSizeString %></strong> results for <strong><%= params.q %></strong>
      <% } else { %>
        <strong><%= getTabTitle(params.vector.length > 0 ? params.vector : 'population') %></strong>
      <% } %>
<% } else { %>
    <% if (searchResults.results.length > 0) { %>
      <% if (params.regions.length > 0) { %>
        <strong><%= searchResults.resultSetSizeString %></strong> results for
        <strong><%= getTabTitle(params.vector.length > 0 ? params.vector : 'population') %></strong>
      <% } else { %>
        <strong><%= searchResults.resultSetSizeString %></strong> results
      <% } %>
    <% } %>
<% } %>

    <ul class="tokens">
    <% params.regions.forEach(function(region) { %>
        <li class="region-token"><%= region.name %> <a class="fa fa-times-circle"></a></li>
    <% }); %>
    <% params.categories.forEach(function(category) { %>
        <li class="category-token"><%= category %> <a class="fa fa-times-circle"></a></li>
    <% }); %>
    <% params.domains.forEach(function(domain) { %>
        <li class="domain-token"><%= domain %> <a class="fa fa-times-circle"></a></li>
    <% }); %>
    <% params.tags.forEach(function(tag) { %>
        <li class="standard-token"><%= tag %> <a class="fa fa-times-circle"></a></li>
    <% }); %>
    </ul>

</section>

<section class="results">

<% if (params.regions.length == 0) { %>

    <div class="search-results-regular-column">

      <% if (typeof currentCategory != 'undefined' && currentCategory && currentCategory.metadata && currentCategory.metadata.description) { %>
        <div class="current-category">
            <a class="fa fa-close"></a>
            <strong><%= currentCategory.category %></strong> - <%- currentCategory.metadata.description %>
        </div>
      <% } else if (typeof currentTag != 'undefined' && currentTag && currentTag.metadata && currentTag.metadata.description) { %>
        <div class="current-category">
            <a class="fa fa-close"></a>
            <strong><%= currentTag.tag %></strong> - <%- currentTag.metadata.description %>
        </div>
      <% } %>

        <ul class="datasets">
<% include _search-results-regular %>
        </ul>
    </div>

<% } else { %>

    <div class="controls-column">
        <div class="controls">
            <h2>Compare this Data</h2>
            <div class="add-region">
                <i class="fa fa-plus"></i><input class="add-region-input" type="text" placeholder="Add Location">
                <ul class="add-region-results" style="display: none;"></ul>
            </div>
            <% if (typeof peers != 'undefined' && peers && peers.length > 0) { %>
                <ul id="similar-regions">
                <% peers.forEach(function(region) { %>
                    <li><a href=<%= region.addURL %>><%= region.name %> <i class="fa fa-plus"></i></a></li>
                <% }); %>
                </ul>
            <% } %>

            <%
            const PLURALS = {
                nation: 'Nations',
                region: 'Regions',
                division: 'Divisions',
                state: 'States',
                county: 'Counties',
                place: 'Places',
                msa: 'Metro Areas',
                zip_code: 'ZIP Codes'
            };
            %>

            <% if (typeof siblings != 'undefined' && siblings && siblings.length > 0) { %>
                <h2 class="places-in-region-header">
                    <%= PLURALS[params.regions[0].type] %> in
                    <a class="parent-link" href="<%= parentRegion.navigateURL %>"><%= parentRegion.name %></a>
                </h2>

                <ul class="places-in-region-list">
                    <% siblings.forEach(function(region) { %>
                        <li><a href="<%= region.navigateURL %>"><%= region.name %></a></li>
                    <% }); %>
                </ul>
            <% } %>

            <% if (typeof allChildren != 'undefined' && allChildren && allChildren.length > 0) { %>
                <% allChildren.forEach(function(children) { %>
                    <% if (children.length > 0) { %>
                        <h2 class="places-in-region-header">
                            <%= PLURALS[children[0].type] %> in <%= params.regions[0].name %>
                        </h2>

                        <ul class="places-in-region-list">
                            <% children.forEach(function(child) { %>
                                <li><a href="<%= child.navigateURL %>"><%= child.name %></a></li>
                            <% }); %>
                        </ul>
                    <% } %>
                <% }); %>
            <% } %>

            <h2 id="places-in-region-header-0" class="places-in-region-header" style="display:none"></h2>
            <ul id="places-in-region-list-0" class="places-in-region-list" style="display:none"></ul>
            <h3 id="places-in-region-header-1" class="places-in-region-header" style="display:none"></h3>
            <ul id="places-in-region-list-1" class="places-in-region-list" style="display:none"></ul>
        </div>
        <div class="footer">
            <ul class="footer-links">
                <li><a class="blue-link" href="http://www.socrata.com/company-info/">About Socrata</a></li>
                <li><a class="blue-link" href="http://www.opendatanetwork.com/join-open-data-network">Join the Network</a></li>
            </ul>
            <a href="http://www.socrata.com/company-info/"><img src="/images/v3-powered-by-socrata.png"></a>
        </div>
    </div>

    <div class="charts-column">

        <ul class="chart-tabs">
          <% sources.forEach(function(source) { %>
            <li<%- getSelectedVector(source) %>><a href="<%= getSearchPageUrl(source) %>"><%= getTabTitle(source) %></a></li>
          <% }); %>
        </ul>

        <div class="charts">

<% if ((params.vector == '') || (params.vector == 'population')) { %>

            <div id="map"></div>
<% include _map-summary %>
            <h1>Population</h1>
            <figure id="population-chart"></figure>
            <h1>Population Change</h1>
            <figure id="population-change-chart"></figure>
            <label>
                Data from the 2013 U.S. Census American Community Survey. <a href='https://www.census.gov/programs-surveys/acs/'>Data Source</a> | <a href='https://odn.data.socrata.com/view/va7f-2qjr?'>ODN Dataset</a> | <a href='https://dev.socrata.com/foundry/#/odn.data.socrata.com/e3rd-zzmr'>API</a> - <span class='info-icon'><div class='info-tooltip'><strong>Note</strong> - ODN datasets and APIs are subject to change and may differ in format from the original source data in order to provide a user-friendly experience on this site.</div></span>
            </label>

<% } else if (params.vector == 'earnings') { %>

            <div id="map"></div>
<% include _map-summary %>
            <h1>Earnings</h1>
            <div id="earnings-table-container">
<% include _earnings-table %>
            </div>
            <figure id="earnings-chart"></figure>
            <label>
                Data from the 2013 U.S. Census American Community Survey. <a href='https://www.census.gov/programs-surveys/acs/'>Data Source</a> | <a href='https://odn.data.socrata.com/view/6atn-pcse?'>ODN Dataset</a> | <a href='https://dev.socrata.com/foundry/#/odn.data.socrata.com/wmwh-4vak'>API</a> - <span class='info-icon'><div class='info-tooltip'><strong>Note</strong> - ODN datasets and APIs are subject to change and may differ in format from the original source data in order to provide a user-friendly experience on this site.</div></span>
            </label>

<% } else if (params.vector == 'education') { %>

            <div id="map"></div>
<% include _map-summary %>
            <h1>Education</h1>
            <div id="education-table-container">
<% include _education-table %>
            </div>
            <label>
                Data from the 2013 U.S. Census American Community Survey. <a href='https://www.census.gov/programs-surveys/acs/'>Data Source</a> | <a href='https://odn.data.socrata.com/view/8vbc-rxrs?'>ODN Dataset</a> | <a href='https://dev.socrata.com/foundry/#/odn.data.socrata.com/uf4m-5u8r'>API</a> - <span class='info-icon'><div class='info-tooltip'><strong>Note</strong> - ODN datasets and APIs are subject to change and may differ in format from the original source data in order to provide a user-friendly experience on this site.</div></span>
            </label>

<% } else if (params.vector == 'occupations') { %>

            <div id="map"></div>
<% include _map-summary %>
            <h1>Occupations</h1>
            <div id="occupations-table-container">
<% include _occupations-table %>
            </div>
            <label>
                Data from the 2013 U.S. Census American Community Survey. <a href='https://www.census.gov/programs-surveys/acs/'>Data Source</a> | <a href='https://odn.data.socrata.com/view/36ax-ppuh'>ODN Dataset</a> | <a href='https://dev.socrata.com/foundry/#/odn.data.socrata.com/qfcm-fw3i'>API</a> - <span class='info-icon'><div class='info-tooltip'><strong>Note</strong> - ODN datasets and APIs are subject to change and may differ in format from the original source data in order to provide a user-friendly experience on this site.</div></span>
            </label>

<% } else if (params.vector == 'gdp') { %>

            <div id="map"></div>
<% include _map-summary %>
            <h1>GDP</h1>
            <figure id="per-capita-gdp-chart"></figure>
            <figure id="per-capita-gdp-change-chart"></figure>
            <label>
                Data from U.S. Bureau of Economic Analysis. <a href='http://www.bea.gov/regional/'>Data Source</a> | <a href='https://odn.data.socrata.com/view/h7vs-8d3q'>ODN Dataset</a> | <a href='https://dev.socrata.com/foundry/#/odn.data.socrata.com/ks2j-vhr8'>API</a> - <span class='info-icon'><div class='info-tooltip'><strong>Note</strong> - ODN datasets and APIs are subject to change and may differ in format from the original source data in order to provide a user-friendly experience on this site.</div></span>
            </label>

<% } else if (params.vector == 'health') { %>

            <div id="map"></div>
<% include _map-summary %>
            <h1>Health</h1>
            <div id='cdc-brfss'>
                <h2>CDC Behavioral Risk Factor Surveillance System (BRFSS) Data: Overall Health</h2>
                <p>The Behavioral Risk Factor Surveillance System (BRFSS) is the nation's premier system of health-related telephone surveys that collect state data about U.S. residents regarding their health-related risk behaviors, chronic health conditions, and use of preventive services. Established in 1984 with 15 states, BRFSS now collects data in all 50 states as well as the District of Columbia and three U.S. territories. BRFSS completes more than 400,000 adult interviews each year, making it the largest continuously conducted health survey system in the world.</p>

                <p style='text-align: center;'>
                    Question: 'How is your general health?' | Answer:
                    <select id='cdc-brfss-overall-health-chart-selector'>
                        <option selected value='Excellent'>Excellent</option>
                        <option value='Very good'>Very good</option>
                        <option value='Good'>Good</option>
                        <option value='Fair'>Fair</option>
                        <option value='Poor'>Poor</option>
                    </select>
                </p>

                <figure id="cdc-brfss-overall-health-chart"></figure>
                <label>
                    Data from CDC's Behavioral Risk Factor Surveillance System. <a href='https://chronicdata.cdc.gov/Behavioral-Risk-Factors/Behavioral-Risk-Factor-Surveillance-System-BRFSS-P/dttw-5yxu'>Data Source</a> | <a href='https://odn.data.socrata.com/view/hwr6-8gx2'>ODN Dataset</a> | <a href='https://dev.socrata.com/foundry/#/odn.data.socrata.com/n4rt-3rmd'>API</a> - <span class='info-icon' title='Note: ODN datasets and APIs are subject to change and may differ in format from the original source data.'></span>
                    <br>
                    Note: ODN datasets and APIs may differ in format from the original data in order to provide a user-friendly experience on this site.
                </label>
            </div>

            <h2>RWJF County Health Rankings</h2>
            <p>
                The Robert Wood Johnson Foundation produces health rankings for states and counties. They explore many aspects of health including quality of life, health behaviors,                access to clinical care, socioeconomic factors, and environmental factors.
            </p>
            <h1>Health Outcomes</h1>
            <div id="health-outcomes-table-container">
<% include _health-outcomes-table %>
            </div>
            <h1>Health Factors</h1>
            <div id="health-factors-table-container">
<% include _health-factors-table %>
            </div>
            <div id="health-clinical-care-table-container">
<% include _health-clinical-care-table %>
            </div>
            <div id="health-social-economic-factors-table-container">
<% include _health-social-economic-factors-table %>
            </div>
            <div id="health-physical-environment-table-container">
<% include _health-physical-environment-table %>
            </div>
            <label>
                Data from RWJF County Health Rankings. <a href='http://www.countyhealthrankings.org/'>Data Source</a> | <a href='https://odn.data.socrata.com/view/f24f-8rxv'>ODN Dataset</a> | <a href='https://dev.socrata.com/foundry/#/odn.data.socrata.com/6a3g-pbaa'>API</a> - <span class='info-icon'><div class='info-tooltip'><strong>Note</strong> - ODN datasets and APIs are subject to change and may differ in format from the original source data in order to provide a user-friendly experience on this site.</div></span>
            </label>

<% } else if (params.vector == 'cost_of_living') { %>

            <div id="map"></div>
<% include _map-summary %>
            <h1>Cost of Living</h1>
            <div id="cost-of-living-table-container">
<% include _cost-of-living-table %>
            </div>
            <h1>All</h1>
            <figure id="cost-of-living-all-chart"></figure>
            <h1>Goods</h1>
            <figure id="cost-of-living-goods-chart"></figure>
            <h1>Rents</h1>
            <figure id="cost-of-living-rents-chart"></figure>
            <h1>Other</h1>
            <figure id="cost-of-living-other-chart"></figure>
            <label>
                Data from U.S. Bureau of Economic Analysis. <a href='http://www.bea.gov/regional/'>Data Source</a> | <a href='https://odn.data.socrata.com/view/r8tp-bmpy'>ODN Dataset</a> | <a href='https://dev.socrata.com/foundry/#/odn.data.socrata.com/hpnf-gnfu'>API</a> - <span class='info-icon'><div class='info-tooltip'><strong>Note</strong> - ODN datasets and APIs are subject to change and may differ in format from the original source data in order to provide a user-friendly experience on this site.</div></span>
            </label>

<% } %>

        </div>
    </div>

<% if (searchResults.results.length > 0) { %>
    <div class="search-results-compact-column">
        <ul class="datasets">
<% include _search-results-compact %>
        </ul>
    </div>
<% } %>

<% } %>

</section>

<% include _google-analytics %>
<% include _usersnap %>

</body>
</html>

<%
function getTabTitle(source) {

    switch (source) {

        case 'population': return 'Population';
        case 'earnings': return 'Earnings';
        case 'education': return 'Education';
        case 'occupations': return 'Occupations';
        case 'gdp': return 'GDP';
        case 'cost_of_living': return 'Cost of Living';
        case 'health': return 'Health';
        default: return '';
    }
}

function getSearchPageUrl(vector) {

    var url;

    if (params.regions.length > 0) {

        url = '/region';

        // Region ids
        //
        var regionIds = params.regions.map(function(region) {
            return region.id;
        });

        url += '/' + regionIds.join('-');

        // Region names
        //
        var regionNames = params.regions.map(function(region) {
            return region.name.replace(/ /g, '_').replace(/\//g, '_').replace(/,/g, '');
        });

        url += '/' + regionNames.join('-');

        if (vector)
            url += '/' + vector;
    }
    else {

        url = '/search';
    }

    url += getSearchQueryString();

    return url;
}

function getSearchQueryString() {

    var parts = [];

    if (params.q.length > 0)
        parts.push('q=' + encodeURIComponent(params.q));

    if (params.page > 1)
        parts.push('page=' + params.page);

    if (params.categories.length > 0)
        params.categories.forEach(category => parts.push('categories=' + encodeURIComponent(category)));

    if (params.domains.length > 0)
        params.domains.forEach(domain => parts.push('domains=' + encodeURIComponent(domain)));

    if (params.tags.length > 0)
        params.tags.forEach(tag => parts.push('tags=' + encodeURIComponent(tag)));

    return (parts.length > 0) ? '?' + parts.join('&') : '';
};

function getSelectedVector(vector) {

    if ((params.vector == vector) || ((params.vector == '') && (vector == 'population')))
        return ' class="selected"';
    else
        return '';
}
%>
